function jsonify(e){return JSON.stringify(e,null,"	")}(function(e){if(typeof exports=="object"&&typeof module=="object")return e(exports);if(typeof define=="function"&&define.amd)return define(["exports"],e);e(self.acorn||(self.acorn={}))})(function(e){"use strict";function o(e){t=e||{};for(var n in s)if(!t.hasOwnProperty(n))t[n]=s[n];i=t.sourceFile||null}function T(e,t){var r=u(n,e);t+=" ("+r.line+":"+r.column+")";var i=new SyntaxError(t);i.pos=e;i.loc=r;i.raisedAt=a;throw i}function At(e){function s(e){if(e.length==1)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var n=0;n<e.length;++n)t+="case "+JSON.stringify(e[n])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[];e:for(var r=0;r<e.length;++r){for(var i=0;i<n.length;++i)if(n[i][0].length==e[r].length){n[i].push(e[r]);continue e}n.push([e[r]])}if(n.length>3){n.sort(function(e,t){return t.length-e.length});t+="switch(str.length){";for(var r=0;r<n.length;++r){var o=n[r];t+="case "+o[0].length+":";s(o)}t+="}"}else{s(e)}return new Function("str",t)}function Ut(e){if(e<65)return e===36;if(e<91)return true;if(e<97)return e===95;if(e<123)return true;return e>=170&&Ft.test(String.fromCharCode(e))}function zt(e){if(e<48)return e===36;if(e<58)return true;if(e<65)return false;if(e<91)return true;if(e<97)return e===95;if(e<123)return true;return e>=170&&It.test(String.fromCharCode(e))}function Wt(){this.line=m;this.column=a-g}function Xt(){m=1;a=g=0;v=true;Kt()}function Vt(e,n){l=a;if(t.locations)h=new Wt;p=e;Kt();d=n;v=e.beforeExpr}function $t(){var e=t.onComment&&t.locations&&new Wt;var r=a,i=n.indexOf("*/",a+=2);if(i===-1)T(a-2,"Unterminated comment");a=i+2;if(t.locations){Rt.lastIndex=r;var s;while((s=Rt.exec(n))&&s.index<a){++m;g=s.index+s[0].length}}if(t.onComment)t.onComment(true,n.slice(r+2,i),r,a,e,t.locations&&new Wt)}function Jt(){var e=a;var i=t.onComment&&t.locations&&new Wt;var s=n.charCodeAt(a+=2);while(a<r&&s!==10&&s!==13&&s!==8232&&s!==8329){++a;s=n.charCodeAt(a)}if(t.onComment)t.onComment(false,n.slice(e+2,a),e,a,i,t.locations&&new Wt)}function Kt(){while(a<r){var e=n.charCodeAt(a);if(e===32){++a}else if(e===13){++a;var i=n.charCodeAt(a);if(i===10){++a}if(t.locations){++m;g=a}}else if(e===10){++a;++m;g=a}else if(e<14&&e>8){++a}else if(e===47){var i=n.charCodeAt(a+1);if(i===42){$t()}else if(i===47){Jt()}else break}else if(e<14&&e>8||e===32||e===160){++a}else if(e>=5760&&Ht.test(String.fromCharCode(e))){++a}else{break}}}function Qt(){var e=n.charCodeAt(a+1);if(e>=48&&e<=57)return cn(true);++a;return Vt(ct)}function Gt(){var e=n.charCodeAt(a+1);if(v){++a;return an()}if(e===61)return un(vt,2);return un(pt,1)}function Yt(){var e=n.charCodeAt(a+1);if(e===61)return un(vt,2);return un(kt,1)}function Zt(e){var t=n.charCodeAt(a+1);if(t===e)return un(e===124?bt:wt,2);if(t===61)return un(vt,2);return un(e===124?Et:xt,1)}function en(){var e=n.charCodeAt(a+1);if(e===61)return un(vt,2);return un(St,1)}function tn(e){var t=n.charCodeAt(a+1);if(t===e)return un(gt,2);if(t===61)return un(vt,2);return un(mt,1)}function nn(e){var t=n.charCodeAt(a+1);var r=1;if(t===e){r=e===62&&n.charCodeAt(a+2)===62?3:2;if(n.charCodeAt(a+r)===61)return un(vt,r+1);return un(Ct,r)}if(t===61)r=n.charCodeAt(a+2)===61?3:2;return un(Nt,r)}function rn(e){var t=n.charCodeAt(a+1);if(t===61)return un(Tt,n.charCodeAt(a+2)===61?3:2);return un(e===61?dt:yt,1)}function sn(e){switch(e){case 46:return Qt();case 40:++a;return Vt(ot);case 41:++a;return Vt(ut);case 59:++a;return Vt(ft);case 44:++a;return Vt(at);case 91:++a;return Vt(nt);case 93:++a;return Vt(rt);case 123:++a;return Vt(it);case 125:++a;return Vt(st);case 58:++a;return Vt(lt);case 63:++a;return Vt(ht);case 48:var t=n.charCodeAt(a+1);if(t===120||t===88)return ln();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return cn(false);case 34:case 39:return hn(e);case 47:return Gt(e);case 37:case 42:return Yt();case 124:case 38:return Zt(e);case 94:return en();case 43:case 45:return tn(e);case 60:case 62:return nn(e);case 61:case 33:return rn(e);case 126:return un(yt,1)}return false}function on(e){if(!e)f=a;else a=f+1;if(t.locations)c=new Wt;if(e)return an();if(a>=r)return Vt(A);var i=n.charCodeAt(a);if(Ut(i)||i===92)return mn();var s=sn(i);if(s===false){var o=String.fromCharCode(i);if(o==="\\"||Ft.test(o))return mn();T(a,"Unexpected character '"+o+"'")}return s}function un(e,t){var r=n.slice(a,a+t);a+=t;Vt(e,r)}function an(){var e="",t,i,s=a;for(;;){if(a>=r)T(s,"Unterminated regular expression");var o=n.charAt(a);if(qt.test(o))T(s,"Unterminated regular expression");if(!t){if(o==="[")i=true;else if(o==="]"&&i)i=false;else if(o==="/"&&!i)break;t=o==="\\"}else t=false;++a}var e=n.slice(s,a);++a;var u=vn();if(u&&!/^[gmsiy]*$/.test(u))T(s,"Invalid regexp flag");return Vt(C,new RegExp(e,u))}function fn(e,t){var r=a,i=0;for(var s=0,o=t==null?Infinity:t;s<o;++s){var u=n.charCodeAt(a),f;if(u>=97)f=u-97+10;else if(u>=65)f=u-65+10;else if(u>=48&&u<=57)f=u-48;else f=Infinity;if(f>=e)break;++a;i=i*e+f}if(a===r||t!=null&&a-r!==t)return null;return i}function ln(){a+=2;var e=fn(16);if(e==null)T(f+2,"Expected hexadecimal number");if(Ut(n.charCodeAt(a)))T(a,"Identifier directly after number");return Vt(N,e)}function cn(e){var t=a,r=false,i=n.charCodeAt(a)===48;if(!e&&fn(10)===null)T(t,"Invalid number");if(n.charCodeAt(a)===46){++a;fn(10);r=true}var s=n.charCodeAt(a);if(s===69||s===101){s=n.charCodeAt(++a);if(s===43||s===45)++a;if(fn(10)===null)T(t,"Invalid number");r=true}if(Ut(n.charCodeAt(a)))T(a,"Identifier directly after number");var o=n.slice(t,a),u;if(r)u=parseFloat(o);else if(!i||o.length===1)u=parseInt(o,10);else if(/[89]/.test(o)||x)T(t,"Invalid number");else u=parseInt(o,8);return Vt(N,u)}function hn(e){a++;var i="";for(;;){if(a>=r)T(f,"Unterminated string constant");var s=n.charCodeAt(a);if(s===e){++a;return Vt(k,i)}if(s===92){s=n.charCodeAt(++a);var o=/^[0-7]+/.exec(n.slice(a,a+3));if(o)o=o[0];while(o&&parseInt(o,8)>255)o=o.slice(0,o.length-1);if(o==="0")o=null;++a;if(o){if(x)T(a-2,"Octal literal in strict mode");i+=String.fromCharCode(parseInt(o,8));a+=o.length-1}else{switch(s){case 110:i+="\n";break;case 114:i+="\r";break;case 120:i+=String.fromCharCode(pn(2));break;case 117:i+=String.fromCharCode(pn(4));break;case 85:i+=String.fromCharCode(pn(8));break;case 116:i+="	";break;case 98:i+="\b";break;case 118:i+="";break;case 102:i+="\f";break;case 48:i+="\0";break;case 13:if(n.charCodeAt(a)===10)++a;case 10:if(t.locations){g=a;++m}break;default:i+=String.fromCharCode(s);break}}}else{if(s===13||s===10||s===8232||s===8329)T(f,"Unterminated string constant");i+=String.fromCharCode(s);++a}}}function pn(e){var t=fn(16,e);if(t===null)T(f,"Bad character escape sequence");return t}function vn(){dn=false;var e,t=true,r=a;for(;;){var i=n.charCodeAt(a);if(zt(i)){if(dn)e+=n.charAt(a);++a}else if(i===92){if(!dn)e=n.slice(r,a);dn=true;if(n.charCodeAt(++a)!=117)T(a,"Expecting Unicode escape sequence \\uXXXX");++a;var s=pn(4);var o=String.fromCharCode(s);if(!o)T(a-1,"Invalid Unicode escape");if(!(t?Ut(s):zt(s)))T(a-4,"Invalid Unicode escape");e+=o}else{break}t=false}return dn?e:n.slice(r,a)}function mn(){var e=vn();var n=L;if(!dn){if(Pt(e))n=tt[e];else if(t.forbidReserved&&(t.ecmaVersion===3?Ot:Mt)(e)||x&&_t(e))T(f,"The keyword '"+e+"' is reserved")}return Vt(n,e)}function gn(){y=f;b=l;w=h;on()}function yn(e){x=e;a=b;while(a<g){g=n.lastIndexOf("\n",g-2)+1;--m}Kt();on()}function bn(){this.type=null;this.start=f;this.end=null}function wn(){this.start=c;this.end=null;if(i!==null)this.source=i}function En(){var e=new bn;if(t.locations)e.loc=new wn;if(t.ranges)e.range=[f,0];return e}function Sn(e){var n=new bn;n.start=e.start;if(t.locations){n.loc=new wn;n.loc.start=e.loc.start}if(t.ranges)n.range=[e.range[0],0];return n}function xn(e,n){e.type=n;e.end=b;if(t.locations)e.loc.end=w;if(t.ranges)e.range[1]=b;return e}function Tn(e){return t.ecmaVersion>=5&&e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&e.expression.value==="use strict"}function Nn(e){if(p===e){gn();return true}}function Cn(){return!t.strictSemicolons&&(p===A||p===st||qt.test(n.slice(b,f)))}function kn(){if(!Nn(ft)&&!Cn())An()}function Ln(e){if(p===e)gn();else An()}function An(){T(f,"Unexpected token")}function On(e){if(e.type!=="Identifier"&&e.type!=="MemberExpression")T(e.start,"Assigning to rvalue");if(x&&e.type==="Identifier"&&Dt(e.name))T(e.start,"Assigning to "+e.name+" in strict mode")}function Mn(e){y=b=a;if(t.locations)w=new Wt;E=x=null;S=[];on();var n=e||En(),r=true;if(!e)n.body=[];while(p!==A){var i=Pn();n.body.push(i);if(r&&Tn(i))yn(true);r=false}return xn(n,"Program")}function Pn(){if(p===pt)on(true);var e=p,t=En();switch(e){case O:case D:gn();var r=e===O;if(Nn(ft)||Cn())t.label=null;else if(p!==L)An();else{t.label=er();kn()}for(var i=0;i<S.length;++i){var s=S[i];if(t.label==null||s.name===t.label.name){if(s.kind!=null&&(r||s.kind==="loop"))break;if(t.label&&r)break}}if(i===S.length)T(t.start,"Unsyntactic "+e.keyword);return xn(t,r?"BreakStatement":"ContinueStatement");case P:gn();kn();return xn(t,"DebuggerStatement");case B:gn();S.push(_n);t.body=Pn();S.pop();Ln($);t.test=Hn();kn();return xn(t,"DoWhileStatement");case I:gn();S.push(_n);Ln(ot);if(p===ft)return jn(t,null);if(p===V){var o=En();gn();In(o,true);if(o.declarations.length===1&&Nn(et))return Fn(t,o);return jn(t,o)}var o=qn(false,true);if(Nn(et)){On(o);return Fn(t,o)}return jn(t,o);case q:gn();return Yn(t,true);case R:gn();t.test=Hn();t.consequent=Pn();t.alternate=Nn(j)?Pn():null;return xn(t,"IfStatement");case U:if(!E)T(f,"'return' outside of function");gn();if(Nn(ft)||Cn())t.argument=null;else{t.argument=qn();kn()}return xn(t,"ReturnStatement");case z:gn();t.discriminant=Hn();t.cases=[];Ln(it);S.push(Dn);for(var u,a;p!=st;){if(p===M||p===H){var l=p===M;if(u)xn(u,"SwitchCase");t.cases.push(u=En());u.consequent=[];gn();if(l)u.test=qn();else{if(a)T(y,"Multiple default clauses");a=true;u.test=null}Ln(lt)}else{if(!u)An();u.consequent.push(Pn())}}if(u)xn(u,"SwitchCase");gn();S.pop();return xn(t,"SwitchStatement");case W:gn();if(qt.test(n.slice(b,f)))T(b,"Illegal newline after throw");t.argument=qn();kn();return xn(t,"ThrowStatement");case X:gn();t.block=Bn();t.handler=null;if(p===_){var c=En();gn();Ln(ot);c.param=er();if(x&&Dt(c.param.name))T(c.param.start,"Binding "+c.param.name+" in strict mode");Ln(ut);c.guard=null;c.body=Bn();t.handler=xn(c,"CatchClause")}t.finalizer=Nn(F)?Bn():null;if(!t.handler&&!t.finalizer)T(t.start,"Missing catch or finally clause");return xn(t,"TryStatement");case V:gn();t=In(t);kn();return t;case $:gn();t.test=Hn();S.push(_n);t.body=Pn();S.pop();return xn(t,"WhileStatement");case J:if(x)T(f,"'with' in strict mode");gn();t.object=Hn();t.body=Pn();return xn(t,"WithStatement");case it:return Bn();case ft:gn();return xn(t,"EmptyStatement");default:var h=d,v=qn();if(e===L&&v.type==="Identifier"&&Nn(lt)){for(var i=0;i<S.length;++i)if(S[i].name===h)T(v.start,"Label '"+h+"' is already declared");var m=p.isLoop?"loop":p===z?"switch":null;S.push({name:h,kind:m});t.body=Pn();S.pop();t.label=v;return xn(t,"LabeledStatement")}else{t.expression=v;kn();return xn(t,"ExpressionStatement")}}}function Hn(){Ln(ot);var e=qn();Ln(ut);return e}function Bn(e){var t=En(),n=true,r=false,i;t.body=[];Ln(it);while(!Nn(st)){var s=Pn();t.body.push(s);if(n&&Tn(s)){i=r;yn(r=true)}n=false}if(r&&!i)yn(false);return xn(t,"BlockStatement")}function jn(e,t){e.init=t;Ln(ft);e.test=p===ft?null:qn();Ln(ft);e.update=p===ut?null:qn();Ln(ut);e.body=Pn();S.pop();return xn(e,"ForStatement")}function Fn(e,t){e.left=t;e.right=qn();Ln(ut);e.body=Pn();S.pop();return xn(e,"ForInStatement")}function In(e,t){e.declarations=[];e.kind="var";for(;;){var n=En();n.id=er();if(x&&Dt(n.id.name))T(n.id.start,"Binding "+n.id.name+" in strict mode");n.init=Nn(dt)?qn(true,t):null;e.declarations.push(xn(n,"VariableDeclarator"));if(!Nn(at))break}return xn(e,"VariableDeclaration")}function qn(e,t){var n=Rn(t);if(!e&&p===at){var r=Sn(n);r.expressions=[n];while(Nn(at))r.expressions.push(Rn(t));return xn(r,"SequenceExpression")}return n}function Rn(e){var t=Un(e);if(p.isAssign){var n=Sn(t);n.operator=d;n.left=t;gn();n.right=Rn(e);On(t);return xn(n,"AssignmentExpression")}return t}function Un(e){var t=zn(e);if(Nn(ht)){var n=Sn(t);n.test=t;n.consequent=qn(true);Ln(lt);n.alternate=qn(true,e);return xn(n,"ConditionalExpression")}return t}function zn(e){return Wn(Xn(e),-1,e)}function Wn(e,t,n){var r=p.binop;if(r!=null&&(!n||p!==et)){if(r>t){var i=Sn(e);i.left=e;i.operator=d;gn();i.right=Wn(Xn(n),r,n);var i=xn(i,/&&|\|\|/.test(i.operator)?"LogicalExpression":"BinaryExpression");return Wn(i,t,n)}}return e}function Xn(e){if(p.prefix){var t=En(),n=p.isUpdate;t.operator=d;t.prefix=true;gn();t.argument=Xn(e);if(n)On(t.argument);else if(x&&t.operator==="delete"&&t.argument.type==="Identifier")T(t.start,"Deleting local variable in strict mode");return xn(t,n?"UpdateExpression":"UnaryExpression")}var r=Vn();while(p.postfix&&!Cn()){var t=Sn(r);t.operator=d;t.prefix=false;t.argument=r;On(r);gn();r=xn(t,"UpdateExpression")}return r}function Vn(){return $n(Jn())}function $n(e,t){if(Nn(ct)){var n=Sn(e);n.object=e;n.property=er(true);n.computed=false;return $n(xn(n,"MemberExpression"),t)}else if(Nn(nt)){var n=Sn(e);n.object=e;n.property=qn();n.computed=true;Ln(rt);return $n(xn(n,"MemberExpression"),t)}else if(!t&&Nn(ot)){var n=Sn(e);n.callee=e;n.arguments=Zn(ut,false);return $n(xn(n,"CallExpression"),t)}else return e}function Jn(){switch(p){case Q:var e=En();gn();return xn(e,"ThisExpression");case L:return er();case N:case k:case C:var e=En();e.value=d;e.raw=n.slice(f,l);gn();return xn(e,"Literal");case G:case Y:case Z:var e=En();e.value=p.atomValue;e.raw=p.keyword;gn();return xn(e,"Literal");case ot:var r=c,i=f;gn();var s=qn();s.start=i;s.end=l;if(t.locations){s.loc.start=r;s.loc.end=h}if(t.ranges)s.range=[i,l];Ln(ut);return s;case nt:var e=En();gn();e.elements=Zn(rt,true,true);return xn(e,"ArrayExpression");case it:return Qn();case q:var e=En();gn();return Yn(e,false);case K:return Kn();default:An()}}function Kn(){var e=En();gn();e.callee=$n(Jn(),true);if(Nn(ot))e.arguments=Zn(ut,false);else e.arguments=[];return xn(e,"NewExpression")}function Qn(){var e=En(),n=true,r=false;e.properties=[];gn();while(!Nn(st)){if(!n){Ln(at);if(t.allowTrailingCommas&&Nn(st))break}else n=false;var i={key:Gn()},s=false,o;if(Nn(lt)){i.value=qn(true);o=i.kind="init"}else if(t.ecmaVersion>=5&&i.key.type==="Identifier"&&(i.key.name==="get"||i.key.name==="set")){s=r=true;o=i.kind=i.key.name;i.key=Gn();if(p!==ot)An();i.value=Yn(En(),false)}else An();if(i.key.type==="Identifier"&&(x||r)){for(var u=0;u<e.properties.length;++u){var a=e.properties[u];if(a.key.name===i.key.name){var f=o==a.kind||s&&a.kind==="init"||o==="init"&&(a.kind==="get"||a.kind==="set");if(f&&!x&&o==="init"&&a.kind==="init")f=false;if(f)T(i.key.start,"Redefinition of property")}}}e.properties.push(i)}return xn(e,"ObjectExpression")}function Gn(){if(p===N||p===k)return Jn();return er(true)}function Yn(e,t){if(p===L)e.id=er();else if(t)An();else e.id=null;e.params=[];var n=true;Ln(ot);while(!Nn(ut)){if(!n)Ln(at);else n=false;e.params.push(er())}var r=E,i=S;E=true;S=[];e.body=Bn(true);E=r;S=i;if(x||e.body.body.length&&Tn(e.body.body[0])){for(var s=e.id?-1:0;s<e.params.length;++s){var o=s<0?e.id:e.params[s];if(_t(o.name)||Dt(o.name))T(o.start,"Defining '"+o.name+"' in strict mode");if(s>=0)for(var u=0;u<s;++u)if(o.name===e.params[u].name)T(o.start,"Argument name clash in strict mode")}}return xn(e,t?"FunctionDeclaration":"FunctionExpression")}function Zn(e,n,r){var i=[],s=true;while(!Nn(e)){if(!s){Ln(at);if(n&&t.allowTrailingCommas&&Nn(e))break}else s=false;if(r&&p===at)i.push(null);else i.push(qn(true))}return i}function er(e){var n=En();n.name=p===L?d:e&&!t.forbidReserved&&p.keyword||An();gn();return xn(n,"Identifier")}e.version="0.1.01";var t,n,r,i;e.parse=function(e,i){n=String(e);r=n.length;o(i);Xt();return Mn(t.program)};var s=e.defaultOptions={ecmaVersion:5,strictSemicolons:false,allowTrailingCommas:true,forbidReserved:false,locations:false,onComment:null,ranges:false,program:null,sourceFile:null};var u=e.getLineInfo=function(e,t){for(var n=1,r=0;;){Rt.lastIndex=r;var i=Rt.exec(e);if(i&&i.index<t){++n;r=i.index+i[0].length}else break}return{line:n,column:t-r}};e.tokenize=function(e,i){function u(e){on(e);s.start=f;s.end=l;s.startLoc=c;s.endLoc=h;s.type=p;s.value=d;return s}n=String(e);r=n.length;o(i);Xt();var s={};u.jumpTo=function(e,r){a=e;if(t.locations){m=g=Rt.lastIndex=0;var i;while((i=Rt.exec(n))&&i.index<e){++m;g=i.index+i[0].length}}var s=n.charAt(e-1);v=r;Kt()};return u};var a;var f,l;var c,h;var p,d;var v;var m,g;var y,b,w;var E,S,x;var N={type:"num"},C={type:"regexp"},k={type:"string"};var L={type:"name"},A={type:"eof"};var O={keyword:"break"},M={keyword:"case",beforeExpr:true},_={keyword:"catch"};var D={keyword:"continue"},P={keyword:"debugger"},H={keyword:"default"};var B={keyword:"do",isLoop:true},j={keyword:"else",beforeExpr:true};var F={keyword:"finally"},I={keyword:"for",isLoop:true},q={keyword:"function"};var R={keyword:"if"},U={keyword:"return",beforeExpr:true},z={keyword:"switch"};var W={keyword:"throw",beforeExpr:true},X={keyword:"try"},V={keyword:"var"};var $={keyword:"while",isLoop:true},J={keyword:"with"},K={keyword:"new",beforeExpr:true};var Q={keyword:"this"};var G={keyword:"null",atomValue:null},Y={keyword:"true",atomValue:true};var Z={keyword:"false",atomValue:false};var et={keyword:"in",binop:7,beforeExpr:true};var tt={"break":O,"case":M,"catch":_,"continue":D,"debugger":P,"default":H,"do":B,"else":j,"finally":F,"for":I,"function":q,"if":R,"return":U,"switch":z,"throw":W,"try":X,"var":V,"while":$,"with":J,"null":G,"true":Y,"false":Z,"new":K,"in":et,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:true},"this":Q,"typeof":{keyword:"typeof",prefix:true,beforeExpr:true},"void":{keyword:"void",prefix:true,beforeExpr:true},"delete":{keyword:"delete",prefix:true,beforeExpr:true}};var nt={type:"[",beforeExpr:true},rt={type:"]"},it={type:"{",beforeExpr:true};var st={type:"}"},ot={type:"(",beforeExpr:true},ut={type:")"};var at={type:",",beforeExpr:true},ft={type:";",beforeExpr:true};var lt={type:":",beforeExpr:true},ct={type:"."},ht={type:"?",beforeExpr:true};var pt={binop:10,beforeExpr:true},dt={isAssign:true,beforeExpr:true};var vt={isAssign:true,beforeExpr:true},mt={binop:9,prefix:true,beforeExpr:true};var gt={postfix:true,prefix:true,isUpdate:true},yt={prefix:true,beforeExpr:true};var bt={binop:1,beforeExpr:true},wt={binop:2,beforeExpr:true};var Et={binop:3,beforeExpr:true},St={binop:4,beforeExpr:true};var xt={binop:5,beforeExpr:true},Tt={binop:6,beforeExpr:true};var Nt={binop:7,beforeExpr:true},Ct={binop:8,beforeExpr:true};var kt={binop:10,beforeExpr:true};e.tokTypes={bracketL:nt,bracketR:rt,braceL:it,braceR:st,parenL:ot,parenR:ut,comma:at,semi:ft,colon:lt,dot:ct,question:ht,slash:pt,eq:dt,name:L,eof:A,num:N,regexp:C,string:k};for(var Lt in tt)e.tokTypes[Lt]=tt[Lt];var Ot=At("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile");var Mt=At("class enum extends super const export import");var _t=At("implements interface let package private protected public static yield");var Dt=At("eval arguments");var Pt=At("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this");var Ht=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/;var Bt="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ";var jt="ͱ-ʹ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿";var Ft=new RegExp("["+Bt+"]");var It=new RegExp("["+Bt+jt+"]");var qt=/[\n\r\u2028\u2029]/;var Rt=/\r\n|[\n\r\u2028\u2029]/g;var dn;var _n={kind:"loop"},Dn={kind:"switch"}});(function(e){if(typeof window==="undefined"){window=this}$data=window["$data"]||(window["$data"]=function t(){if(this instanceof t){var e=t["implementation"].apply(this,arguments);return new e(arguments[1])}else{return t["implementation"].apply(this,arguments)}})})(this);if(typeof console==="undefined"){console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}}}if(!console.warn)console.warn=function(){};if(!console.error)console.error=function(){};(function(e){e.__namespace=true;e.version="JayData 1.3.2";e.versionNumber="1.3.2";e.root={};e.Acorn=e.Acorn||(typeof acorn=="object"?acorn:undefined);e.Esprima=e.Esprima||(typeof esprima=="object"?esprima:undefined)})($data);Exception=function(e,t,n){Error.call(this);if(Error.captureStackTrace)Error.captureStackTrace(this,this.constructor);this.name=t||"Exception";this.message=e;this.data=n};Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){var e=[];var t=false};Guard={};Guard.requireValue=function(e,t){if(typeof t==="undefined"||t===null){Guard.raise(e+" requires a value other than undefined or null")}};Guard.requireType=function(e,t,n){var r=n instanceof Array?n:[n];return r.some(function(n){switch(typeof n){case"string":return typeof t===n;case"function":return t instanceof n;default:Guard.raise("Unknown type format : "+typeof n+" for: "+e)}})};Guard.raise=function(e){if(typeof intellisense==="undefined"){if(e instanceof Exception){console.error(e.name+":",e.message+"\n",e)}else{console.error(e)}throw e}};Object.isNullOrUndefined=function(e){return e===undefined||e===null};(function(){if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function(e){var t=[];for(var n in e){if(e.hasOwnProperty(n))t.push(n)}return t}}if(!Object.create){Object.create=function(e){function t(){}if(arguments.length>1){Guard.raise(new Error("Object.create implementation only accepts the first parameter."))}t.prototype=e;return new t}}if(!Object.keys){var t=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=r.length;Object.keys=function(e){if(typeof e!=="object"&&typeof e!=="function"||e===null)Guard.raise(new TypeError("Object.keys called on non-object"));var s=[];for(var o in e){if(t.call(e,o)){s.push(o)}}if(n){for(var u=0;u<i;u++){if(t.call(e,r[u])){s.push(r[u])}}}return s}}if(!Object.defineProperty){Object.defineProperty=function(e,t,n){e[t]=n.value||{}}}if(!Object.defineProperties){Object.defineProperties=function(e,t){for(var n in t){if(t.hasOwnProperty(n))e[n]=t[n].value||{}}}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;n++){if(t){e.call(t,this[n],n,this)}else{e(this[n],n,this)}}}}if(!Array.prototype.filter){Array.prototype.filter=function(e,t){var n=[];for(var r=0,i=this.length;r<i;r++){var s=t?e.call(t,this[r],r,this):e(this[r],r,this);if(s===true){n.push(this[r])}}return n}}if(!Array.prototype.map){Array.prototype.map=function(e,t){var n=[];for(var r=0,i=this.length;r<i;r++){var s=t?e.call(t,this[r],r,this):e(this[r],r,this);n.push(s)}return n}}if(!Array.prototype.some){Array.prototype.some=function(e,t){for(var n=0,r=this.length;n<r;n++){var i=t?e.call(t,this[n],n,this):e(this[n],n,this);if(i){return true}}return false}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e,t){for(var n=0,r=this.length;n<r;n++){if(this[n]===e){return n}}return-1}}if(!String.prototype.trimLeft){String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}}if(!String.prototype.trimRight){String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}}if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i}}if(typeof Uint8Array=="undefined"){Uint8Array=function(e){if(e instanceof Uint8Array)return e;var t=this;var n=Array.isArray(e)?e:new Array(e);this.length=n.length;this.byteLength=this.length;this.byteOffset=0;this.buffer={byteLength:t.length};var r=function(e){return n[e]};var i=function(e,t){n[e]=(t|0)&255};var s=function(e){n[e]=n[e]||0;Object.defineProperty(t,e,{enumerable:true,configurable:false,get:function(){if(isNaN(+e)||(e|0)<0||(e|0)>=t.length){try{if(typeof document!="undefined")document.createTextNode("").splitText(1);return new RangeError("INDEX_SIZE_ERR")}catch(n){return n}}return r(e)},set:function(n){if(isNaN(+e)||(e|0)<0||(e|0)>=t.length){try{if(typeof document!="undefined")document.createTextNode("").splitText(1);return new RangeError("INDEX_SIZE_ERR")}catch(r){return r}}i(e|0,n)}})};for(var o=0;o<t.length;o++){s(o)}}}})();(function(t,n){function r(e){if(typeof intellisense!=="undefined"){if(!intellisense.i){intellisense.i=0}intellisense.i=intellisense.i+1;intellisense.logMessage(e+":"+intellisense.i)}}function i(e,n){this.kind=a.property;Object.defineProperty(this,"definedBy",{value:n,enumerable:false,configurable:false,writable:false});if(e){if(typeof e==="function"||typeof e.asFunction==="function"){this.method=e;this.kind=a.method}else{this.enumerable=true;this.configurable=true;if(typeof e==="number"){this.value=e;this.type=t.Number;this.dataType=t.Number}else if(typeof e==="string"){this.value=e;this.dataType=t.String;this.type=t.String}else{for(var r in e){if(e.hasOwnProperty(r)){this[r]=e[r]}}}}if(this.type!==undefined){this.dataType=this.dataType||this.type}else{this.type=this.dataType}this.originalType=this.type;if(this.elementType!==undefined){this.originalElementType=this.elementType}}}function o(){}function u(){this.classNames={}}function a(){}function f(e){function l(e,t){f[e]=f[e]||[];f[e].push(t)}var n=e;if(n){n.addChildContainer(this)}var r={};var i=[];var s=[];this.classNames=r;this.consolidatedClassNames=i;this.classTypes=s;var o=[];this.mappedTo=o;var u=this;this["holder"]=null;var a=function(e,t){var n=u.resolveType(e);var r=Object.create(n.prototype);n.apply(r,t);return r};var f={};this.pendingResolutions=f;this.addChildContainer=function(e){};this.createInstance=function(e,t){return a(e,t)};this.mapType=function(e,t){Guard.requireValue("aliasType",e);Guard.requireValue("realType",t);var n=this.getType(e);var r=this.getType(t);var i=s.indexOf(n);var u=s.indexOf(r);o[i]=u},this.isPrimitiveType=function(e){var n=this.resolveType(e);switch(true){case n===Number:case n===String:case n===Date:case n===Boolean:case n===Array:case n===Object:case n===t.Number:case n===t.Integer:case n===t.Date:case n===t.String:case n===t.Boolean:case n===t.Array:case n===t.Object:case n===t.Guid:case n===t.Byte:case n===t.SByte:case n===t.Decimal:case n===t.Float:case n===t.Int16:case n===t.Int32:case n===t.Int64:case n===t.DateTimeOffset:case n===t.Time:case n===t.SimpleBase:case n===t.Geospatial:case n===t.GeographyBase:case n===t.GeographyPoint:case n===t.GeographyLineString:case n===t.GeographyPolygon:case n===t.GeographyMultiPoint:case n===t.GeographyMultiLineString:case n===t.GeographyMultiPolygon:case n===t.GeographyCollection:case n===t.GeometryBase:case n===t.GeometryPoint:case n===t.GeometryLineString:case n===t.GeometryPolygon:case n===t.GeometryMultiPoint:case n===t.GeometryMultiLineString:case n===t.GeometryMultiPolygon:case n===t.GeometryCollection:return true;default:return false}};this.resolveName=function(e){var t=this.resolveType(e);var n=s.indexOf(t);return i[n]};this.resolveType=function(e,t){var n=e;n=this.getType(n,t?true:false,t);var r=s.indexOf(n);return typeof o[r]==="undefined"?n:s[o[r]]};this.getType=function(e,t,i){Guard.requireValue("typeOrName",e);if(typeof e==="function"){return e}if(!(e in r)){if(n){var o=n.getType(e,true);if(o)return o}if(i){l(e,i);return}else if(t){return undefined}else{Guard.raise(new Exception("Unable to resolve type:"+e))}}var u=s[r[e]];if(i){i(u)}return u};this.getName=function(e){var t=this.getType(e);var n=s.indexOf(t);if(n==-1)Guard.raise("unknown type to request name for: "+e);return i[n]};this.getTypes=function(){var e=Object.keys(r);var t=[];for(var n=0;n<e.length;n++){var i=e[n];t.push({name:i,type:s[r[i]],toString:function(){return this.name}})}return t};this.getTypeName=function(e){switch(typeof e){case"object":if(e==null)return"$data.Object";if(e instanceof Array)return"$data.Array";if(e.getType)return e.getType().fullName;if(e instanceof Date)return"$data.Date";if(e instanceof t.Guid)return"$data.Guid";if(e instanceof t.DateTimeOffset)return"$data.DateTimeOffset";if(e instanceof t.GeographyPoint)return"$data.GeographyPoint";if(e instanceof t.GeographyLineString)return"$data.GeographyLineString";if(e instanceof t.GeographyPolygon)return"$data.GeographyPolygon";if(e instanceof t.GeographyMultiPoint)return"$data.GeographyMultiPoint";if(e instanceof t.GeographyMultiLineString)return"$data.GeographyMultiLineString";if(e instanceof t.GeographyMultiPolygon)return"$data.GeographyMultiPolygon";if(e instanceof t.GeographyCollection)return"$data.GeographyCollection";if(e instanceof t.GeographyBase)return"$data.GeographyBase";if(e instanceof t.GeometryPoint)return"$data.GeometryPoint";if(e instanceof t.GeometryLineString)return"$data.GeometryLineString";if(e instanceof t.GeometryPolygon)return"$data.GeometryPolygon";if(e instanceof t.GeometryMultiPoint)return"$data.GeometryMultiPoint";if(e instanceof t.GeometryMultiLineString)return"$data.GeometryMultiLineString";if(e instanceof t.GeometryMultiPolygon)return"$data.GeometryMultiPolygon";if(e instanceof t.GeometryCollection)return"$data.GeometryCollection";if(e instanceof t.GeometryBase)return"$data.GeometryBase";if(e instanceof t.Geospatial)return"$data.Geospatial";if(e instanceof t.SimpleBase)return"$data.SimpleBase";if(typeof e.toHexString==="function")return"$data.ObjectID";default:return typeof e}};this.isTypeRegistered=function(e){if(typeof e==="function"){return s.indexOf(e)>-1}else{return e in r}};this.unregisterType=function(e){Guard.raise("Unimplemented")};this.getDefault=function(e){var n=this.resolveType(e);switch(n){case t.Number:return 0;case t.Float:return 0;case t.Decimal:return"0.0";case t.Integer:return 0;case t.Int16:return 0;case t.Int32:return 0;case t.Int64:return"0";case t.Byte:return 0;case t.SByte:return 0;case t.String:return null;case t.Boolean:return false;default:return null}};this.getIndex=function(e){var t=this.resolveType(e);return s.indexOf(t)};this.resolveByIndex=function(e){return s[e]};this.registerType=function(e,t,o){if(!e){return}if(typeof t==="string"){t=u.resolveType(t)}var l=[];if(typeof e==="string"){var c=[];c.push(e);l=c}else{l=e}for(var h=0;h<l.length;h++){var p=l[h].split(".");var d={};d.shortName=p[p.length-1];d.fullName=l[h];l[h]=d}var v=function(){return a(t,arguments)};if(typeof intellisense!=="undefined"){intellisense.annotate(v,t)}for(var h=0,m=l.length;h<m;h++){var d=l[h];if(!("create"+d.shortName in u)){if(typeof o==="function"){u["create"+d.shortName]=o}else{u["create"+d.shortName]=v}}var g=s.indexOf(t);if(g==-1){g=s.push(t)-1;var y=d.fullName;i[g]=d.fullName}r[d.fullName]=g;var b=f[d.fullName]||[];if(b.length>0){b.forEach(function(e){e(t)});f[d.fullName]=[]}}if(n){n.registerType.apply(n,arguments)}if(!t.name){t.name=l[0].shortName}};var c={from:{},to:{}};this.converters=c;this.convertTo=function(e,n,r,i){Guard.requireValue("typeOrName",n);if(Object.isNullOrUndefined(e))return e;var s=Container.getTypeName(e);var o=Container.resolveType(s);var s=Container.resolveName(o);var u=Container.resolveType(n);var a=Container.resolveName(u);var f;try{if(typeof u["from"+s]==="function"){f=u["from"+s].apply(u,arguments)}else if(typeof o["to"+a]==="function"){f=o["to"+a].apply(o,arguments)}else if(c.to[a]&&c.to[a][s]){f=c.to[a][s].apply(c,arguments)}else if(c.from[s]&&c.from[s][a]){f=c.from[s][a].apply(c,arguments)}else if(a===s||e instanceof u){f=e}else if(c.to[a]&&c.to[a]["default"]){f=c.to[a]["default"].apply(c,arguments)}else{throw"converter not found"}}catch(l){Guard.raise(new Exception("Value '"+s+"' not convertable to '"+a+"'","TypeError",e))}if(u===t.Array&&r&&Array.isArray(f)){for(var h=0;h<f.length;h++){f[h]=this.convertTo.call(this,f[h],r,undefined,i)}}return f};this.registerConverter=function(e,n,r,i){var s=Container.resolveName(e);if(Container.isTypeRegistered(n)){c.to[s]=c.to[s]||{};c.from[s]=c.from[s]||{};var o=Container.resolveName(n);if(r)c.to[s][o]=r;if(i)c.from[s][o]=i}else{if(c.to[s]){c.to[s]=t.typeSystem.extend(c.to[s],n)}else{c.to[s]=n}if(c.from[s]){c.from[s]=t.typeSystem.extend(c.from[s],r)}else{c.from[s]=r}}}}i.prototype.createPropertyDescriptor=function(e,t){var n=this;var r={enumerable:this.enumerable==undefined?true:this.enumerable,configurable:this.configurable==undefined?true:this.configurable};if(this.set&&this.get){r.set=this.set;r.get=this.get}else if("value"in this||t){r.value=t||this.value;r.writable=true}else{r.set=function(e){this.storeProperty(n,e)};r.get=function(){return this.retrieveProperty(n)}}return r};i.prototype.createStorePropertyDescriptor=function(e){var t=this;return{enumerable:false,writable:true,configurable:t.configurable,value:e}};i.prototype.createGetMethod=function(){var e=this;return{enumerable:false,writable:false,configurable:false,value:function(t,n){return this.getProperty(e,t,n)}}};i.prototype.createSetMethod=function(){var e=this;return{enumerable:false,writable:false,configurable:false,value:function(t,n,r){return this.setProperty(e,t,n,r)}}};i.translateDefinition=function(e,n,r){function f(e){if(e&&e.isAssignableTo&&t.Entity&&e.isAssignableTo(t.Entity)){r.childResolverThunks.push(function(){if(e.resolveForwardDeclarations){e.resolveForwardDeclarations()}})}}var s=r;var o;if(e.type&&Container.isTypeRegistered(e.type)){s=Container.resolveType(e.type);if(typeof s.translateDefinition==="function"){o=s.translateDefinition.apply(s,arguments);o.name=o.name||n}else{s=r}}if(!(o instanceof i)){o=new i(o||e,s);o.name=n}r.resolverThunks=r.resolverThunks||[];r.childResolverThunks=r.childResolverThunks||[];var u=o.type;var a=o.elementType;f(u);f(a);if("string"===typeof u){if("@"===u[0]){o.type=u.substr(1);o.dataType=u.substr(1)}else{r.resolverThunks.push(function(){var e=r.container.resolveType(u);f(e);o.type=e;o.dataType=e})}}if(a){if("string"===typeof a){if("@"===a[0]){o.elementType=a.substr(1)}else{r.resolverThunks.push(function(){var e=r.container.resolveType(a);f(e);o.elementType=e})}}}r.resolveForwardDeclarations=function(){r.resolveForwardDeclarations=function(){};t.Trace.log("resolving: "+r.fullName);this.resolverThunks.forEach(function(e){e()});this.childResolverThunks.forEach(function(e){e()})};return o};i.prototype.toJSON=function(){var e={};for(var t in this){if(t!=="defineBy"&&t!=="storageModel"){e[t]=this[t]}}return e};t.MemberDefinition=window["MemberDefinition"]=i;var s="$";o.prototype={clearCache:function(){this.arrayCache=undefined;this.pubMapPropsCache=undefined;this.keyPropsCache=undefined;this.propByTypeCache=undefined;this.pubMapMethodsCache=undefined;this.pubMapPropNamesCache=undefined},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var e in this){if(e.indexOf(s)===0)this.arrayCache.push(this[e])}}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var e in this){if(e.indexOf(s)===0&&this[e].kind=="property"&&!this[e].notMapped&&this[e].enumerable)this.pubMapPropsCache.push(this[e])}}return this.pubMapPropsCache},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=[];for(var e in this){if(e.indexOf(s)===0&&this[e].kind=="property"&&!this[e].notMapped&&this[e].enumerable)this.pubMapPropNamesCache.push(this[e].name)}}return this.pubMapPropNamesCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var e in this){if(e.indexOf(s)===0&&this[e].kind=="property"&&this[e].key)this.keyPropsCache.push(this[e])}}return this.keyPropsCache},getPublicMappedMethods:function(){if(!this.pubMapMethodsCache){this.pubMapMethodsCache=[];for(var e in this){if(e.indexOf(s)===0&&this[e].kind=="method"&&this[e].method)this.pubMapMethodsCache.push(this[e])}}return this.pubMapMethodsCache},getPropertyByType:function(e){if(!this.propByTypeCache){this.propByTypeCache=[];for(var t in this){if(t.indexOf(s)===0&&this[t].dataType==e)this.propByTypeCache.push(this[t])}}return this.propByTypeCache},getMember:function(e){return this[s+e]},setMember:function(e){this[s+e.name]=e}};o.prototype.constructor=o;t.MemberDefinitionCollection=window["MemberDefinitionCollection"]=o;a.__enum=true;a.method="method";a.property="property";a.navProperty="navProperty";a.complexProperty="complexProperty";a.field="field";t.MemberTypes=a;u.prototype={define:function(e,t,n,r,i){return this.defineEx(e,[{type:t}],n,r,i)},defineEx:function(e,n,r,i,s){r=r||t.Container;if(n.length==0){n.push({type:t.Base})}else if(n.length>0&&!n[0].type){n[0].type=t.Base}for(var o=0,u=n.length;o<u;o++){if(typeof n[o]==="function")n[o]={type:n[o]}}var a=i?i.constructor:undefined;var f=e.split(".");var l=f.splice(f.length-1,1)[0];var c=r===t.Container?window:r;for(var o=0;o<f.length;o++){var h=f[o];if(!c[h]){var p={};p.__namespace=true;c[h]=p}c=c[h]}var d=null;d=this.classFunctionBuilder(l,n,s,i);d.fullName=e;d.namespace=f.join(".");d.name=l;d.container=r;d.container.registerType(e,d);this.buildType(d,n,i,s);if(typeof intellisense!=="undefined"){if(i&&i.constructor){intellisense.annotate(d,i.constructor)}}c[l]=this.classNames[e]=d;var v=d.baseTypes.length;for(var o=0;o<v;o++){var m=d.baseTypes[o];if("inheritedTypeProcessor"in m){m.inheritedTypeProcessor(d)}}return d},classFunctionBuilder:function(e,t,n,r){var i=this.bodyBuilder(t,n,r);return(new Function("base","classDefinition","instanceDefinition","name","return function "+e+" (){ "+i+" \n}; "))(t,n,r,e)},bodyBuilder:function(e,n,r){var i="";var s="";var o="";for(var u=0,a=e.length;u<a;u++){var f=e[u];var l=u;if(l==0){if(f&&f.type&&f.type!==t.Base&&f.type.fullName){s+="    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+l+"].params, this); \n";s+="    "+f.type.fullName+".apply(this, baseArguments); \n"}}else{if(f&&f.type&&f.propagateTo){o+="    "+(!o?"var ":""+"")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+l+"].params, this); \n";o+='    this["'+f.propagateTo+'"] =  Object.create('+f.type.fullName+".prototype); \n"+"    "+f.type.fullName+'.apply(this["'+f.propagateTo+'"], propagationArguments); \n'}else if(f&&f.type&&f.type.memberDefinitions&&f.type.memberDefinitions.$constructor&&!f.propagateTo){i+="    "+f.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n"}}}if(r&&r.constructor!=Object)s+="    instanceDefinition.constructor.apply(this, arguments); \n";return"\n    //mixins \n"+i+"\n    //construction \n"+s+"\n    //propagations \n"+o},buildType:function(e,t,n,r){var i=t[0].type;e.inheritsFrom=i;if(i){e.prototype=Object.create(i.prototype);e.memberDefinitions=Object.create(i.memberDefinitions||new o);e.memberDefinitions.clearCache();var s=i.staticDefinitions;if(s){s=s.asArray();if(s){for(var u=0;u<s.length;u++){this.buildMember(e,s[u],undefined,"staticDefinitions")}}}e.baseTypes=i.baseTypes?[].concat(i.baseTypes):[];for(var u=0;u<t.length;u++){e.baseTypes.push(t[u].type)}if(!e.isAssignableTo){Object.defineProperty(e,"isAssignableTo",{value:function(e){return this===e||this.baseTypes.indexOf(e)>=0},writable:false,enumerable:false,configurable:false})}}if(r){this.buildStaticMembers(e,r);if(r.constructor)e.classConstructor=r.constructor}if(n){this.buildInstanceMembers(e,n)}var a=[].concat(t);a.shift();if(Object.keys(a).length>0)this.buildInstanceMixins(e,a);e.__class=true;e.prototype.constructor=e;Object.defineProperty(e.prototype,"getType",{value:function(){return e},writable:false,enumerable:false,configurable:false})},addMethod:function(e,t,n,r){if(!r||typeof intellisense!=="undefined"){e[t]=n}else{e[t]=function(){return n.apply(this[r],arguments)}}},addProperty:function(e,t,n,r){if(r){n.configurable=true;if(n.get){var i=n.get;n.get=function(){if(!this[r])Guard.raise(new Exception("not inicialized"));return i.apply(this[r],arguments)}}if(n.set){var s=n.set;n.set=function(){if(!this[r])Guard.raise(new Exception("not inicialized"));s.apply(this[r],arguments)}}}Object.defineProperty(e,t,n)},addField:function(e,t,n){Guard.raise("not implemented")},buildMethod:function(e,t,n){var r=t.classMember?e:e.prototype;this.addMethod(r,t.name,t.method,n)},buildProperty:function(e,t,n){var r=t.classMember?e:e.prototype;var i=t.createPropertyDescriptor(e);this.addProperty(r,t.name,i,n);if(!t.classMember&&e.__setPropertyfunctions==true&&t.withoutGetSetMethod!==true&&!("get_"+t.name in r||"set_"+t.name in r)){var s=t.createGetMethod();this.addProperty(r,"get_"+t.name,s,n);var o=t.createSetMethod();this.addProperty(r,"set_"+t.name,o,n)}},buildMember:function(e,t,n,r){r=r||"memberDefinitions";e[r]=e[r]||new o;e[r].setMember(t);switch(t.kind){case a.method:this.buildMethod(e,t,n);break;case a.navProperty:case a.complexProperty:case a.property:this.buildProperty(e,t,n);break;default:Guard.raise("Unknown member type: "+t.kind+","+t.name)}},buildStaticMembers:function(e,t){var n=this;for(var r in t){if(t.hasOwnProperty(r)){var s=i.translateDefinition(t[r],r,e);s.classMember=true;n.buildMember(e,s,undefined,"staticDefinitions")}}},buildInstanceMembers:function(e,t){var n=this;for(var r in t){if(t.hasOwnProperty(r)){var s=i.translateDefinition(t[r],r,e);n.buildMember(e,s,undefined,"memberDefinitions")}}},copyMembers:function(e,t){function n(e){if(typeof intellisense==="undefined"){return}intellisense.logMessage(e)}Object.keys(e.prototype).forEach(function(r,i,s){if(r!=="constructor"&&r!=="toString"){n("copying item:"+r);t.prototype[r]=e[r]}})},buildInstanceMixins:function(e,t){e.mixins=e.mixins||[];e.propagations=e.propagations||[];for(var n=0;n<t.length;n++){var r=t[n];if(r.propagateTo){this.buildInstancePropagation(e,r);e.propagations.push(r);e.propagations[r.type.name]=true}else{this.buildInstanceMixin(e,r);e.mixins.push(r);e.mixins[r.type.name]=true}}},buildInstanceMixin:function(e,t){var n=t.type.memberDefinitions.asArray();for(var r=0,i=n.length;r<i;r++){var s=n[r].name;if(s!=="constructor"&&!e.memberDefinitions.getMember(s)){this.buildMember(e,n[r])}}if(t.type.staticDefinitions){var o=t.type.staticDefinitions.asArray();for(var r=0,i=o.length;r<i;r++){var s=o[r].name;if(s!=="constructor"&&!e.memberDefinitions.getMember(s)){this.buildMember(e,o[r],undefined,"staticDefinitions")}}}},buildInstancePropagation:function(e,t){var n=t.type.memberDefinitions.asArray();for(var r=0,i=n.length;r<i;r++){var s=n[r].name;if(s!=="constructor"&&!e.memberDefinitions.getMember(s)){this.buildMember(e,n[r],t.propagateTo)}}}};t.Class=Class=new u;n=window;t.ContainerClass=f;var l;n["Container"]=t.Container=l=n["C$"]=new f;t.createContainer=function(){return new f(t.Container)};n["$C"]=function(){Class.define.apply(Class,arguments)};var c=function(e,t){var n="_"+e.name;if(!this[n]){Object.defineProperty(this,n,e.createStorePropertyDescriptor(t))}else{this[n]=t}};var h=function(e){var t="_"+e.name;return this[t]};t.Class.define("$data.Base",function(){},null,{storeProperty:c,retrieveProperty:h,setProperty:function(e,t,n){this[e.name]=t;n()},getProperty:function(e,t){t.apply(this,[this[e.name]])}},{create:function(){return Container.createInstance(this,arguments)},extend:function(e,n,r,i){if(n&&!(n instanceof f)){i=r;r=n;n=undefined}return t.Class.define(e,this,n,r,i)},getMemberDefinition:function(e){return this.memberDefinitions.getMember(e)},addProperty:function(e,n,r,s){var o=n;var u=r;var a;if(typeof o==="string"){a=n;o=r;u=s}var f={notMapped:true,storeOnObject:true,get:typeof o==="function"?o:function(){},set:typeof u==="function"?u:function(){},type:a};var l=i.translateDefinition(f,e,this);t.Class.buildMember(this,l);this.memberDefinitions.clearCache();return this},addMember:function(e,n,r){var s=i.translateDefinition(n,e,this);if(r){s.classMember=true;t.Class.buildMember(this,s,undefined,"staticDefinitions");this.staticDefinitions.clearCache()}else{t.Class.buildMember(this,s);this.memberDefinitions.clearCache()}return this},describeField:function(e,t){var n=this.memberDefinitions.getMember(e);if(!n){this.addMember(e,t)}else{Guard.raise(new Exception("Field '"+e+"' already defined!","Invalid operation"))}return this},storeProperty:c,retrieveProperty:h,"from$data.Object":function(e){return e}});t.Class.ConstructorParameter=ConstructorParameter=t.Class.define("ConstructorParameter",null,null,{constructor:function(e){this.paramIndex=e},paramIndex:{}})})($data,window);$data.defaultErrorCallback=function(){if(arguments.length>0&&arguments[arguments.length-1]&&typeof arguments[arguments.length-1].reject==="function"){(console.error||console.log).call(console,arguments[0]);arguments[arguments.length-1].reject.apply(arguments[arguments.length-1],arguments)}else{if(arguments[0]instanceof Error){Guard.raise(arguments[0])}else{Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))}}};$data.defaultSuccessCallback=function(){};$data.defaultNotifyCallback=function(){};$data.typeSystem={__namespace:true,extend:function(e){if(typeof e!=="object"&&typeof e!=="function")Guard.raise("Target must be object or function");for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n===null||typeof n==="undefined")continue;for(key in n){e[key]=n[key]}}return e},createCallbackSetting:function(e,t){function i(e){function n(){e.apply(t,arguments);e=function(){}}var t=this;return n}var n={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};if(t!=undefined&&t!=null){n=t}var r;if(e==null||e==undefined){r=n}else if(typeof e=="function"){r=this.extend(n,{success:e})}else{r=this.extend(n,e)}if(typeof r.error==="function")r.error=i(r.error);return r},createCtorParams:function(e,t,n){if(t){var r=[];for(var i=0,s=t.length;i<s;i++){var o=i;if(t[o]instanceof ConstructorParameter)r.push(e[t[o].paramIndex]);else if(typeof t[o]==="function")r.push(t[o].apply(n));else r.push(t[o])}return r}return e},writePropertyValues:function(e){if(e&&e.getType&&e.getType().memberDefinitions){this.writeProperties(e,e.getType().memberDefinitions.asArray().filter(function(e){return(e.kind=="property"||e.kind=="navProperty"||e.kind=="complexProperty")&&!e.prototypeProperty}))}},writeProperties:function(e,t){var n={};for(var r=0,i=t.length;r<i;r++){var s=t[r];n[s.name]=s.createPropertyDescriptor(null,s.value)}Object.defineProperties(e,n)},writeProperty:function(e,t,n){var r=typeof t==="string"?e.getType().memberDefinitions.getMember(t):t;if(r){var i=r.createPropertyDescriptor(null,n);Object.defineProperty(e,r.name,i)}}};$data.debug=function(){(console.debug||console.log).apply(console,arguments)};$data.debugWith=function(){var e=arguments;return function(t){(console.debug||console.log).apply(console,e);if(typeof Error!=="undefined"&&t instanceof Error||typeof Exception!=="undefined"&&t instanceof Exception){(console.error||console.log).apply(console,arguments)}else{(console.debug||console.log).apply(console,arguments)}}};$data.fdebug={success:$data.debugWith("success"),error:$data.debugWith("error")};$data.Number=typeof Number!=="undefined"?Number:function(){};$data.Date=typeof Date!=="undefined"?Date:function(){};$data.String=typeof String!=="undefined"?String:function(){};$data.Boolean=typeof Boolean!=="undefined"?Boolean:function(){};$data.Array=typeof Array!=="undefined"?Array:function(){};$data.Object=typeof Object!=="undefined"?Object:function(){};$data.Function=Function;$data.Byte=function(){};$data.SByte=function(){};$data.Decimal=function(){};$data.Float=$data.Single=function(){};$data.Integer=function(){};$data.Int16=function(t){};$data.Int32=function(){};$data.Int64=function(t){};$data.ObjectID=typeof $data.mongoDBDriver!=="undefined"&&typeof $data.mongoDBDriver.ObjectID!=="undefined"?$data.mongoDBDriver.ObjectID:function(){};$data.Time=function(){};$data.DateTimeOffset=function(t){this.value=t};$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value};$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number);$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer);$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32);$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte);$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte);$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal);$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float);$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16);$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64);$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String);$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(undefined,arguments)});$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time);$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset);$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);$data.Container.registerType(["$data.Function","Function","function"],$data.Function);$data.Container.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],$data.ObjectID);$data.Class.define("$data.TraceBase",null,null,{log:function(){},warn:function(){},error:function(){}});$data.Trace=new $data.TraceBase;$data.Class.define("$data.Logger",$data.TraceBase,null,{log:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.log.apply(console,arguments)},warn:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.warn.apply(console,arguments)},error:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.error.apply(console,arguments)},getDateFormat:function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+"."+e.getMilliseconds()}});$data.Number=typeof Number!=="undefined"?Number:function(){};$data.Date=typeof Date!=="undefined"?Date:function(){};$data.String=typeof String!=="undefined"?String:function(){};$data.Boolean=typeof Boolean!=="undefined"?Boolean:function(){};$data.Array=typeof Array!=="undefined"?Array:function(){};$data.Object=typeof Object!=="undefined"?Object:function(){};$data.Function=Function;$data.Byte=function(){};$data.SByte=function(){};$data.Decimal=function(){};$data.Float=$data.Single=function(){};$data.Integer=function(){};$data.Int16=function(t){};$data.Int32=function(){};$data.Int64=function(t){};$data.ObjectID=typeof $data.mongoDBDriver!=="undefined"&&typeof $data.mongoDBDriver.ObjectID!=="undefined"?$data.mongoDBDriver.ObjectID:function(){};$data.Time=function(){};$data.DateTimeOffset=function(t){this.value=t};$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value};$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number);$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer);$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32);$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte);$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte);$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal);$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float);$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16);$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64);$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String);$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(undefined,arguments)});$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time);$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset);$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);$data.Container.registerType(["$data.Function","Function","function"],$data.Function);$data.Container.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],$data.ObjectID);$data.SimpleBase=function(t){if(typeof t==="object"&&t){if(Array.isArray(this.constructor.validMembers)){for(var n=0;n<this.constructor.validMembers.length;n++){var r=this.constructor.validMembers[n];if(t[r]!==undefined){this[r]=t[r]}}}else{delete t.type;$data.typeSystem.extend(this,t)}}};$data.SimpleBase.registerType=function(e,t,n){n=n||$data.SimpleBase;t.type=e;t.prototype=Object.create(n.prototype);t.prototype.constructor=t};$data.Container.registerType(["$data.SimpleBase","SimpleBase"],$data.SimpleBase);$data.Geospatial=function(){this.type=this.constructor.type;if(Array.isArray(this.constructor.validMembers)){for(var t=0;t<this.constructor.validMembers.length;t++){var n=this.constructor.validMembers[t];this[n]=undefined}}$data.SimpleBase.apply(this,arguments);this.type=this.constructor.type||"Unknown"};$data.SimpleBase.registerType("Geospatial",$data.Geospatial);$data.Container.registerType(["$data.Geospatial","Geospatial"],$data.Geospatial);$data.point=function(e){if(e&&e.crs){if(e.crs.properties&&e.crs.properties.name===$data.GeometryBase.defaultCrs.properties.name){return new $data.GeometryPoint(e)}else{return new $data.GeographyPoint(e)}}else if(e){if("x"in e&&"y"in e){return new $data.GeometryPoint(e.x,e.y)}else if("longitude"in e&&"latitude"in e){return new $data.GeographyPoint(e.longitude,e.latitude)}else if("lng"in e&&"lat"in e){return new $data.GeographyPoint(e.lng,e.lat)}}};$data.GeographyBase=function(){$data.Geospatial.apply(this,arguments);this.crs=$data.GeographyBase.defaultCrs;$data.GeographyBase.validateGeoJSON(this)};$data.GeographyBase.defaultCrs={properties:{name:"EPSG:4326"},type:"name"};$data.GeographyBase.parseFromString=function(e){var t=e.indexOf("(");if(t>=0){var n=e.substring(0,t).toLowerCase();var r=$data.GeographyBase.registered[n];if(r&&r.parseFromString&&r!=$data.GeographyBase){return r.parseFromString(e)}else{Guard.raise(new Exception("parseFromString","Not Implemented",e))}}};$data.GeographyBase.stringifyToUrl=function(e){if(e instanceof $data.GeographyBase&&e.constructor&&e.constructor.stringifyToUrl){return e.constructor.stringifyToUrl(e)}else if(e instanceof $data.GeographyBase&&e.constructor&&Array.isArray(e.constructor.validMembers)&&e.constructor.validMembers[0]==="coordinates"){var t="geography'"+e.type.toUpperCase()+"(";function n(e,r){if(Array.isArray(e[0])){for(var i=0;i<e.length;i++){if(i>0)t+=",";if(Array.isArray(e[i][0]))t+="(";n(e[i]);if(Array.isArray(e[i][0]))t+=")"}}else{t+=e.join(" ")}}n(e.coordinates,t);t+=")'";return t}else{Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",e))}};$data.GeographyBase.registerType=function(e,t,n){$data.SimpleBase.registerType(e,t,n||$data.GeographyBase);$data.GeographyBase.registered=$data.GeographyBase.registered||{};$data.GeographyBase.registered[e.toLowerCase()]=t};$data.GeographyBase.validateGeoJSON=function(e){var t=e.type;if(t){var n=$data.GeographyBase.registered[t.toLowerCase()];if(typeof n.validateGeoJSON==="function"){var r=n.validateGeoJSON(e);if(r){return r}else{Guard.raise(new Exception("Invalid '"+t+"' format!","Format Exception",e))}}}console.log("GeoJSON validation missing",e);return};$data.SimpleBase.registerType("GeographyBase",$data.GeographyBase,$data.Geospatial);$data.Container.registerType(["$data.GeographyBase"],$data.GeographyBase);$data.GeographyPoint=function(t,n){if(t&&typeof t==="object"&&Array.isArray(t)){$data.GeographyBase.call(this,{coordinates:t})}else if(t&&typeof t==="object"&&("longitude"in t||"latitude"in t)){$data.GeographyBase.call(this,{coordinates:[t.longitude,t.latitude]})}else if(t&&typeof t==="object"&&("lng"in t||"lat"in t)){$data.GeographyBase.call(this,{coordinates:[t.lng,t.lat]})}else if(t&&typeof t==="object"){$data.GeographyBase.call(this,t)}else{$data.GeographyBase.call(this,{coordinates:[t||0,n||0]})}};$data.GeographyPoint.validateGeoJSON=function(e){return e&&Array.isArray(e.coordinates)&&e.coordinates.length==2&&typeof e.coordinates[0]==="number"&&typeof e.coordinates[1]==="number"};$data.GeographyPoint.parseFromString=function(e){var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")"));var n=t.split(" ");return new $data.GeographyPoint(parseFloat(n[0]),parseFloat(n[1]))};$data.GeographyPoint.validMembers=["coordinates"];$data.GeographyBase.registerType("Point",$data.GeographyPoint);Object.defineProperty($data.GeographyPoint.prototype,"longitude",{get:function(){return this.coordinates[0]},set:function(e){this.coordinates[0]=e}});Object.defineProperty($data.GeographyPoint.prototype,"latitude",{get:function(){return this.coordinates[1]},set:function(e){this.coordinates[1]=e}});$data.Container.registerType(["$data.GeographyPoint","GeographyPoint","$data.Geography","Geography","geography","geo"],$data.GeographyPoint);$data.Geography=$data.GeographyPoint;$data.GeographyLineString=function(t){if(Array.isArray(t)){$data.GeographyBase.call(this,{coordinates:t})}else{$data.GeographyBase.call(this,t)}};$data.GeographyLineString.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];t=t&&Array.isArray(r)&&r.length==2&&typeof r[0]==="number"&&typeof r[1]==="number"}return t};$data.GeographyLineString.validMembers=["coordinates"];$data.GeographyBase.registerType("LineString",$data.GeographyLineString);$data.Container.registerType(["$data.GeographyLineString","GeographyLineString"],$data.GeographyLineString);$data.GeographyPolygon=function(t){if(typeof t==="object"&&("topLeft"in t&&"bottomRight"in t||"topRight"in t&&"bottomLeft"in t)){var n,r,i,s;if("topLeft"in t&&"bottomRight"in t){n=t.topLeft instanceof $data.GeographyPoint?t.topLeft:new $data.GeographyPoint(t.topLeft);s=t.bottomRight instanceof $data.GeographyPoint?t.bottomRight:new $data.GeographyPoint(t.bottomRight);r=new $data.GeographyPoint([s.coordinates[0],n.coordinates[1]]);i=new $data.GeographyPoint([n.coordinates[0],s.coordinates[1]])}else{r=t.topRight instanceof $data.GeographyPoint?t.topRight:new $data.GeographyPoint(t.topRight);i=t.bottomLeft instanceof $data.GeographyPoint?t.bottomLeft:new $data.GeographyPoint(t.bottomLeft);n=new $data.GeographyPoint([i.coordinates[0],r.coordinates[1]]);s=new $data.GeographyPoint([r.coordinates[0],i.coordinates[1]])}var o=[];o.push([].concat(n.coordinates));o.push([].concat(r.coordinates));o.push([].concat(s.coordinates));o.push([].concat(i.coordinates));o.push([].concat(n.coordinates));$data.GeographyBase.call(this,{coordinates:[o]})}else if(Array.isArray(t)){$data.GeographyBase.call(this,{coordinates:t})}else{$data.GeographyBase.call(this,t)}};$data.GeographyPolygon.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];var t=t&&Array.isArray(r);for(var i=0;t&&i<r.length;i++){var s=r[i];t=t&&Array.isArray(s)&&s.length==2&&typeof s[0]==="number"&&typeof s[1]==="number"}}return t};$data.GeographyPolygon.parseFromString=function(e){var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")"));var n=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split("),(");var t=[];for(var r=0;r<n.length;r++){var i=[];var s=n[r].split(",");for(var o=0;o<s.length;o++){var u=s[o].split(" ");i.push([parseFloat(u[0]),parseFloat(u[1])])}t.push(i)}return new $data.GeographyPolygon(t)};$data.GeographyPolygon.validMembers=["coordinates"];$data.GeographyBase.registerType("Polygon",$data.GeographyPolygon);$data.Container.registerType(["$data.GeographyPolygon","GeographyPolygon"],$data.GeographyPolygon);$data.GeographyMultiPoint=function(t){if(Array.isArray(t)){$data.GeographyBase.call(this,{coordinates:t})}else{$data.GeographyBase.call(this,t)}};$data.GeographyMultiPoint.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];t=t&&Array.isArray(r)&&r.length==2&&typeof r[0]==="number"&&typeof r[1]==="number"}return t};$data.GeographyMultiPoint.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiPoint",$data.GeographyMultiPoint);$data.Container.registerType(["$data.GeographyMultiPoint","GeographyMultiPoint"],$data.GeographyMultiPoint);$data.GeographyMultiLineString=function(t){if(Array.isArray(t)){$data.GeographyBase.call(this,{coordinates:t})}else{$data.GeographyBase.call(this,t)}};$data.GeographyMultiLineString.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];var t=t&&Array.isArray(r);for(var i=0;t&&i<r.length;i++){var s=r[i];t=t&&Array.isArray(s)&&s.length==2&&typeof s[0]==="number"&&typeof s[1]==="number"}}return t};$data.GeographyMultiLineString.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiLineString",$data.GeographyMultiLineString);$data.Container.registerType(["$data.GeographyMultiLineString","GeographyMultiLineString"],$data.GeographyMultiLineString);$data.GeographyMultiPolygon=function(t){if(Array.isArray(t)){$data.GeographyBase.call(this,{coordinates:t})}else{$data.GeographyBase.call(this,t)}};$data.GeographyMultiPolygon.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];var t=t&&Array.isArray(r);for(var i=0;t&&i<r.length;i++){var s=r[i];var t=t&&Array.isArray(s);for(var o=0;t&&o<s.length;o++){var u=s[o];t=t&&Array.isArray(u)&&u.length==2&&typeof u[0]==="number"&&typeof u[1]==="number"}}}return t};$data.GeographyMultiPolygon.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiPolygon",$data.GeographyMultiPolygon);$data.Container.registerType(["$data.GeographyMultiPolygon","GeographyMultiPolygon"],$data.GeographyMultiPolygon);$data.GeographyCollection=function(t){if(Array.isArray(t)){$data.GeographyBase.call(this,{geometries:t})}else{$data.GeographyBase.call(this,t)}};$data.GeographyCollection.validateGeoJSON=function(e){var t=e&&Array.isArray(e.geometries);for(var n=0;t&&n<e.geometries.length;n++){var r=e.geometries[n];try{t=t&&$data.GeographyBase.validateGeoJSON(r)}catch(i){t=false}}return t};$data.GeographyCollection.validMembers=["geometries"];$data.GeographyBase.registerType("GeometryCollection",$data.GeographyCollection);$data.Container.registerType(["$data.GeographyCollection","GeographyCollection"],$data.GeographyCollection);$data.Container.registerConverter($data.GeographyPoint,$data.Object,function(e){return e?new $data.GeographyPoint(e):e});$data.Container.registerConverter($data.GeographyLineString,$data.Object,function(e){return e?new $data.GeographyLineString(e):e});$data.Container.registerConverter($data.GeographyPolygon,$data.Object,function(e){return e?new $data.GeographyPolygon(e):e});$data.Container.registerConverter($data.GeographyMultiPoint,$data.Object,function(e){return e?new $data.GeographyMultiPoint(e):e});$data.Container.registerConverter($data.GeographyMultiLineString,$data.Object,function(e){return e?new $data.GeographyMultiLineString(e):e});$data.Container.registerConverter($data.GeographyMultiPolygon,$data.Object,function(e){return e?new $data.GeographyMultiPolygon(e):e});$data.Container.registerConverter($data.GeographyCollection,$data.Object,function(e){return e?new $data.GeographyCollection(e):e});$data.GeometryBase=function(){$data.Geospatial.apply(this,arguments);this.crs=$data.GeometryBase.defaultCrs;$data.GeometryBase.validateGeoJSON(this)};$data.GeometryBase.defaultCrs={properties:{name:"EPSG:0"},type:"name"};$data.GeometryBase.parseFromString=function(e){var t=e.indexOf("(");if(t>=0){var n=e.substring(0,t).toLowerCase();var r=$data.GeometryBase.registered[n];if(r&&r.parseFromString&&r!=$data.GeometryBase){return r.parseFromString(e)}else{Guard.raise(new Exception("parseFromString","Not Implemented",e))}}};$data.GeometryBase.stringifyToUrl=function(e){if(e instanceof $data.GeometryBase&&e.constructor&&e.constructor.stringifyToUrl){return e.constructor.stringifyToUrl(e)}else if(e instanceof $data.GeometryBase&&e.constructor&&Array.isArray(e.constructor.validMembers)&&e.constructor.validMembers[0]==="coordinates"){var t="geometry'"+e.type.toUpperCase()+"(";function n(e,r){if(Array.isArray(e[0])){for(var i=0;i<e.length;i++){if(i>0)t+=",";if(Array.isArray(e[i][0]))t+="(";n(e[i]);if(Array.isArray(e[i][0]))t+=")"}}else{t+=e.join(" ")}}n(e.coordinates,t);t+=")'";return t}else{Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",e))}};$data.GeometryBase.registerType=function(e,t,n){$data.SimpleBase.registerType(e,t,n||$data.GeometryBase);$data.GeometryBase.registered=$data.GeometryBase.registered||{};$data.GeometryBase.registered[e.toLowerCase()]=t};$data.GeometryBase.validateGeoJSON=function(e){var t=e.type;if(t){var n=$data.GeometryBase.registered[t.toLowerCase()];if(typeof n.validateGeoJSON==="function"){var r=n.validateGeoJSON(e);if(r){return r}else{Guard.raise(new Exception("Invalid '"+t+"' format!","Format Exception",e))}}}console.log("GeoJSON validation missing",e);return};$data.SimpleBase.registerType("GeometryBase",$data.GeometryBase,$data.Geospatial);$data.Container.registerType(["$data.GeometryBase"],$data.GeometryBase);$data.GeometryPoint=function(t,n){var r=t;if(r&&typeof r==="object"&&Array.isArray(r)){$data.GeometryBase.call(this,{coordinates:r})}else if(r&&typeof r==="object"&&("x"in r||"y"in r)){$data.GeometryBase.call(this,{coordinates:[r.x,r.y]})}else if(r&&typeof r==="object"){$data.GeometryBase.call(this,r)}else{$data.GeometryBase.call(this,{coordinates:[t||0,n||0]})}};$data.GeometryPoint.validateGeoJSON=function(e){return e&&Array.isArray(e.coordinates)&&e.coordinates.length==2&&typeof e.coordinates[0]==="number"&&typeof e.coordinates[1]==="number"};$data.GeometryPoint.parseFromString=function(e){var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")"));var n=t.split(" ");return new $data.GeometryPoint(parseFloat(n[0]),parseFloat(n[1]))};$data.GeometryPoint.validMembers=["coordinates"];$data.GeometryBase.registerType("Point",$data.GeometryPoint);Object.defineProperty($data.GeometryPoint.prototype,"x",{get:function(){return this.coordinates[0]},set:function(e){this.coordinates[0]=e}});Object.defineProperty($data.GeometryPoint.prototype,"y",{get:function(){return this.coordinates[1]},set:function(e){this.coordinates[1]=e}});$data.Container.registerType(["$data.GeometryPoint","GeometryPoint"],$data.GeometryPoint);$data.GeometryLineString=function(t){if(Array.isArray(t)){$data.GeometryBase.call(this,{coordinates:t})}else{$data.GeometryBase.call(this,t)}};$data.GeometryLineString.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];t=t&&Array.isArray(r)&&r.length==2&&typeof r[0]==="number"&&typeof r[1]==="number"}return t};$data.GeometryLineString.validMembers=["coordinates"];$data.GeometryBase.registerType("LineString",$data.GeometryLineString);$data.Container.registerType(["$data.GeometryLineString","GeometryLineString"],$data.GeometryLineString);$data.GeometryPolygon=function(t){if(typeof t==="object"&&("topLeft"in t&&"bottomRight"in t||"topRight"in t&&"bottomLeft"in t)){var n,r,i,s;if("topLeft"in t&&"bottomRight"in t){n=t.topLeft instanceof $data.GeometryPoint?t.topLeft:new $data.GeometryPoint(t.topLeft);s=t.bottomRight instanceof $data.GeometryPoint?t.bottomRight:new $data.GeometryPoint(t.bottomRight);r=new $data.GeometryPoint([s.coordinates[0],n.coordinates[1]]);i=new $data.GeometryPoint([n.coordinates[0],s.coordinates[1]])}else{r=t.topRight instanceof $data.GeometryPoint?t.topRight:new $data.GeometryPoint(t.topRight);i=t.bottomLeft instanceof $data.GeometryPoint?t.bottomLeft:new $data.GeometryPoint(t.bottomLeft);n=new $data.GeometryPoint([i.coordinates[0],r.coordinates[1]]);s=new $data.GeometryPoint([r.coordinates[0],i.coordinates[1]])}var o=[];o.push([].concat(n.coordinates));o.push([].concat(r.coordinates));o.push([].concat(s.coordinates));o.push([].concat(i.coordinates));o.push([].concat(n.coordinates));$data.GeometryBase.call(this,{coordinates:[o]})}else if(Array.isArray(t)){$data.GeometryBase.call(this,{coordinates:t})}else{$data.GeometryBase.call(this,t)}};$data.GeometryPolygon.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];var t=t&&Array.isArray(r);for(var i=0;t&&i<r.length;i++){var s=r[i];t=t&&Array.isArray(s)&&s.length==2&&typeof s[0]==="number"&&typeof s[1]==="number"}}return t};$data.GeometryPolygon.parseFromString=function(e){var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")"));var n=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split("),(");var t=[];for(var r=0;r<n.length;r++){var i=[];var s=n[r].split(",");for(var o=0;o<s.length;o++){var u=s[o].split(" ");i.push([parseFloat(u[0]),parseFloat(u[1])])}t.push(i)}return new $data.GeometryPolygon(t)};$data.GeometryPolygon.validMembers=["coordinates"];$data.GeometryBase.registerType("Polygon",$data.GeometryPolygon);$data.Container.registerType(["$data.GeometryPolygon","GeometryPolygon"],$data.GeometryPolygon);$data.GeometryMultiPoint=function(t){if(Array.isArray(t)){$data.GeometryBase.call(this,{coordinates:t})}else{$data.GeometryBase.call(this,t)}};$data.GeometryMultiPoint.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];t=t&&Array.isArray(r)&&r.length==2&&typeof r[0]==="number"&&typeof r[1]==="number"}return t};$data.GeometryMultiPoint.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiPoint",$data.GeometryMultiPoint);$data.Container.registerType(["$data.GeometryMultiPoint","GeometryMultiPoint"],$data.GeometryMultiPoint);$data.GeometryMultiLineString=function(t){if(Array.isArray(t)){$data.GeometryBase.call(this,{coordinates:t})}else{$data.GeometryBase.call(this,t)}};$data.GeometryMultiLineString.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];var t=t&&Array.isArray(r);for(var i=0;t&&i<r.length;i++){var s=r[i];t=t&&Array.isArray(s)&&s.length==2&&typeof s[0]==="number"&&typeof s[1]==="number"}}return t};$data.GeometryMultiLineString.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiLineString",$data.GeometryMultiLineString);$data.Container.registerType(["$data.GeometryMultiLineString","GeometryMultiLineString"],$data.GeometryMultiLineString);$data.GeometryMultiPolygon=function(t){if(Array.isArray(t)){$data.GeometryBase.call(this,{coordinates:t})}else{$data.GeometryBase.call(this,t)}};$data.GeometryMultiPolygon.validateGeoJSON=function(e){var t=e&&Array.isArray(e.coordinates);for(var n=0;t&&n<e.coordinates.length;n++){var r=e.coordinates[n];var t=t&&Array.isArray(r);for(var i=0;t&&i<r.length;i++){var s=r[i];var t=t&&Array.isArray(s);for(var o=0;t&&o<s.length;o++){var u=s[o];t=t&&Array.isArray(u)&&u.length==2&&typeof u[0]==="number"&&typeof u[1]==="number"}}}return t};$data.GeometryMultiPolygon.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiPolygon",$data.GeometryMultiPolygon);$data.Container.registerType(["$data.GeometryMultiPolygon","GeometryMultiPolygon"],$data.GeometryMultiPolygon);$data.GeometryCollection=function(t){if(Array.isArray(t)){$data.GeometryBase.call(this,{geometries:t})}else{$data.GeometryBase.call(this,t)}};$data.GeometryCollection.validateGeoJSON=function(e){var t=e&&Array.isArray(e.geometries);for(var n=0;t&&n<e.geometries.length;n++){var r=e.geometries[n];try{t=t&&$data.GeometryBase.validateGeoJSON(r)}catch(i){t=false}}return t};$data.GeometryCollection.validMembers=["geometries"];$data.GeometryBase.registerType("GeometryCollection",$data.GeometryCollection);$data.Container.registerType(["$data.GeometryCollection","GeometryCollection"],$data.GeometryCollection);$data.Container.registerConverter($data.GeometryPoint,$data.Object,function(e){return e?new $data.GeometryPoint(e):e});$data.Container.registerConverter($data.GeometryLineString,$data.Object,function(e){return e?new $data.GeometryLineString(e):e});$data.Container.registerConverter($data.GeometryPolygon,$data.Object,function(e){return e?new $data.GeometryPolygon(e):e});$data.Container.registerConverter($data.GeometryMultiPoint,$data.Object,function(e){return e?new $data.GeometryMultiPoint(e):e});$data.Container.registerConverter($data.GeometryMultiLineString,$data.Object,function(e){return e?new $data.GeometryMultiLineString(e):e});$data.Container.registerConverter($data.GeometryMultiPolygon,$data.Object,function(e){return e?new $data.GeometryMultiPolygon(e):e});$data.Container.registerConverter($data.GeometryCollection,$data.Object,function(e){return e?new $data.GeometryCollection(e):e});$data.Guid=function(t){if(t===undefined||typeof t==="string"&&/^[a-zA-z0-9]{8}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{12}$/.test(t)){this.value=t||"00000000-0000-0000-0000-000000000000"}else{throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Guid",t))}};$data.Container.registerType(["$data.Guid","Guid","guid"],$data.Guid);$data.Container.registerConverter("$data.Guid",{"$data.String":function(e){return e?$data.parseGuid(e).toString():e},"$data.Guid":function(e){return e?e.toString():e}},{"$data.String":function(e){return e?e.toString():e}});$data.Guid.prototype.toJSON=function(){return this.value};$data.Guid.prototype.valueOf=function(){return this.value};$data.Guid.prototype.toString=function(){return this.value};$data.Guid.NewGuid=function(){return $data.createGuid()};$data.parseGuid=function(e){return new $data.Guid(e)};(function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");$data.createGuid=function(t){if(t){return new $data.Guid(t)}var n;var r=e,i=[],s;var o=r.length;if(n){for(s=0;s<n;s++)i[s]=r[0|Math.random()*o]}else{var u;i[8]=i[13]=i[18]=i[23]="-";i[14]="4";for(s=0;s<36;s++){if(!i[s]){u=0|Math.random()*16;i[s]=r[s==19?u&3|8:u]}}}return $data.parseGuid(i.join(""))}})();$data.Blob=function(){};$data.Blob.createFromHexString=function(e){if(e!=e.match(new RegExp("[0-9a-fA-F]+"))[0]){Guard.raise(new Exception("TypeError: ","value not convertable to $data.Blob",e))}else{var t=new(typeof Buffer!="undefined"?Buffer:Uint8Array)(e.length>>1);for(var n=0,r=1,i=0;n<e.length;n+=2,r+=2,i++){t[i]=parseInt("0x"+e[n]+e[r],16)}return t}};$data.Blob.toString=function(e){if(!e||!e.length)return null;var t="";for(var n=0;n<e.length;n++){t+=String.fromCharCode(e[n])}return t};$data.Blob.toBase64=function(e){if(!e||!e.length)return null;return btoa($data.Blob.toString(e))};$data.Blob.toArray=function(e){if(!e||!e.length)return null;var t=new Array(e.length);for(var n=0;n<e.length;n++){t[n]=e[n]}return t};$data.Blob.toHexString=function(e){if(!e||!e.length)return null;var t="";for(var n=0;n<e.length;n++){t+=("00"+e[n].toString(16)).slice(-2)}return t.toUpperCase()};$data.Blob.toDataURL=function(e){if(!e||!e.length)return null;return"data:application/octet-stream;base64,"+btoa($data.Blob.toString(e))};$data.Container.registerType(["$data.Blob","blob","JayBlob"],$data.Blob);$data.Container.registerConverter("$data.Blob",{"$data.String":function(e){if(e&&e.length){var t=new(typeof Buffer!=="undefined"?Buffer:Uint8Array)(e.length);for(var n=0;n<e.length;n++){t[n]=e.charCodeAt(n)}return t}else return null},"$data.Array":function(e){return new(typeof Buffer!=="undefined"?Buffer:Uint8Array)(e)},"$data.Number":function(e){return new(typeof Buffer!=="undefined"?Buffer:Uint8Array)($data.packIEEE754(e,11,52).reverse())},"$data.Boolean":function(e){return new(typeof Buffer!=="undefined"?Buffer:Uint8Array)([e|0])},"default":function(e){if(typeof Blob!=="undefined"&&e instanceof Blob){var t=new XMLHttpRequest;t.open("GET",URL.createObjectURL(e),false);t.responseType="arraybuffer";t.send(null);return $data.Container.convertTo(t.response,$data.Blob)}else if(typeof ArrayBuffer!=="undefined"&&e instanceof ArrayBuffer){return new(typeof Buffer!=="undefined"?Buffer:Uint8Array)(new Uint8Array(e))}else if(e instanceof Uint8Array){if(typeof Buffer!=="undefined")return new Buffer(e);else return e}else if(typeof Buffer!=="undefined"?e instanceof Buffer:false){return e}else if(e.buffer){return new(typeof Buffer!=="undefined"?Buffer:Uint8Array)(e)}else if(typeof e=="object"&&e instanceof Object){var n=[];for(var r in e){n[r]=e[r]}if(!n.length)throw 0;return new(typeof Buffer!=="undefined"?Buffer:Uint8Array)(n)}throw 0}},{"$data.String":function(e){return $data.Blob.toString(e)},"$data.Array":function(e){return $data.Blob.toArray(e)}});(function(e){function t(){}function n(){}function r(){}function i(){}function s(){}function o(){}function u(){}function a(){}function f(){}function l(){}function c(){}function h(){}function p(){}function d(){}function v(){}function m(){}function g(){}function y(){}function b(){}function w(){}function E(){}function S(){}function x(){}function T(){}function N(){}function C(){}function k(){}function L(){}function A(){}function O(){}e.Container.registerType("Edm.Boolean",t);e.Container.mapType(t,e.Boolean);e.Container.registerType("Edm.Binary",n);e.Container.mapType(n,e.Blob);e.Container.registerType("Edm.DateTime",r);e.Container.mapType(r,e.Date);e.Container.registerType("Edm.DateTimeOffset",i);e.Container.mapType(i,e.DateTimeOffset);e.Container.registerType("Edm.Time",s);e.Container.mapType(s,e.Time);e.Container.registerType("Edm.Decimal",o);e.Container.mapType(o,e.Decimal);e.Container.registerType("Edm.Float",u);e.Container.mapType(u,e.Float);e.Container.registerType("Edm.Single",a);e.Container.mapType(a,e.Float);e.Container.registerType("Edm.Double",f);e.Container.mapType(f,e.Number);e.Container.registerType("Edm.Guid",l);e.Container.mapType(l,e.Guid);e.Container.registerType("Edm.Int16",c);e.Container.mapType(c,e.Int16);e.Container.registerType("Edm.Int32",h);e.Container.mapType(h,e.Integer);e.Container.registerType("Edm.Int64",p);e.Container.mapType(p,e.Int64);e.Container.registerType("Edm.Byte",d);e.Container.mapType(d,e.Byte);e.Container.registerType("Edm.SByte",v);e.Container.mapType(v,e.SByte);e.Container.registerType("Edm.String",m);e.Container.mapType(m,e.String);e.Container.registerType("Edm.GeographyPoint",g);e.Container.mapType(g,e.GeographyPoint);e.Container.registerType("Edm.GeographyLineString",y);e.Container.mapType(y,e.GeographyLineString);e.Container.registerType("Edm.GeographyPolygon",b);e.Container.mapType(b,e.GeographyPolygon);e.Container.registerType("Edm.GeographyMultiPoint",w);e.Container.mapType(w,e.GeographyMultiPoint);e.Container.registerType("Edm.GeographyMultiLineString",E);e.Container.mapType(E,e.GeographyMultiLineString);e.Container.registerType("Edm.GeographyMultiPolygon",S);e.Container.mapType(S,e.GeographyMultiPolygon);e.Container.registerType("Edm.GeographyCollection",x);e.Container.mapType(x,e.GeographyCollection);e.Container.registerType("Edm.GeometryPoint",T);e.Container.mapType(T,e.GeometryPoint);e.Container.registerType("Edm.GeometryLineString",N);e.Container.mapType(N,e.GeometryLineString);e.Container.registerType("Edm.GeometryPolygon",C);e.Container.mapType(C,e.GeometryPolygon);e.Container.registerType("Edm.GeometryMultiPoint",k);e.Container.mapType(k,e.GeometryMultiPoint);e.Container.registerType("Edm.GeometryMultiLineString",L);e.Container.mapType(L,e.GeometryMultiLineString);e.Container.registerType("Edm.GeometryMultiPolygon",A);e.Container.mapType(A,e.GeometryMultiPolygon);e.Container.registerType("Edm.GeometryCollection",O);e.Container.mapType(O,e.GeometryCollection);e.oDataEdmMapping={"$data.Byte":"Edm.Byte","$data.SByte":"Edm.SByte","$data.Decimal":"Edm.Decimal","$data.Float":"Edm.Float","$data.Int16":"Edm.Int16","$data.Int64":"Edm.Int64","$data.DateTimeOffset":"Edm.DateTimeOffset","$data.Time":"Edm.Time","$data.Boolean":"Edm.Boolean","$data.Blob":"Edm.Binary","$data.Date":"Edm.DateTime","$data.Number":"Edm.Double","$data.Integer":"Edm.Int32","$data.Int32":"Edm.Int32","$data.String":"Edm.String","$data.ObjectID":"Edm.String","$data.GeographyPoint":"Edm.GeographyPoint","$data.GeographyLineString":"Edm.GeographyLineString","$data.GeographyPolygon":"Edm.GeographyPolygon","$data.GeographyMultiPoint":"Edm.GeographyMultiPoint","$data.GeographyMultiLineString":"Edm.GeographyMultiLineString","$data.GeographyMultiPolygon":"Edm.GeographyMultiPolygon","$data.GeographyCollection":"Edm.GeographyCollection","$data.GeometryPoint":"Edm.GeometryPoint","$data.GeometryLineString":"Edm.GeometryLineString","$data.GeometryPolygon":"Edm.GeometryPolygon","$data.GeometryMultiPoint":"Edm.GeometryMultiPoint","$data.GeometryMultiLineString":"Edm.GeometryMultiLineString","$data.GeometryMultiPolygon":"Edm.GeometryMultiPolygon","$data.GeometryCollection":"Edm.GeometryCollection","$data.Guid":"Edm.Guid"}})($data);$data.Container.registerConverter("$data.Boolean",{"$data.String":function(e){if(e.toLowerCase()=="true")return true;if(e.toLowerCase()=="false")return false;return!!e},"default":function(e){return!!e}});$data.Container.registerConverter("$data.Integer",{"default":function(e){if(e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY||e===Number.MAX_VALUE||e===Number.MIN_VALUE){return e}var t=parseInt(+e,10);if(isNaN(t))throw 0;return t}});$data.Container.registerConverter("$data.Int32",{"default":function(e){return e|0}});$data.Container.registerConverter("$data.Number",{"default":function(e){var t=+e;if(isNaN(t))throw 0;return t}});$data.Container.registerConverter("$data.Byte",{"default":function(e){return(e|0)&255}});$data.Container.registerConverter("$data.Date",{"default":function(e){var t=new Date(e);if(isNaN(t))throw 0;return t}});$data.Container.registerConverter("$data.DateTimeOffset",{"$data.Date":function(e){return e},"default":function(e){var t=new Date(e);if(isNaN(t))throw 0;return t}});(function(){function e(e){var t=/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]|[0-9])(:([0-5][0-9]|[0-9])(\.(\d+))?)?$/;var n=t.exec(e);if(!n)throw 0;var r="";r+=("00"+n[1]).slice(-2);r+=":"+("00"+n[2]).slice(-2);if(n[4]){r+=":"+("00"+n[4]).slice(-2)}else{r+=":00"}if(n[6])r+="."+(n[6]+"000").slice(0,3);return r}$data.Container.registerConverter("$data.Time",{"$data.String":e,"$data.Number":function(n){var r=[1e3,60,60];var i=[0,0,0,n|0];for(var s=0;s<r.length;s++){i[r.length-(s+1)]=i[r.length-s]/r[s]|0;i[r.length-s]-=i[r.length-(s+1)]*r[s]}var o="";for(var s=0;s<i.length;s++){if(s<i.length-1){o+=("00"+i[s]).slice(-2);if(s<i.length-2)o+=":"}else{o+="."+("000"+i[s]).slice(-3)}}return e(o)},"$data.Date":function(t){var n=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();var r=t.getMilliseconds();if(r){n+="."+r}return e(n)}})})();$data.Container.registerConverter("$data.Decimal",{"$data.Boolean":function(e){return e?"1":"0"},"$data.Number":function(e){return e.toString()},"$data.String":function(e){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(e))throw 0;return e},"$data.Date":function(e){var t=e.valueOf();if(isNaN(t))throw 0;return t.toString()}});$data.packIEEE754=function(e,t,n){var r=(1<<t-1)-1,i,s,o,u,a,f,l,c;if(e!==e){s=(1<<r)-1;o=Math.pow(2,n-1);i=0}else if(e===Infinity||e===-Infinity){s=(1<<r)-1;o=0;i=e<0?1:0}else if(e===0){s=0;o=0;i=1/e===-Infinity?1:0}else{i=e<0;e=Math.abs(e);if(e>=Math.pow(2,1-r)){u=Math.min(Math.floor(Math.log(e)/Math.LN2),r);s=u+r;o=Math.round(e*Math.pow(2,n-u)-Math.pow(2,n))}else{s=0;o=Math.round(e/Math.pow(2,1-r-n))}}f=[];for(a=n;a;a-=1){f.push(o%2?1:0);o=Math.floor(o/2)}for(a=t;a;a-=1){f.push(s%2?1:0);s=Math.floor(s/2)}f.push(i?1:0);f.reverse();l=f.join("");c=[];while(l.length){c.push(parseInt(l.substring(0,8),2));l=l.substring(8)}return c};$data.unpackIEEE754=function(e,t,n){var r=[],i,s,o,u,a,f,l,c;for(i=e.length;i;i-=1){o=e[i-1];for(s=8;s;s-=1){r.push(o%2?1:0);o=o>>1}}r.reverse();u=r.join("");a=(1<<t-1)-1;f=parseInt(u.substring(0,1),2)?-1:1;l=parseInt(u.substring(1,1+t),2);c=parseInt(u.substring(1+t),2);if(l===(1<<t)-1){return c!==0?NaN:f*Infinity}else if(l>0){return f*Math.pow(2,l-a)*(1+c/Math.pow(2,n))}else if(c!==0){return f*Math.pow(2,-(a-1))*(c/Math.pow(2,n))}else{return f<0?-0:0}};$data.IEEE754=function(e,t,n){return $data.unpackIEEE754($data.packIEEE754(e,t,n),t,n)};$data.Container.registerConverter("$data.Float",{"default":function(e){var t=+e;if(isNaN(t))throw 0;return $data.IEEE754(t,8,23)}});$data.Container.registerConverter("$data.Int16",{"default":function(e){var t=(e|0)&65535;if(t>=32768)return t-65536;return t}});$data.Container.registerConverter("$data.Int64",{"$data.Boolean":function(e){return e?"1":"0"},"$data.Number":function(e){var t=e.toString();if(t.indexOf(".")>0)return t.split(".")[0];if(t.indexOf(".")==0)throw 0;return t},"$data.String":function(e){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(e))throw 0;if(e.indexOf(".")>0)return e.split(".")[0];if(e.indexOf(".")==0)throw 0;return e},"$data.Date":function(e){var t=e.valueOf();if(isNaN(t))throw 0;return t.toString()}});$data.Container.registerConverter("$data.SByte",{"default":function(e){var t=(e|0)&255;if(t>=128)return t-256;return t}});$data.Container.registerConverter("$data.String",{"$data.Date":function(e){return e.toISOString()},"$data.ObjectID":function(e){return btoa(e.toString())},"default":function(e){if(typeof e==="object")return JSON.stringify(e);return e.toString()}});$data.Container.registerConverter("$data.Object",{"$data.String":function(e){return JSON.parse(e)},"$data.Function":function(){throw 0}});$data.Container.registerConverter("$data.Array",{"$data.String":function(e){var t=JSON.parse(e);if(!Array.isArray(t))throw 0;return t}});$data.Container.registerConverter("$data.ObjectID",{"$data.ObjectID":function(e){try{return btoa(e.toString())}catch(t){return e}},"$data.String":function(e){return e}});$data.Container.proxyConverter=function(e){return e};$data.Container.defaultConverter=function(e){return function(t){return $data.Container.convertTo(t,e)}};$data.StringFunctions={startsWith:function(){var e,t;if(arguments.length==2){e=arguments[0];t=arguments[1]}else if(arguments.length==1&&typeof this==="string"){e=this;t=arguments[0]}else if(this instanceof String){e=this.valueOf();t=arguments[0]}else return false;if(typeof e!=="string")return false;return e.indexOf(t)===0},endsWith:function(){var e,t;if(arguments.length==2){e=arguments[0];t=arguments[1]}else if(arguments.length==1&&typeof this==="string"){e=this;t=arguments[0]}else if(this instanceof String){e=this.valueOf();t=arguments[0]}else return false;if(typeof e!=="string")return false;return e.slice(-t.length)===t},contains:function(){var e,t;if(arguments.length==2){e=arguments[0];t=arguments[1]}else if(arguments.length==1&&typeof this==="string"){e=this;t=arguments[0]}else if(this instanceof String){e=this.valueOf();t=arguments[0]}else return false;if(typeof e!=="string")return false;return e.indexOf(t)>=0}};$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",First:"First",Count:"Count",InlineCount:"InlineCount",Single:"Single",Find:"Find",Some:"Some",Every:"Every",ToArray:"ToArray",BatchDelete:"BatchDelete",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityFunctionOperation:"EntityFunctionOperation",ContextFunctionOperation:"ContextFunctionOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",IndexedPhysicalAnd:"IndexedDBPhysicalAndFilterExpression",IndexedLogicalAnd:"IndexedDBLogicalAndFilterExpression",IndexedLogicalOr:"IndexedDBLogicalOrFilterExpression",IndexedLogicalIn:"IndexedDBLogicalInFilterExpression"});$data.BinaryOperator=function(){};$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(e,t){return e==t}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(e,t){return e===t}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(e,t){return e!=t}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(e,t){return e!==t}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(e,t){return e>t}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(e,t){return e>=t}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(e,t){return e<=t}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(e,t){return e<t}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(e,t){return e&&t}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(e,t){return e||t}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(e,t){return e&t}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(e,t){return e|t}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(e,t){return e+t}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(e,t){return e-t}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(e,t){return e/t}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(e,t){return e%t}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(e,t){return e*t}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(e,t){return e[t]}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(e,t){return e in t}}];$data.binaryOperators.resolve=function(e){var t=$data.binaryOperators.filter(function(t){return t.operator==e});if(t.length>0)return e};$data.binaryOperators.contains=function(e){return $data.binaryOperators.some(function(t){return t.operator==e})};$data.binaryOperators.getOperator=function(e){var t=$data.binaryOperators.filter(function(t){return t.operator==e});if(t.length<1)Guard.raise("Unknown operator: "+e);return t[0]};$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(e){return+e}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(e){return-e}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(e){return++e}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(e){return--e}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(e){return e++}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(e){return!e}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(e){return e--}}];$data.unaryOperators.resolve=function(e){var t=$data.unaryOperators.filter(function(t){return t.operator==e});if(t.length>0)return e};$data.unaryOperators.contains=function(e){return $data.unaryOperators.some(function(t){return t.operator==e})};$data.unaryOperators.getOperator=function(e,t){var n=$data.unaryOperators.filter(function(n){return n.operator==e&&(!t||n.arity==t)});if(n.length<1)Guard.raise("Unknown operator: "+e);return n[0]};$data.timeIt=function(e,t){t=t||1;console.time("!");for(var n=0;n<t;n++){e()}console.timeEnd("!")};$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"};$data.executable=true;$C("$data.Expressions.ExpressionNode",null,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{set:function(e){if(typeof e==="string"){e=Container.resolveType(e)}this._expressionType=e},get:function(e){if(arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify){return Container.resolveName(this._expressionType)}return this._expressionType},enumerable:true},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:false},type:{},isTerminated:{value:false},toString:function(){return this.value}},null);$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n,r){this.operand=e;this.operator=t;this.nodeType=n;this.resolution=r},operator:{value:undefined,writable:true},operand:{value:undefined,writable:true},nodeType:{value:undefined,writable:true}});$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e){this.items=e||[]},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:true},items:{value:undefined,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(e){var t="["+this.items.map(function(e){return e.toString()}).join(",")+"]";return t}},null);$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.expression=e;this.member=t;this.args=n},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:undefined,dataType:$data.Expressions.ExpressionNode,writable:true},member:{value:undefined,dataType:$data.MemberDefinition,writable:true},type:{value:undefined,writable:true},implementation:{get:function(){return function(e,t,n){if(typeof t!=="function"){t=e[t]}Guard.requireType("method",t,Function);return t.apply(e,n)}},set:function(e){Guard.raise("Property can not be set")}},toString:function(e){return this.object.toString()+"."+this.member.toString()+"("+")"}});$C("$data.Expressions.CodeParser",null,null,{constructor:function(e){this.scopeContext=e;this.lambdaParams=[]},log:function(e){if(this.scopeContext)this.scopeContext.log(e)},parseExpression:function(e,t){if(typeof e==="object"){e=""}var n={success:true,errorMessage:"",errorDetails:""};if($data.Acorn){return{success:true,expression:this.ParserBuild($data.Acorn.parse("("+e.toString()+")").body[0]),errors:[]}}else if($data.Esprima){return{success:true,expression:this.ParserBuild($data.Esprima.parse("("+e.toString()+")").body[0]),errors:[]}}else{var r=$data.ASTParser.parseCode(e);this.log({event:"AST",data:r});if(!r.success){return{success:false,error:"ASTParser error",errorMessage:r.errors?JSON.stringify(r.errors):"could not get code"}}var i=this.Build2(r.tree.first[0]);n={success:true,expression:i,errors:r.errors};return n}},createExpression:function(e,t){var n=this.parseExpression(e,t);if(!n.success){Guard.raise("ExpressionParserError: "+n.errorMessage)}return n.expression},ParserBuild:function(e){return this["Parser"+e.type](e)},ParserExpressionStatement:function(e){return this.ParserBuild(e.expression)},ParserBlockStatement:function(e){return this.ParserBuild(e.body[0])},ParserReturnStatement:function(e){return this.ParserBuild(e.argument)},ParserMemberExpression:function(e){return new $data.Expressions.PropertyExpression(this.ParserBuild(e.object),new $data.Expressions.ConstantExpression(e.property.name||e.property.value,typeof (e.property.name||e.property.value)))},ParserIdentifier:function(e){return this.ParserParameter(e,this.lambdaParams.indexOf(e.name)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter)},ParserObjectExpression:function(e){var t=new Array(e.properties.length);for(var n=0;n<e.properties.length;n++){t[n]=this.ParserProperty(e.properties[n])}return new $data.Expressions.ObjectLiteralExpression(t)},ParserArrayExpression:function(e){var t=new Array(e.elements.length);for(var n=0;n<e.elements.length;n++){t[n]=this.ParserBuild(e.elements[n])}return new $data.Expressions.ArrayLiteralExpression(t)},ParserProperty:function(e){return new $data.Expressions.ObjectFieldExpression(e.key.name,this.ParserBuild(e.value))},ParserFunctionExpression:function(e){var t=new Array(e.params.length);for(var n=0;n<e.params.length;n++){this.lambdaParams.push(e.params[n].name);t[n]=this.ParserParameter(e.params[n],$data.Expressions.ExpressionType.LambdaParameter);t[n].owningFunction=r}var r=new $data.Expressions.FunctionExpression(e.id?e.id.name:e.id,t,this.ParserBuild(e.body));return r},ParserParameter:function(e,t){var n=new $data.Expressions.ParameterExpression(e.name,null,t);if(t==$data.Expressions.ExpressionType.LambdaParameterReference){n.paramIndex=this.lambdaParams.indexOf(e.name)}return n},ParserLogicalExpression:function(e){return this.ParserBinaryExpression(e)},ParserOperators:{value:{"==":{expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(e,t){return e==t}},"===":{expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(e,t){return e===t}},"!=":{expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(e,t){return e!=t}},"!==":{expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(e,t){return e!==t}},">":{expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(e,t){return e>t}},">=":{expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(e,t){return e>=t}},"<=":{expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(e,t){return e<=t}},"<":{expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(e,t){return e<t}},"&&":{expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(e,t){return e&&t}},"||":{expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(e,t){return e||t}},"&":{expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(e,t){return e&t}},"|":{expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(e,t){return e|t}},"+":{expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(e,t){return e+t}},"-":{expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(e,t){return e-t}},"/":{expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(e,t){return e/t}},"%":{expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(e,t){return e%t}},"*":{expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(e,t){return e*t}},"[":{expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(e,t){return e[t]}},"in":{expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(e,t){return e in t}}}},ParserUnaryOperators:{value:{"+":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(e){return+e}},"-":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(e){return-e}},"++true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(e){return++e}},"--true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(e){return--e}},"++false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(e){return e++}},"!":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(e){return!e}},"--false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(e){return e--}}}},ParserUnaryExpression:function(e){return new $data.Expressions.UnaryExpression(this.ParserBuild(e.argument),this.ParserUnaryOperators[e.operator],this.ParserUnaryOperators[e.operator].expressionType)},ParserUpdateExpression:function(e){return new $data.Expressions.UnaryExpression(this.ParserBuild(e.argument),this.ParserUnaryOperators[e.operator+e.prefix],this.ParserUnaryOperators[e.operator+e.prefix].nodeType)},ParserBinaryExpression:function(e){return new $data.Expressions.SimpleBinaryExpression(this.ParserBuild(e.left),this.ParserBuild(e.right),this.ParserOperators[e.operator].expressionType,e.operator,this.ParserOperators[e.operator].type)},ParserThisExpression:function(e){return new $data.Expressions.ThisExpression},ParserLiteral:function(e){return new $data.Expressions.ConstantExpression(e.value,typeof e.value)},ParserCallExpression:function(e){var t=this.ParserBuild(e.callee);var n=new Array(e.arguments.length);for(var r=0;r<e.arguments.length;r++){n[r]=this.ParserBuild(e.arguments[r])}var i;var s;switch(true){case t instanceof $data.Expressions.PropertyExpression:s=t.expression;i=t.member;break;case t instanceof $data.Expressions.ParameterExpression:s=new $data.Expressions.ConstantExpression(null,typeof null);i=t;break}return new $data.Expressions.CallExpression(s,i,n)}});$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.value=e;this.type=t;this.name=n;if(!Object.isNullOrUndefined(this.value)){this.type=Container.resolveType(this.type);if(Container.resolveType(Container.getTypeName(this.value))!==this.type)this.value=Container.convertTo(e,this.type)}},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:true},type:{value:Object,writable:true},value:{value:undefined,writable:true},toString:function(e){return this.value.toString()}});$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.parameters=t||[];this.name=e;this.body=n},toString:function(e){var t=this.parameters.map(function(e){return e.toString()});t=t.join(",");var n=this.body?this.body.toString(e):"";return"function "+this.name+"("+t+") { "+n+"}"},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:true},parameters:{value:undefined,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:undefined,dataType:$data.Expressions.ExpressionNode},type:{}},null);$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){this.fieldName=e;this.expression=t},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:true},toString:function(e){var t="unimplemented";return t}},null);$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e){this.members=e},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:true},toString:function(e){var t="unimplemented";return t},implementation:{get:function(){return function(e){var t={};e.forEach(function(e){t[e.name]=e.value});return t}},set:function(){}}},null);$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.source=e;this.amount=t;this.nodeType=n},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:true},toString:function(e){var t="unimplemented";return t}},null);$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.nodeType=n||$data.Expressions.ExpressionType.Parameter;this.name=e;this.type=t||"unknown";var r},owningFunction:{value:undefined,enumerable:false},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:true},name:{value:undefined,dataType:String,writable:true},type:{value:undefined,dataType:"object",writable:true},toString:function(e){var t;t=e?this.type+" ":"";t=t+this.name;return t}},null);$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){this.expression=e;this.member=t;this.type=t.dataType},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:undefined,dataType:$data.Expressions.ExpressionNode,writable:true},implementation:{get:function(){return function(e,t){if(e[t]===undefined)Guard.raise(new Exception("Parameter '"+t+"' not found in context","Property not found!"));return e[t]}},set:function(){}},member:{value:undefined,dataType:$data.MemberDefinition,writable:true},type:{value:undefined,writable:true},toString:function(e){return this.expression.toString()+"."+this.member.toString()}});$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n,r,i,s){this.left=e;this.right=t;this.nodeType=n;this.operator=r;this.type=i;this.resolution=s},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:true}});$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}});$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(e,t){if(!e){return e}var n=null;switch(e.expressionType){case $data.Expressions.ParameterExpression:n=this.VisitParameter(e,t);break;case $data.Expressions.ConstantExpression:n=this.VisitConstant(e,t);break;case $data.Expressions.FunctionExpression:n=this.VisitFunction(e,t);break;case $data.Expressions.CallExpression:n=this.VisitCall(e,t);break;case $data.Expressions.SimpleBinaryExpression:n=this.VisitBinary(e,t);break;case $data.Expressions.PropertyExpression:n=this.VisitProperty(e,t);break;case $data.Expressions.ThisExpression:n=this.VisitThis(e,t);break;case $data.Expressions.ObjectLiteralExpression:n=this.VisitObjectLiteral(e,t);break;case $data.Expressions.ObjectFieldExpression:n=this.VisitObjectField(e,t);break;case $data.Expressions.ArrayLiteralExpression:n=this.VisitArrayLiteral(e,t);break;case $data.Expressions.UnaryExpression:n=this.VisitUnary(e,t);break;case $data.Expressions.EntityContextExpression:n=this.VisitEntityContext(e,t);break;default:debugger;break}this._deep=this._deep-1;return n},VisitArrayLiteral:function(e,t){var n=this;var r=e.items.map(function(e){return n.Visit(e,t)});var i=Container.createArrayLiteralExpression(r);return i},VisitObjectLiteral:function(e,t){var n=this;var r=e.members.map(function(e){return n.Visit(e,t)});var i=Container.createObjectLiteralExpression(r);return i},VisitObjectField:function(e,t){var n=this.Visit(e.expression,t);var r=Container.createObjectFieldExpression(e.fieldName,n);return r},VisitThis:function(e,t){return e},VisitCall:function(e,t){var n=this;var r=e.args.map(function(e){return this.Visit(e,t)},this);var i=this.Visit(e.expression,t);var s=this.Visit(e.member,t);return new $data.Expressions.CallExpression(i,s,r)},VisitParameter:function(e,t){return e},VisitConstant:function(e,t){return e},VisitFunction:function(e,t){var n=this;var r=e.parameters.map(function(e,r){return n.Visit(e,t)});var i=n.Visit(e.body,t);var s=new $data.Expressions.FunctionExpression(e.name,r,i);return s},VisitBinary:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);return new $data.Expressions.SimpleBinaryExpression(n,r,e.nodeType,e.operator,e.type)},VisitProperty:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.member,t);return new $data.Expressions.PropertyExpression(n,r)},VisitUnary:function(e,t){var n=this.Visit(e.operand,t);if(n===e.operand)return e;return new $data.Expressions.UnaryExpression(n,e.operator,e.nodeType)},VisitEntityContext:function(e,t){return e},VisitDecision:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.left,t);var i=this.Visit(e.right,t);if(n===e.expression&&r===e.left&&i===e.right)return e;return $data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(e.executable,n,r,i)},VisitNew:function(e,t){var n=this.VisitArray(e.values,t);if(n===e.values)return e;return $data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,n)},VisitArrayAccess:function(e,t){var n=this.Visit(e.array,t);var r=this.Visit(e.index,t);if(n===e.array&&r===e.index)return e;return $data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,n,r)},VisitArray:function(e,t){var n=[];var r=true;for(var i=0;i<e.length;i++){n[i]=this.Visit(e[i],t);r=r&&n[i]===e[i]}return r?e:n},GetMemberChain:function(e,t){if(e.expression.type==MEMBERACCESS){var n=this.GetMemberChain(e.expression,t);n.push(e.member);return n}return[e.expression,e.member]}},{});$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(e,t){if((e instanceof $data.Expressions.ParameterExpression||e instanceof $data.Expressions.ThisExpression)&&this.canResolve(e)){var n=this.resolve(e,t);if(n!==e)n["resolvedBy"]=this.constructor.name;return n}else{return e}},canResolve:function(e){Guard.raise("Pure method")},resolve:function(e){Guard.raise("Pure method")}});$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(e){this.global=e},canResolve:function(e){return e.nodeType==$data.Expressions.ExpressionType.Parameter&&this.global&&typeof this.global==="object"&&e.name in this.global},resolve:function(e){var t=this.global[e.name];var n=Container.createConstantExpression(t,typeof t,e.name);return n}});$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(e,t,n){this.globalResolver=Container.createGlobalContextProcessor(t);this.paramResolver=Container.createGlobalContextProcessor(e);this.paramsObject=e;this.scopeContext=n},canResolve:function(e){return e.name==="$context"||e.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?true:this.paramResolver.canResolve(e)||this.globalResolver.canResolve(e)},resolve:function(e){if(e.name==="$context"){return Container.createEntityContextExpression(this.scopeContext)}if(e.nodeType==$data.Expressions.ExpressionType.This){return Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this")}return this.paramResolver.canResolve(e)?this.paramResolver.resolve(e):this.globalResolver.resolve(e)}});$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(e){this.canResolve=function(t){return t.nodeType==$data.Expressions.ExpressionType.Parameter&&e("typeof "+t.name)!=="undefined"};this.resolve=function(t){var n=e(t.name);var r=Container.createConstantExpression(n,typeof n);return r}}});$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(e){var t={};var n="name";this.canResolve=function(n,r){if(n.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var i=n.owningFunction.parameters;if(i.length==1&&n.name==i[0].name){t[n.name]=e[0];return true}for(var s=0;s<i.length;s++){if(i[s].name==n.name){t[n.name]=e[s];return true}}return false}return false};this.resolve=function(e,n){var r=t[e.name];var i=Container.createParameterExpression(e.name,r,$data.Expressions.ExpressionType.LambdaParameter);i.owningFunction=e.owningFunction;return i}}});$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(e,t){this.lambdaParamCache={}},Visit:function(e,t){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,e,t)},VisitArrayLiteral:function(e,t){var n=this;var r=e.items.map(function(e){return n.Visit(e,t)});var i=r.every(function(e){return e instanceof $data.Expressions.ConstantExpression});if(i){r=r.map(function(e){return e.value});return Container.createConstantExpression(r,"array")}else{return Container.createArrayLiteralExpression(r)}},VisitObjectLiteral:function(e,t){var n=this;var r=e.members.map(function(e){return n.Visit(e,t)});var i=r.every(function(e){return e.expression instanceof $data.Expressions.ConstantExpression});if(i){var s=r.map(function(e){return{name:e.fieldName,value:e.expression.value}});var o=e.implementation(s);return Container.createConstantExpression(o,typeof o)}else{return Container.createObjectLiteralExpression(r)}},VisitThis:function(e,t){return t.Visit(e,t)},VisitParameter:function(e,t){var n;switch(e.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:n=t.Visit(e,t);if(n.nodeType==$data.Expressions.ExpressionType.LambdaParameter){this.lambdaParamCache[n.name]=n}return n;case $data.Expressions.ExpressionType.LambdaParameterReference:var r=this.lambdaParamCache[e.name];if(r){n=Container.createParameterExpression(e.name,r.type,$data.Expressions.ExpressionType.LambdaParameterReference);n.paramIndex=e.paramIndex;return n}break;default:return e}return e},VisitConstant:function(e,t){return e},VisitFunction:function(e,t){var n=this;var r=e.parameters.map(function(e,r){var i=n.Visit(e,t);return i});var i=n.Visit(e.body,t);var s=new $data.Expressions.FunctionExpression(e.name,r,i);return s},VisitBinary:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);var i=$data.Expressions;if(n instanceof i.ConstantExpression&&r instanceof i.ConstantExpression){var s=e.implementation(n.value,r.value);return Container.createConstantExpression(s,typeof s)}return new Container.createSimpleBinaryExpression(n,r,e.nodeType,e.operator,e.type)},VisitUnary:function(e,t){var n=this.Visit(e.operand,t);var r=$data.Expressions;if(n instanceof r.ConstantExpression){var i=e.operator.implementation(n.value);return Container.createConstantExpression(i,typeof i)}return new Container.createUnaryExpression(n,e.operator,e.nodeType)},VisitProperty:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.member,t);var i;if(n instanceof $data.Expressions.ConstantExpression&&r instanceof $data.Expressions.ConstantExpression){i=e.implementation(n.value,r.value);return Container.createConstantExpression(i,typeof i,n.name+"$"+r.value)}if(n===e.expression&&r===e.member)return e;i=Container.createPropertyExpression(n,r);return i},VisitCall:function(e,t){function n(e,t,n){return t instanceof $data.Expressions.ConstantExpression&&(!n||n instanceof $data.Expressions.ConstantExpression)&&e.every(function(e){return e instanceof $data.Expressions.ConstantExpression})}function u(e){if(e instanceof $data.Expressions.ConstantExpression)return e.value;return e}var r=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments);var i=r.expression;var s=r.member;var o=r.args;if(n(o,s,i)){var a=s.value;if(typeof a==="string"&&i.value){a=i.value[a]}if(typeof a!=="function"){Guard.raise("Constant expression is not a method...")}var f=e.implementation(i.value,a,o.map(u));return new $data.Expressions.ConstantExpression(f,typeof f)}return r}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(e){this.Visit=function(t,n){for(var r=0;r<e.length;r++){var i=e[r].Visit(t,n);if(i!==t)return i}return t}}});$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(e,t){},VisitProperty:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.member,t);var i=n.type;var s=t.memberResolver.resolve(i,r.value);r.type=s;return Container.createPropertyExpression(n,r)}},{});$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(e,t){this._deep=this._deep+1;var n=null;switch(e.type){case LITERAL:n=this.VisitLiteral(e,t);break;case VARIABLE:n=this.VisitVariable(e,t);break;case MEMBERACCESS:n=this.VisitMember(e,t);break;case BINARY:n=this.VisitBinary(e,t);break;case UNARY:n=this.VisitUnary(e,t);break;case INCDEC:n=this.VisitIncDec(e,t);break;case EQUALITY:n=this.VisitEquality(e,t);break;case DECISION:n=this.VisitDecision(e,t);break;case METHODCALL:n=this.VisitMethodCall(e,t);break;case NEW:n=this.VisitNew(e,t);break;case JSONASSIGN:n=this.VisitJsonAssign(e,t);break;case ARRAYACCESS:n=this.VisitArrayAccess(e,t);break;default:Guard.raise("Type isn't implemented: "+e.type)}this._deep=this._deep-1;return n},VisitLiteral:function(e,t){return e},VisitVariable:function(e,t){return e},VisitMember:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.member,t);if(n===e.expression&&r===e.member)return e;return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(e.executable,n,r)},VisitBinary:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n===e.left&&r===e.right)return e;return $data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(e.executable,e.operator,n,r)},VisitUnary:function(e,t){var n=this.Visit(e.operand,t);if(n===e.operand)return e;return $data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(e.executable,e.operator,n)},VisitIncDec:function(e,t){var n=this.Visit(e.operand,t);if(n===e.operand)return e;return $data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(e.executable,e.operator,n,e.suffix)},VisitEquality:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n===e.left&&r===e.right)return e;return $data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(e.executable,e.operator,n,r)},VisitDecision:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.left,t);var i=this.Visit(e.right,t);if(n===e.expression&&r===e.left&&i===e.right)return e;return $data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(e.executable,n,r,i)},VisitMethodCall:function(e,t){var n=e.object?this.Visit(e.object,t):null;var r=this.VisitArray(e.args,t);if(n===e.object&&r===e.args)return e;return $data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(e.executable,n,e.method,r)},VisitNew:function(e,t){var n=this.VisitArray(e.values,t);if(n===e.values)return e;return $data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,n)},VisitJsonAssign:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n===e.left&&r===e.right)return e;n.JSONASSIGN=true;r.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,n,r)},VisitArrayAccess:function(e,t){var n=this.Visit(e.array,t);var r=this.Visit(e.index,t);if(n===e.array&&r===e.index)return e;return $data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,n,r)},VisitArray:function(e,t){var n=[];var r=true;for(var i=0;i<e.length;i++){n[i]=this.Visit(e[i],t);r=r&&n[i]===e[i]}return r?e:n},GetMemberChain:function(e,t){if(e.expression.type==MEMBERACCESS){var n=this.GetMemberChain(e.expression,t);n.push(e.member);return n}return[e.expression,e.member]}},{});$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(e,t){switch(e.type){case LITERAL:return this.VisitLiteral(e,t);case VARIABLE:return this.VisitVariable(e,t);case MEMBERACCESS:return this.VisitMember(e,t);case BINARY:return this.VisitBinary(e,t);case UNARY:return this.VisitUnary(e,t);case INCDEC:return this.VisitIncDec(e,t);case EQUALITY:return this.VisitEquality(e,t);case DECISION:return this.VisitDecision(e,t);case METHODCALL:return this.VisitMethodCall(e,t);case NEW:return this.VisitNew(e,t);case JSONASSIGN:return this.VisitJsonAssign(e,t);case ARRAYACCESS:return this.VisitArrayAccess(e,t);default:Guard.raise("Type isn't implemented: "+e.type)}},VisitBinary:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n===e.left&&r===e.right&&n.executable&&r.executable==e.executable)return e;return $data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(n.executable&&r.executable,e.operator,n,r)},VisitUnary:function(e,t){var n=this.Visit(e.operand,t);if(n===e.operand)return e;return $data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(n.executable,e.operator,n)},VisitIncDec:function(e,t){var n=this.Visit(e.operand,t);if(n===e.operand)return e;return $data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(n.executable,e.operator,n,e.suffix)},VisitEquality:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n===e.left&&r===e.right&&n.executable&&r.executable==e.executable)return e;return $data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(n.executable&&r.executable,e.operator,n,r)},VisitDecision:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.left,t);var i=this.Visit(e.right,t);if(n===e.expression&&r===e.left&&i===e.right&&r.executable&&i.executable&&n.executable==e.executable)return e;return $data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(r.executable&&i.executable&&n.executable,n,r,i)},VisitMethodCall:function(e,t){var n=e.object?this.Visit(e.object,t):null;var r=this.VisitArray(e.args,t);if(n===e.object&&r===e.args&&(n==null?true:n.executable)==e.executable)return e;return $data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(n==null?true:n.executable,n,e.method,r)},VisitNew:function(e,t){var n=this.VisitArray(e.values,t);if(n===e.values)return e;return $data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,n)},VisitJsonAssign:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n===e.left&&r===e.right)return e;n.JSONASSIGN=true;r.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,n,r)},VisitArrayAccess:function(e,t){var n=this.Visit(e.array,t);var r=this.Visit(e.index,t);if(n===e.array&&r===e.index)return e;return $data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,n,r)},VisitArray:function(e,t){var n=[];var r=true;for(var i=0;i<e.length;i++){n[i]=this.Visit(e[i],t);r=r&&n[i]===e[i]}return r?e:n},VisitLiteral:function(e,t){return{type:e.type,executable:true,value:e.value,valueType:e.valueType}},VisitVariable:function(e,t){if(typeof t.paramContext[e.name]==undefined)Guard.raise("Variable is not defined in the paramContext: "+e.name);return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,"Math","GLOBALOBJECT")},VisitMember:function(e,t){var n=this.GetMemberChain(e);var r=n[0].name;var i=t.lambdaParams.indexOf(r)>=0;var s=r==t.paramsName;if(!s&&!i)Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+r);return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(s,e.expression,e.member)}},null);$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(e,t){if(!e.executable)return e;var n=e.name==t.paramsName?t.paramContext:window[e.name];if(typeof n=="undefined")Guard.raise(new Exception("Unknown variable in '"+t.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+e.name+"'.","InvalidOperation",{operationName:t.operation,missingParameterName:e.name}));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof n,n)},VisitMember:function(e,t){if(!e.executable)return e;var n=this.GetMemberChain(e);var r;for(var i=0;i<n.length;i++){if(i==0)r=t.paramContext;else r=r[n[i].name]}return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof r,r)},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand!==eNode.operand)eNode=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(eNode.executable,eNode.operator,operand);if(!eNode.executable)return eNode;var value;var src;var operandValue=operand.valueType=="string"?"'"+operand.value+"'":operand.value;src="value = "+eNode.operator+" "+operandValue;eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value)},VisitIncDec:function(e,t){var n=this.Visit(e.operand,t);if(n!==e.operand)e=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(e.executable,e.operator,n,e.suffix);if(!e.executable)return e;var r;if(e.suffix)r=e.operator=="++"?n.value++:n.value--;else r=e.operator=="++"?++n.value:--n.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof r,r)},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left!==eNode.left||right!==eNode.right)eNode=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(eNode.executable,eNode.operator,left,right);if(!eNode.executable)return eNode;var value;var src;var leftValue=left.valueType=="string"?"'"+left.value+"'":left.value;var rightValue=right.valueType=="string"?"'"+right.value+"'":right.value;src="value = "+leftValue+" "+eNode.operator+" "+rightValue;eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value)},VisitEquality:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left!==eNode.left||right!==eNode.right)eNode=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(eNode.executable,eNode.operator,left,right);if(!eNode.executable)return eNode;var value;var src;var leftValue=left.valueType=="string"?"'"+left.value+"'":left.value;var rightValue=right.valueType=="string"?"'"+right.value+"'":right.value;src="value = "+leftValue+" "+eNode.operator+" "+rightValue;eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value)},VisitDecision:function(e,t){var n=this.Visit(e.expression,t);var r=this.Visit(e.left,t);var i=this.Visit(e.right,t);if(n!==e.expression||r!==e.left||i!==e.right)e=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(e.executable,n,r,i);if(!e.executable)return e;var s=n.value?r.value:i.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof s,s)},VisitMethodCall:function(eNode,context){var object=eNode.object?this.Visit(eNode.object,context):null;var args=this.VisitArray(eNode.args,context);if(object!==eNode.object||args!=eNode.args)eNode=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(eNode.executable,object,eNode.method,args);if(!eNode.executable)return eNode;var a=[];for(var i=0;i<args.length;i++){var arg=args[i];var t=typeof arg.value;a.push(t=="string"?"'"+arg.value+"'":arg.value)}var value;var src=object?"value = object.value[eNode.method]("+a.join(",")+");":"value = "+eNode.method+"("+a.join(",")+");";eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value)},VisitArrayAccess:function(e,t){var n=this.Visit(e.array,t);var r=this.Visit(e.index,t);var i=n.value[r.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof i,i)}},null);$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(e){this.context=e},_isLambdaParam:function(e){var t=this.context.lambdaParams;for(var n=0;n<t.length;n++){if(t[n]==e)return true}return false},_isParam:function(e){return this.context.paramContext[e]!=undefined},_isParamRoot:function(e){return this.context.paramsName==e},Build:function(e,t){var n;switch(e.arity){case"infix":if("("==e.value)n=this.BuildMethodCall(e,t);else if("."==e.value)n=this.BuildMember(e,t);else if(["===","==","!==","!=",">","<",">=","<="].indexOf(e.value)>=0)n=this.BuildEquality(e,t);else if(["&&","||"].indexOf(e.value)>=0)n=this.BuildBinary(e,t);else if(["+","-","*","/","%"].indexOf(e.value)>=0)n=this.BuildBinary(e,t);else if("["==e.value)n=this.BuildArrayAccess(e,t);else Guard.raise("Value of infix node isn't implemented: "+e.value);break;case"prefix":if(["+","-","!"].indexOf(e.value)>=0)n=this.BuildUnary(e,t);else if(["++","--"].indexOf(e.value)>=0)n=this.BuildIncDec(e,t);else if("{"==e.value)n=this.BuildNewExpression(e,t);else Guard.raise("Value of prefix node isn't implemented: "+e.value);break;case"suffix":if(["++","--"].indexOf(e.value)>=0)n=this.BuildIncDec(e,t);else Guard.raise("Value of suffix node isn't implemented: "+e.value);break;case"string":case"number":n=this.BuildLiteral(e,t);break;case"ternary":if(e.value=="?")n=this.BuildDecision(e,t);else Guard.raise("Value of ternary node isn't implemented: "+e.value);break;case null:case undefined:if(e.type=="boolean"&&(e.value=="true"||e.value=="false"))n=this.BuildBoolLiteral(e,t);else n=this.BuildVariable(e,t);break;default:Guard.raise("Arity isn't implemented: "+e.arity)}return n},BuildNewExpression:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,[]);var r=e.first;for(var i=0;i<r.length;i++)n.values.push(this.Build(r[i],n));return n},BuildLiteral:function(e,t){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,e.arity,e.value)},BuildBoolLiteral:function(e,t){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,e.type,e.value=="true"?true:false)},BuildVariable:function(e,t){if(!e.first){if(t.type==MEMBERACCESS){var n;if(this._isLambdaParam(e.value))n="LAMBDAPARAM";else if(this._isParamRoot(e.value))n="PARAMETERROOT";else if(this._isParam(e.value))n="PARAMETER";else n="PROPERTY"}else{if(this._isLambdaParam(e.value))n="LAMBDAPARAM";else if(this._isParamRoot(e.value))n="PARAMETERROOT";else if(this._isParam(e.value))n="PARAMETER";else if(window[e.value]!=undefined)n="GLOBALOBJECT";else Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+e.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:e.value}))}return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,e.value,n)}var r=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"name",e.value);var i=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true);var s=this.Build(e.first,i);i.left=r;i.right=s;r.JSONASSIGN=true;s.JSONASSIGN=true;return i},BuildMember:function(e,t){if(e.value!="."||e.arity!="infix"){if(e.type=="string"){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,e.arity,e.value)}return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true,null,e.value)}var n=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true);var r=this.Build(e.first,n);var i=this.Build(e.second,n);n.expression=r;n.member=i;return n},BuildUnary:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(true,e.value);n.operand=this.Build(e.first,n);return n},BuildIncDec:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(true,e.value,null,e.arity=="suffix");n.operand=this.Build(e.first,n);return n},BuildBinary:function(e,t){if(!e.first)Guard.raise("Cannot build binary: node.first is null");if(!e.second)Guard.raise("Cannot build binary: node.second is null");var n=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(true,e.value);n.left=this.Build(e.first,n);n.right=this.Build(e.second,n);return n},BuildEquality:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(true,e.value);n.left=this.Build(e.first,n);n.right=this.Build(e.second,n);return n},BuildDecision:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(true);n.expression=this.Build(e.first,n);n.left=this.Build(e.second,n);n.right=this.Build(e.third,n);return n},BuildMethodCall:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(true);if(e.first.type=="function"){n.object=this.Build(e.first.first,n);n.method=e.first.second.value}else{if(e.first.type!=null)Guard.raise("Cannot build MethodCall because type is "+type);n.object=null;n.method=e.first.value}var r=e.second;var i=[];for(var s=0;s<r.length;s++){var o=r[s];i[s]=this.Build(o,n)}n.args=i;return n},BuildArrayAccess:function(e,t){var n=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true);n.array=this.Build(e.first,n);n.index=this.Build(e.second,n);return n}},null);$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e){this.associationInfo=e},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:true}});$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){if(Container.resolveType(Container.getTypeName(e))==$data.String&&e.replace(/^[\s\xA0]+/,"").match("^function")!="function"){e="function (it) { return "+e+"; }"}this.source=e;this.parameters=t},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:true}});$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(e){this.scopeContext=e;this.parameters=[]},VisitBinary:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(!(n instanceof $data.Expressions.ConstantExpression)&&r instanceof $data.Expressions.ConstantExpression||!(r instanceof $data.Expressions.ConstantExpression)&&n instanceof $data.Expressions.ConstantExpression){var i,s;if(r instanceof $data.Expressions.ConstantExpression){i=n;s=r}else{i=r;s=n}var o;if((o=i.selector)instanceof $data.Expressions.MemberInfoExpression||(o=i.operation)instanceof $data.Expressions.MemberInfoExpression){if(o.memberDefinition&&(o.memberDefinition.type||o.memberDefinition.dataType)){var u=Container.resolveType(o.memberDefinition.type||o.memberDefinition.dataType);var a=Container.resolveType(s.type);if(u!==a){var f=s.value;if(e.operator===$data.Expressions.ExpressionType.In){if(Array.isArray(f)){var l=[];for(var c=0;c<f.length;c++){l.push(new $data.Expressions.ConstantExpression(f[c],u))}f=l;u=$data.Array}else{u=a}}if(r===s){r=new $data.Expressions.ConstantExpression(f,u,r.name)}else{n=new $data.Expressions.ConstantExpression(f,u,n.name)}}}}}var h=this.scopeContext.resolveBinaryOperator(e.nodeType,e,t.frameType);var p=Container.createSimpleBinaryExpression(n,r,e.nodeType,e.operator,e.type,h);return p},VisitUnary:function(e,t){var n=this.Visit(e.operand,t);var r=this.scopeContext.resolveUnaryOperator(e.nodeType,e,t.frameType);var i=Container.createUnaryExpression(n,e.operator,e.nodeType,r);return i},VisitParameter:function(e,t){Guard.requireValue("context",t);var n=$data.Expressions.ExpressionType;switch(e.nodeType){case n.LambdaParameterReference:var r=Container.createEntityExpression(t.lambdaParameters[e.paramIndex],{lambda:e.name});return r;case n.LambdaParameter:break;default:Guard.raise("Global parameter "+e.name+" not found. For query parameters use 'this.field' notation");break}},VisitThis:function(e,t){var n=this.parameters.push({name:"",value:undefined})-1;var r=Container.createQueryParameterExpression("",n,t.queryParameters,undefined);return r},VisitFunction:function(e,t){var n=$data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments);return n.body},VisitCall:function(e,t){var n=this;var r=this.Visit(e.expression,t);var i=this.Visit(e.member,t);var s=e.args.map(function(e){return n.Visit(e,t)});var o;switch(true){case r instanceof $data.Expressions.QueryParameterExpression:var u=s.map(function(e){return e.value});o=e.implementation(r.value,i.value,u);return Container.createQueryParameterExpression(r.name+"$"+i.value,r.index,o,typeof o);case r instanceof $data.Expressions.EntityFieldExpression:case r instanceof $data.Expressions.EntityFieldOperationExpression:var a=this.scopeContext.resolveFieldOperation(i.value,r,t.frameType);if(!a){Guard.raise("Unknown entity field operation: "+i.getJSON())}i=Container.createMemberInfoExpression(a);o=Container.createEntityFieldOperationExpression(r,i,this._resolveFunctionArguments(s,a.parameters));return o;case r instanceof $data.Expressions.EntitySetExpression:var a=this.scopeContext.resolveSetOperations(i.value,r,t.frameType);if(!a){Guard.raise("Unknown entity field operation: "+i.getJSON())}i=Container.createMemberInfoExpression(a);o=Container.createFrameOperationExpression(r,i,this._resolveFunctionArguments(s,a.parameters));return o;case r instanceof $data.Expressions.EntityExpression:var a=this.scopeContext.resolveTypeOperations(i.value,r,t.frameType);if(!a){Guard.raise("Unknown entity function operation: "+i.getJSON())}i=Container.createMemberInfoExpression(a);o=Container.createEntityFunctionOperationExpression(r,i,this._resolveFunctionArguments(s,a.method.params));return o;break;case r instanceof $data.Expressions.EntityContextExpression:var a=this.scopeContext.resolveContextOperations(i.value,r,t.frameType);if(!a){Guard.raise("Unknown entity function operation: "+i.getJSON())}i=Container.createMemberInfoExpression(a);o=Container.createContextFunctionOperationExpression(r,i,this._resolveFunctionArguments(s,a.method.params));return o;break;default:Guard.raise("VisitCall: Only fields can have operations: "+e.getType().name)}},_resolveFunctionArguments:function(e,t){if(t)t=t.filter(function(e,t){return e.name!=="@expression"});if(e.length===1&&e[0]instanceof $data.Expressions.ConstantExpression&&typeof e[0].value==="object"&&e[0].value&&t&&t[0]&&e[0].value.constructor===$data.Object&&t.some(function(t){return t.name in e[0].value})){return t.map(function(t){var n=t.type||t.dataType||e[0].type;return new $data.Expressions.ConstantExpression(e[0].value[t.name],Container.resolveType(n),t.name)})}else{return e.map(function(e,n){if(e instanceof $data.Expressions.ConstantExpression&&t&&t[n]){var r=t[n].type||t[n].dataType||e.type;return new $data.Expressions.ConstantExpression(e.value,Container.resolveType(r),t[n].name)}else{return e}})}},VisitProperty:function(e,t){function i(e){var t=e.dataType;if(typeof t==="function"){return false}}var n=this.Visit(e.expression,t);var r=this.Visit(e.member,t);Guard.requireType("member",r,$data.Expressions.ConstantExpression);switch(n.expressionType){case $data.Expressions.EntityExpression:var s=n.getMemberDefinition(r.value);if(!s){Guard.raise(new Exception("Unknown member: "+r.value,"MemberNotFound"))}var o=s.storageModel.PhysicalType.memberDefinitions.getMember(s.name);var u;var a;switch(o.kind){case"property":a=Container.createMemberInfoExpression(s);u=Container.createEntityFieldExpression(n,a);return u;case"navProperty":var f=s.storageModel.Associations[s.name];var l=Container.createEntitySetExpression(n,Container.createAssociationInfoExpression(f));if(f.ToMultiplicity!=="*"){var c=Container.createEntityExpression(l,{});return c}return l;case"complexProperty":a=Container.createMemberInfoExpression(s);u=Container.createComplexTypeExpression(n,a);return u};case $data.Expressions.ComplexTypeExpression:var h=n.getMemberDefinition(r.value);if(!h){Guard.raise("Unknown member "+r.value+" on "+n.entityType.name)}var p=Container.createMemberInfoExpression(h);var d;if(Container.isPrimitiveType(Container.resolveType(h.dataType))){d=Container.createEntityFieldExpression(n,p);return d}d=Container.createComplexTypeExpression(n,p);return d;case $data.Expressions.QueryParameterExpression:var v=e.implementation(n.value,r.value);this.parameters[n.index].name+="$"+r.value;this.parameters[n.index].value=v;return Container.createQueryParameterExpression(n.name+"$"+r.value,n.index,v,Container.getTypeName(v));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:var m=this.scopeContext.resolveFieldOperation(r.value,n,t.frameType);if(!m){Guard.raise("Unknown entity field operation: "+r.getJSON())}r=Container.createMemberInfoExpression(m);d=Container.createEntityFieldOperationExpression(n,r,[]);return d;default:Guard.raise("Unknown expression type to handle: "+n.expressionType.name)}}});$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){Guard.requireType("source",e,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",t,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=e;this.selector=t;var n=e.entityType.getMemberDefinition(t.memberName).dataType;var r=Container.resolveType(n);this.entityType=r},getMemberDefinition:function(e){return this.entityType.getMemberDefinition(e)},nodeType:{value:$data.Expressions.ExpressionType.Com}});$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e){this.instance=e},instance:{enumerable:false},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:true}});$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){Guard.requireValue("source",e);Guard.requireValue("selector",t);if(!(e instanceof $data.Expressions.EntitySetExpression)&&!(e instanceof $data.Expressions.ServiceOperationExpression)){Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression")}this.source=e;this.selector=t;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",this.entityType);Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(e){var t=this.entityType.getMemberDefinition(e);if(!t){Guard.raise(new Exception("Unknown member "+e+" on type "+this.entityType.name,"MemberNotFound"))}t.storageModel=this.storageModel;return t},nodeType:{value:$data.Expressions.ExpressionType.Entity}});$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(e){return e instanceof $data.Expressions.ExpressionNode},Visit:function(e,t){if(!this.canVisit(e))return e;var n="Visit"+e.getType().name;if(n in this){var r=this[n];var i=r.call(this,e,t);if(typeof i==="undefined"){return e}return i}return e},VisitToArrayExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source){return Container.createToArrayExpression(n)}return e},VisitForEachExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source){return Container.createForEachExpression(n)}return e},VisitMemberInfoExpression:function(e,t){return e},VisitSingleExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source)return Container.createSingleExpression(n);return e},VisitFirstExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source)return Container.createFirstExpression(n);return e},VisitSomeExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source)return Container.createSomeExpression(n);return e},VisitFindExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source)return Container.createFindExpression(n);return e},VisitEveryExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source)return Container.createEveryExpression(n);return e},VisitCountExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source)return Container.createCountExpression(n);return e},VisitBatchDeleteExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source){return Container.createBatchDeleteExpression(n)}return e},VisitObjectLiteralExpression:function(e,t){var n=e.members.map(function(e){return this.Visit(e,t)},this);var r=true;for(var i=0;i<e.members.length;i++){r=r&&e.members[i]===n[i]}if(!r){return Container.createObjectLiteralExpression(n)}return e},VisitObjectFieldExpression:function(e,t){var n=this.Visit(e.expression,t);if(e.expression!==n){return Container.createObjectFieldExpression(e.fieldName,n)}return e},VisitIncludeExpression:function(e,t){var n=this.Visit(e.source,t);if(n!==e.source){return Container.createIncludeExpression(n,e.selector)}return e},VisitUnaryExpression:function(e,t){var n=this.Visit(e.operand,t);if(e.operand!==n){return Container.createUnaryExpression(n,e.operator,e.nodeType,e.resolution)}return e},VisitSimpleBinaryExpression:function(e,t){var n=this.Visit(e.left,t);var r=this.Visit(e.right,t);if(n!==e.left||r!==e.right){return new $data.Expressions.SimpleBinaryExpression(n,r,e.nodeType,e.operator,e.type,e.resolution)}return e},VisitEntityContextExpression:function(e,t){return e},VisitCodeExpression:function(e,t){return e},VisitComplexTypeExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){var i=Container.createComplexTypeExpression(n,r);return i}return e},VisitEntityExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){var i=Container.createEntityExpression(n,r);return i}return e},VisitEntityFieldExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){var i=Container.createEntityFieldExpression(n,r);return i}return e},VisitEntityFieldOperationExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.operation,t);var i=e.parameters.map(function(e){return this.Visit(e)},this);var s=Container.createEntityFieldOperationExpression(n,r,i);return s},VisitParametricQueryExpression:function(e,t){var n=this.Visit(e.expression,t);var r=e.parameters.map(function(e){return this.Visit(e)},this);var i=Container.createParametricQueryExpression(n,r);return i},VisitEntitySetExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createEntitySetExpression(n,r,e.params,e.instance)}return e},VisitInlineCountExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createInlineCountExpression(n,r,e.params,e.instance)}return e},VisitFilterExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createFilterExpression(n,r,e.params,e.instance)}return e},VisitProjectionExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){var i=Container.createProjectionExpression(n,r,e.params,e.instance);i.projectionAs=e.projectionAs;return i}return e},VisitOrderExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createOrderExpression(n,r,e.nodeType)}return e},VisitPagingExpression:function(e,t){var n=this.Visit(e.source,t);var r=this.Visit(e.amount,t);if(n!==e.source||r!==e.amount){return Container.createPagingExpression(n,r,e.nodeType)}return e}});$C("$data.Expressions.ExpressionMonitor",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(e){this.Visit=function(t,n){var r=t;var i;if(this.canVisit(t)){if(e.VisitExpressionNode){e.VisitExpressionNode.apply(e,arguments)}i="Visit"+t.getType().name;if(i in e){r=e[i].apply(e,arguments)}}var s=arguments;if(r!==t)s=[r,n];r=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,s);s=[r,n];if(this.canVisit(r)){var o=r.getType().name;if(e.MonitorExpressionNode){e.MonitorExpressionNode.apply(e,s)}i="Monitor"+o;if(i in e){e[i].apply(e,s)}if(e.MutateExpressionNode){e.MutateExpressionNode.apply(e,s)}i="Mutate"+o;if(i in e){r=e[i].apply(e,s)}}return r}}});$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){this.selector=t;this.source=e;if(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name){this.memberName=this.selector.name}},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.source=e;this.operation=t;this.parameters=n},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n,r){function i(){var t=e;while(t){if(t instanceof $data.Expressions.EntityContextExpression){return t}t=t.source}}Guard.requireType("source",e,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",e,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);this.source=e;this.selector=t;this.params=n;this.instance=r;this.storage_type={};var s=i();switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",t,$data.Expressions.MemberInfoExpression);this.elementType=t.memberDefinition.elementType;this.storageModel=s.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",t,$data.Expressions.AssociationInfoExpression);this.elementType=t.associationInfo.ToType;this.storageModel=s.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof $data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("take and skip must be the last expressions in the chain!");break}},instance:{enumerable:false},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,enumerable:true}});$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n){this.source=e;this.operation=t;this.parameters=n},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});$C("$data.Expressions.EntityFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.EntityFunctionOperation}});$C("$data.Expressions.ContextFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.ContextFunctionOperation}});$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(e,t){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:true}});$C("$data.Expressions.InlineCountExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(e,t){},nodeType:{value:$data.Expressions.ExpressionType.InlineCount,enumerable:true}});$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=true}});$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:true}});$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:true}});$C("$data.Expressions.FindExpression",$data.Expressions.FrameOperator,null,{constructor:function(e,t){this.source=e;this.params=t;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Find,enumerable:true}});$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:true}});$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:true}});$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:true}});$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:true}});$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:true}});$C("$data.Expressions.BatchDeleteExpression",$data.Expressions.FrameOperator,null,{constructor:function(e){this.source=e;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.BatchDelete,enumerable:true}});$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(e,t){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:true},toString:function(e){var t="unimplemented";return t}},null);$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e){this.memberDefinition=e;this.memberName=e.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:true}});$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(e,t,n){this.nodeType=n},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:true},toString:function(e){var t="unimplemented";return t}},null);$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t){this.expression=e;this.parameters=t||[]},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:true}});$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(e,t,n,r){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:true}});$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(e){Guard.requireValue("scopeContext",e);this.scopeContext=e},VisitEntitySetExpression:function(e,t){if(e.source instanceof $data.Expressions.EntityContextExpression){this.lambdaTypes.push(e)}return e},VisitServiceOperationExpression:function(e,t){if(e.source instanceof $data.Expressions.EntityContextExpression){this.lambdaTypes.push(e)}return e},VisitCodeExpression:function(e,t){var n=e.source.toString();var r=Container.createCodeParser(this.scopeContext).createExpression(n);this.scopeContext.log({event:"JSCodeExpression",data:r});var i=Container.createConstantValueResolver(e.parameters,window,this.scopeContext);var s=Container.createParameterResolverVisitor();r=s.Visit(r,i);this.scopeContext.log({event:"JSCodeExpressionResolved",data:r});var o=Container.createCodeToEntityConverter(this.scopeContext);var u=o.Visit(r,{queryParameters:e.parameters,lambdaParameters:this.lambdaTypes,frameType:t.frameType});var a=Container.createParametricQueryExpression(u,o.parameters);this.scopeContext.log({event:"EntityExpression",data:u});return a},VisitFilterExpression:function(e,t){var n=this.Visit(e.source,t);t=t||{};t.frameType=e.getType();var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createFilterExpression(n,r,e.params,e.instance)}return e},VisitInlineCountExpression:function(e,t){var n=this.Visit(e.source,t);t=t||{};t.frameType=e.getType();var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createInlineCountExpression(n,r,e.params,e.instance)}return e},VisitProjectionExpression:function(e,t){var n=this.Visit(e.source,t);t=t||{};t.frameType=e.getType();var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){var i=Container.createProjectionExpression(n,r,e.params,e.instance);i.projectionAs=e.projectionAs;return i}return e},VisitOrderExpression:function(e,t){var n=this.Visit(e.source,t);t=t||{};t.frameType=e.getType();var r=this.Visit(e.selector,t);if(n!==e.source||r!==e.selector){return Container.createOrderExpression(n,r,e.nodeType)}return e}});$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n,r){this.name=e;this.index=t;this.value=n;this.type=Container.getTypeName(n)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:false}});$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e){},getMemberDefinition:function(e){return this.entityType.getMemberDefinition(e)},nodeType:{value:$data.Expressions.ExpressionType.Entity}});$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(e,t,n,r,i){function s(){var t=e;while(t){if(t instanceof $data.Expressions.EntityContextExpression){return t}t=t.source}}Guard.requireType("source",e,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",e,[$data.Expressions.MemberInfoExpression]);this.source=e;this.selector=t;this.params=n;this.cfg=r;this.boundItem=i;var o=s();switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=r.elementType?Container.resolveType(r.elementType):this.elementType?Container.resolveType(r.returnType):null;this.storageModel=r.elementType?o.instance._storageModel.getStorageModel(Container.resolveType(r.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:true}});$C("$data.Expressions.ContinuationExpressionBuilder",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(e){this.mode=e},compile:function(e){var t={mode:"find",skipExists:false};this.Visit(e.expression,t);var n={skip:t.skipSize,take:t.pageSize,message:""};if("pageSize"in t){var r;var i={mode:this.mode,pageSize:t.pageSize};if(!t.skipExists&&t.pageSize){i.append=true;r=this.Visit(e.expression,i)}else if(t.skipExists){r=this.Visit(e.expression,i)}if(!i.abort){n.expression=r}else{n.skip=(n.skip||0)-n.take;n.message="Invalid skip value!"}}else{n.message="take expression not defined in the chain!"}return n},VisitPagingExpression:function(e,t){switch(t.mode){case"find":if(e.nodeType===$data.Expressions.ExpressionType.Take){t.pageSize=e.amount.value}else{t.skipSize=e.amount.value;t.skipExists=true}break;case"prev":if(e.nodeType===$data.Expressions.ExpressionType.Skip){var n=e.amount.value-t.pageSize;t.abort=n<0&&e.amount.value>=t.pageSize;var r=Container.createConstantExpression(Math.max(n,0),"number");return Container.createPagingExpression(e.source,r,e.nodeType)}else if(t.append){t.abort=true}break;case"next":if(e.nodeType===$data.Expressions.ExpressionType.Skip){var n=t.pageSize+e.amount.value;var r=Container.createConstantExpression(n,"number");return Container.createPagingExpression(e.source,r,e.nodeType)}else if(t.append){var r=Container.createConstantExpression(t.pageSize,"number");return Container.createPagingExpression(e,r,$data.Expressions.ExpressionType.Skip)}break;default:}this.Visit(e.source,t)}});$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(e,t,n){this.Message=e;this.PropertyDefinition=t;this.Type=n},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(e){return[]},ValidateEntityField:function(e,t){return[]},getValidationValue:function(e,t){Guard.raise("Pure class")},getValidationMessage:function(e,t,n){Guard.raise("Pure class")}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase;$data.Class.define("$data.Validation.Defaults",null,null,null,{validators:{value:{required:function(e,t){return!Object.isNullOrUndefined(e)},customValidator:function(e,t){return Object.isNullOrUndefined(e)||typeof t=="function"?t(e):true},minValue:function(e,t){return Object.isNullOrUndefined(e)||e>=t},maxValue:function(e,t){return Object.isNullOrUndefined(e)||e<=t},minLength:function(e,t){return Object.isNullOrUndefined(e)||e.length>=t},maxLength:function(e,t){return Object.isNullOrUndefined(e)||e.length<=t},length:function(e,t){return Object.isNullOrUndefined(e)||e.length==t},regex:function(e,t){return Object.isNullOrUndefined(e)||e.match(typeof t==="string"?new RegExp(t.indexOf("/")===0&&t.lastIndexOf("/")===t.length-1?t.slice(1,-1):t):t)}}},_getGroupValidations:function(e){var t={};if(Array.isArray(e)){for(var n=0;n<e.length;n++){var r=e[n];if(typeof this.validators[r]==="function"){t[r]=this.validators[r]}}}return t}});$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(e){var t=[];e.getType().memberDefinitions.getPublicMappedProperties().forEach(function(n){t=t.concat(this.ValidateEntityField(e,n,undefined,true))},this);return t},ValidateEntityField:function(e,t,n,r){var i=[];var s=Container.resolveType(t.dataType);var o=Container.resolveName(s);var u=!r?n:e[t.name];if(!t.inverseProperty&&s&&typeof s.isAssignableTo==="function"&&s.isAssignableTo($data.Entity)){o=$data.Entity.fullName}this.fieldValidate(e,t,u,i,o);return i},getValidationValue:function(e,t){var n;if(e[t]&&e[t].value)n=e[t].value;else n=e[t];if(this.convertableValidation[t]){var r;if(this.convertableValidation[t]===true){r=e.type}else{r=this.convertableValidation[t]}if(r)n=Container.convertTo(n,r,e.elementType)}return n},getValidationMessage:function(e,t,n){var r=n;if(typeof e[t]=="object"&&e[t].message)r=e[t].message;else if(e.errorMessage)r=e.errorMessage;return r},createValidationError:function(e,t,n){return new $data.Validation.ValidationError(this.getValidationMessage(e,t,n),e,t)},convertableValidation:{value:{required:"$data.Boolean",minValue:true,maxValue:true,minLength:"$data.Integer",maxLength:"$data.Integer",length:"$data.Integer"}},supportedValidations:{value:{"$data.ObjectID":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Byte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.SByte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Decimal":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Float":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Number":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int16":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Integer":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int32":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int64":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.String":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length","regex"]),"$data.Date":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.DateTimeOffset":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Time":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Boolean":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Array":$data.Validation.Defaults._getGroupValidations(["required","customValidator","length"]),"$data.Object":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Guid":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Blob":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length"]),"$data.GeographyPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"])}},fieldValidate:function(e,t,n,r,i){if(e.entityState==$data.EntityState.Modified&&e.changedProperties&&e.changedProperties.indexOf(t)<0)return;var s=this.supportedValidations[i];if(s){var o=Object.keys(s);o.forEach(function(i){if(t[i]&&s[i]&&!s[i].call(e,n,this.getValidationValue(t,i)))r.push(this.createValidationError(t,i,"Validation error!"))},this);if(i===$data.Entity.fullName&&n instanceof $data.Entity&&!n.isValid()){r.push(this.createValidationError(t,"ComplexProperty","Validation error!"))}}}},null);$data.Validation.Entity=new $data.Validation.EntityValidation;$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(e){Guard.raise("Pure class")}},null);$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(e){Guard.raise("Pure class")},processChangedData:function(e){if(this.Distrbutor&&this.Distrbutor.distributeData)this.Distrbutor.distributeData(this.buildData(e))},Distrbutor:{enumerable:false,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:true}},null);$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(e){this.broadcastUrl=e},distributeData:function(e){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(e),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(e){var t=[];e.forEach(function(e){var n={entityState:e.data.entityState,typeName:e.data.getType().name};var r=[];switch(e.data.entityState){case $data.EntityState.Added:r=e.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:r=e.data.changedProperties;break;case $data.EntityState.Deleted:r=e.data.getType().memberDefinitions.getKeyProperties();break;default:break}r.forEach(function(t){n[t.name]=e.data[t.name]});t.push(n)});return t}},null);$data.Class.define("$data.Transaction",null,null,{constructor:function(){this._objectId=(new Date).getTime();$data.Trace.log("create: ",this._objectId);this.oncomplete=new $data.Event("oncomplete",this);this.onerror=new $data.Event("onerror",this)},abort:function(){Guard.raise(new Exception("Not Implemented","Not Implemented",arguments))},_objectId:{type:$data.Integer},transaction:{type:$data.Object},oncomplete:{type:$data.Event},onerror:{type:$data.Event}},null);$data.Class.define("$data.Access",null,null,{},{isAuthorized:function(e,t,n,r){var i=new $data.PromiseHandler;var s=i.createCallback(r);var o=i.getPromise();s.success(true);return o},getAccessBitmaskFromPermission:function(e){var t=$data.Access.None;if(e.Create)t|=$data.Access.Create;if(e.Read)t|=$data.Access.Read;if(e.Update)t|=$data.Access.Update;if(e.Delete)t|=$data.Access.Delete;if(e.DeleteBatch)t|=$data.Access.DeleteBatch;if(e.Execute)t|=$data.Access.Execute;return t},None:{value:0},Create:{value:1},Read:{value:2},Update:{value:4},Delete:{value:8},DeleteBatch:{value:16},Execute:{value:32}});$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe","Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null);$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(e){e=$data.typeSystem.createCallbackSetting(e);return cbWrapper={success:e.success,error:e.error,notify:e.notify}},getPromise:function(){return new $data.Promise}},null);$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(e,t,n){this.handler=e;this.state=t;this.thisArg=n},handler:{},state:{},thisArg:{}});$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(e,t){function i(e,t){e.forEach(function(n,r){if(n.handler==t){e.splice(r,1)}})}var n=null;var r=t;this.attach=function(e,r,i){if(!n){n=[]}n.push(new EventSubscriber(e,r,i||t))};this.detach=function(e){i(n,e)};this.fire=function(e,r){var i=r||t||this;if(n){n.forEach(function(t){try{t.handler.call(t.thisArg,i,e,t.state)}catch(n){console.log("unhandled exception in event handler. exception suppressed");console.dir(n)}})}};this.fireCancelAble=function(e,r){var i=r||t||this;var s=true;if(n){n.forEach(function(t){try{s=s&&(t.handler.call(t.thisArg,i,e,t.state)===false?false:true)}catch(n){console.log("unhandled exception in event handler. exception suppressed");console.dir(n)}})}return s}}});var eventData=$data.Class.define("EventData",null,null,{eventName:{}});var PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(e,t,n){this.propertyName=e;this.oldValue=t;this.newValue=n},propertyName:{},oldValue:{},newValue:{}});var PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(e,t,n,r){this.propertyName=e;this.oldValue=t;this.newValue=n;this.errors=r;this.cancel=false},propertyName:{},oldValue:{},newValue:{},errors:{},cancel:{}});$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(e,t){this.initData={};var n=this.getType();if(n.__copyPropertiesToInstance){$data.typeSystem.writePropertyValues(this)}var r=null;this.context=r;if("setDefaultValues"in n){if(!t||t.setDefaultValues!==false){if(!e||Object.keys(e).length<1){e=n.setDefaultValues(e)}}}if(typeof e==="object"){var i=n.memberDefinitions;var s=i.getPublicMappedPropertyNames();for(var o in e){if(s.indexOf(o)>-1){var u=i.getMember(o);var a=Container.resolveType(u.type);var f=e[o];if(u.concurrencyMode===$data.ConcurrencyMode.Fixed){this.initData[o]=f}else{if(t&&t.converters){var l=t.converters[Container.resolveName(a)];if(l)f=l(f)}this.initData[o]=Container.convertTo(f,a,u.elementType,t)}}}}if(t&&t.entityBuilder){t.entityBuilder(this,n.memberDefinitions.asArray(),n)}this.changedProperties=undefined;this.entityState=undefined},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var e={};var t=this;this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(n){if(t[n.name]instanceof Date&&n.type&&Container.resolveType(n.type)===$data.DateTimeOffset){e[n.name]=new $data.DateTimeOffset(t[n.name])}else{e[n.name]=t[n.name]}});return e},equals:function(e){if(e.getType()!==this.getType()){return false}var t=this.getType().memberDefinitions.getKeyProperties();for(var n=0;n<t.length;n++){if(this[t[n].name]!=e[t[n].name]){return false}}return true},propertyChanging:{dataType:$data.Event,storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,prototypeProperty:true,get:function(){if(!this._propertyChanging)this._propertyChanging=new Event("propertyChanging",this);return this._propertyChanging},set:function(e){this._propertyChanging=e}},propertyChanged:{dataType:$data.Event,storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,prototypeProperty:true,get:function(){if(!this._propertyChanged)this._propertyChanged=new Event("propertyChanged",this);return this._propertyChanged},set:function(e){this._propertyChanged=e}},propertyValidationError:{dataType:$data.Event,storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,prototypeProperty:true,get:function(){if(!this._propertyValidationError)this._propertyValidationError=new Event("propertyValidationError",this);return this._propertyValidationError},set:function(e){this._propertyValidationError=e}},storeProperty:function(e,t){if(e.concurrencyMode!==$data.ConcurrencyMode.Fixed){t=Container.convertTo(t,e.type,e.elementType)}var n=null;if(e.monitorChanges!=false&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)){var r=this[e.name];n=new PropertyChangeEventData(e.name,r,t);if(this._propertyChanging)this.propertyChanging.fire(n)}if(e.monitorChanges!=false&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)){var i=$data.Validation.Entity.ValidateEntityField(this,e,t);if(i.length>0){var r=this[e.name];var s=new PropertyValidationEventData(e.name,r,t,i);if(this._propertyValidationError)this.propertyValidationError.fire(s);if("instancePropertyValidationError"in this.constructor)this.constructor["instancePropertyValidationError"].fire(s,this);if(s.cancel==true)return}}if(e.storeOnObject==true){var o="_"+e.name;this[o]=t}else{this.initData[e.name]=t}this.isValidated=false;if(e.monitorChanges!=false&&this.entityState==$data.EntityState.Unchanged)this.entityState=$data.EntityState.Modified;this._setPropertyChanged(e);if(e.monitorChanges!=false){if(this._propertyChanged)this.propertyChanged.fire(n);if("instancePropertyChanged"in this.constructor){this.constructor["instancePropertyChanged"].fire(n,this)}}},_setPropertyChanged:function(e){if(e.monitorChanges!=false){if(!this.changedProperties){this.changedProperties=[]}if(!this.changedProperties.some(function(t){return t.name==e.name}))this.changedProperties.push(e)}},retrieveProperty:function(e){if(e.storeOnObject==true){var t="_"+e.name;return this[t]}else{return this.initData[e.name]}},getProperty:function(e,t,n){t=$data.typeSystem.createCallbackSetting(t);if(this[e.name]!=undefined){if(n instanceof $data.Transaction)t.success(this[e.name],n);else t.success(this[e.name]);return}var r=this.context;if(!this.context){try{var i=this;var s=this.storeToken||this.getType().storeToken;if(s&&typeof s.factory==="function"){var o=s.factory();return o.onReady().then(function(n){return n.loadItemProperty(i,e,t)})}}catch(u){}Guard.raise(new Exception("Entity not in context","Invalid operation"))}else{return r.loadItemProperty(this,e,t,n)}},setProperty:function(e,t,n,r){this[e.name]=t;var i=new $data.PromiseHandler;n=i.createCallback(n);n.success(this[e.name]);return i.getPromise()},isValid:function(){if(!this.isValidated){this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this);this.isValidated=true}return this.ValidationErrors.length==0},isValidated:{dataType:"bool",storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,value:false},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:true,monitorChanges:true,notMapped:true,enumerable:false},resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window["MemberDefinition"],storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false},entityState:{dataType:"integer",storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false},remove:function(){if($data.ItemStore&&"EntityInstanceRemove"in $data.ItemStore)return $data.ItemStore.EntityInstanceRemove.apply(this,arguments);else throw"not implemented"},save:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceSave.apply(this,arguments);else throw"not implemented"},refresh:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceRefresh.apply(this,arguments);else throw"not implemented"},storeToken:{type:Object,monitorChanges:false,notMapped:true,storeOnObject:true},getFieldUrl:function(e){if(this.context){return this.context.getFieldUrl(this,e)}else if(this.getType().storeToken&&typeof this.getType().storeToken.factory==="function"){var t=this.getType().storeToken.factory();return t.getFieldUrl(this,e)}else if(this.getType().storeToken){try{var n=$data.ItemStore._getContextPromise("default",this.getType());if(n instanceof $data.EntityContext){return n.getFieldUrl(this,e)}}catch(r){}}return"#"}},{__setPropertyfunctions:{value:true,notMapped:true,enumerable:false,storeOnObject:true},__copyPropertiesToInstance:{value:false,notMapped:true,enumerable:false,storeOnObject:true},inheritedTypeProcessor:function(e){if($data.ItemStore&&"EntityInheritedTypeProcessor"in $data.ItemStore)$data.ItemStore.EntityInheritedTypeProcessor.apply(this,arguments);e.defaultValues={};e.memberDefinitions.asArray().forEach(function(t){if(t.hasOwnProperty("defaultValue")){e.defaultValues[t.name]=t.defaultValue}});if(Object.keys(e.defaultValues).length>0){e.setDefaultValues=function(t,n){t=t||{};var r=e.defaultValues;for(var i in r){if(!(i in t)){var s=r[i];if("function"===typeof s){t[i]=r[i](i,n)}else{t[i]=r[i]}}}return t}}},addEventListener:function(e,t){var n="on"+e;if(!(n in this)){this[n]=new $data.Event(e,this)}this[n].attach(t)},removeEventListener:function(e,t){var n="on"+e;if(!(n in this)){return}this[n].detach(t)},raiseEvent:function(e,t){var n="on"+e;if(!(n in this)){return}this[n].fire(t)},getFieldNames:function(){return this.memberDefinitions.getPublicMappedPropertyNames()},"from$data.Object":function(e,t,n,r){if(!Object.isNullOrUndefined(e)){var i;if(r&&r.converters){i={converters:r.converters}}return new this(e,i)}else{return e}}});$data.define=function(e,t,n){if(t&&!(t instanceof $data.ContainerClass)){n=t;t=undefined}if(!n){throw new Error("json object type is not supported yet")}var r={};var i=false;var s=[];Object.keys(n).forEach(function(e){var t=n[e];if(typeof t==="object"&&("type"in t||"get"in t||"set"in t)){r[e]=t;if(t.key){s.push(t)}if(("get"in t||"set"in t)&&(!("notMapped"in t)||t.notMapped===true)){t.notMapped=true;t.storeOnObject=true}if("get"in t&&!("set"in t)){t.set=function(){}}else if("set"in t&&!("get"in t)){t.get=function(){}}}else{r[e]={type:t}}});if(s.length<1){var o;switch(true){case"id"in r:o="id";break;case"Id"in r:o="Id";break;case"ID"in r:o="ID";break}if(o){r[o].key=true;var u=$data.Container.resolveName(r[o].type);r[o].computed=true}else{r.Id={type:"int",key:true,computed:true}}}var a=$data.Entity.extend(e,t,r);return a};$data.implementation=function(e){return Container.resolveType(e)};(function(){$data.defaults=$data.defaults||{};$data.defaults.defaultDatabaseName="JayDataDefault"})();$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},TableName:{},TableOptions:{value:undefined},ComplexTypes:{},Associations:{},ContextType:{},Roles:{}},null);$data.Class.define("$data.Association",null,null,{constructor:function(e){if(e){this.From=e.From;this.FromType=e.FromType;this.FromMultiplicity=e.FromMultiplicity;this.FromPropertyName=e.FromPropertyName;this.To=e.To;this.ToType=e.ToType;this.ToMultiplicity=e.ToMultiplicity;this.ToPropertyName=e.ToPropertyName}},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);$data.Class.define("$data.ComplexType",$data.Association,null,{},null);$data.Class.define("$data.EntityContext",null,null,{constructor:function(e){if($data.ItemStore&&"ContextRegister"in $data.ItemStore)$data.ItemStore.ContextRegister.apply(this,arguments);if(e.queryCache)this.queryCache=e.queryCache;if("string"===typeof e){if(0===e.indexOf("http")){e={name:"oData",oDataServiceHost:e}}else{e={name:"local",databaseName:e}}}if("provider"in e){e.name=e.provider}this.lazyLoad=false;this.trackChanges=false;this._entitySetReferences={};this._storageModel=[];var t=this;t._isOK=false;var n=this._successInitProvider;this._successInitProvider=function(e){if(e instanceof $data.EntityContext){n(t)}else{n(t,e)}};this._storageModel.getStorageModel=function(e){var n=Container.resolveName(e);return t._storageModel[n]};if(typeof e.name==="string"){var r=e.name;e.name=[r]}var i=0,s;var o=[].concat(e.name);var u=$data.typeSystem.createCallbackSetting({success:this._successInitProvider,error:this._successInitProvider});this._initStorageModelSync();t._initializeEntitySets(t.getType());$data.StorageProviderLoader.load(o,{success:function(n){t.storageProvider=new n(e,t);t.storageProvider.setContext(t);t.stateManager=new $data.EntityStateManager(t);var r=t.getType();if(n.name in r._storageModelCache){t._storageModel=r._storageModelCache[n.name]}else{t._initializeStorageModel();r._storageModelCache[n.name]=t._storageModel}if(e&&e.user)Object.defineProperty(t,"user",{value:e.user,enumerable:true});if(e&&e.checkPermission)Object.defineProperty(t,"checkPermission",{value:e.checkPermission,enumerable:true});if(t.storageProvider){t.storageProvider.initializeStore(u)}},error:function(){u.error("Provider fallback failed!")}});this.addEventListener=function(e,t){var n="on"+e;if(!(n in this)){this[n]=new $data.Event(e,this)}this[n].attach(t)};this.removeEventListener=function(e,t){var n="on"+e;if(!(n in this)){return}this[n].detach(t)};this.raiseEvent=function(e,t){var n="on"+e;if(!(n in this)){return}this[n].fire(t)};this.ready=this.onReady({success:$data.defaultSuccessCallback,error:function(){if($data.PromiseHandler!==$data.PromiseHandlerBase){$data.defaultErrorCallback.apply(this,arguments)}else{$data.Trace.error(arguments)}}})},beginTransaction:function(){function r(r){if(Object.isNullOrUndefined(r))return;if(typeof r==="boolean"){n=r}else if(Array.isArray(r)){e=r}else{t=r}}var e=null;var t=null;var n=false;r(arguments[0]);r(arguments[1]);r(arguments[2]);var i=new $data.PromiseHandler;t=i.createCallback(t);this.storageProvider._beginTran(e,n,t);return i.getPromise()},_isReturnTransaction:function(e){return e instanceof $data.Base||e==="returnTransaction"},_applyTransaction:function(e,t,n,r,i){if(i===true){if(r instanceof $data.Transaction){Array.prototype.push.call(n,r);t.apply(e,n)}else{this.beginTransaction(function(r){Array.prototype.push.call(n,r);t.apply(e,n)})}}else{t.apply(e,n)}},getDataType:function(dataType){if(typeof dataType=="string"){var memDef_dataType=this[dataType];if(memDef_dataType===undefined||memDef_dataType===null){memDef_dataType=eval(dataType)}return memDef_dataType}return dataType},_initializeEntitySets:function(e){for(var t=0,n=this._storageModel.length;t<n;t++){var r=this._storageModel[t];this[r.ItemName]=new $data.EntitySet(r.LogicalType,this,r.ItemName,r.EventHandlers,r.Roles);var i=this[r.ItemName];i.name=r.ItemName;i.tableName=r.TableName;i.tableOptions=r.TableOptions;i.eventHandlers=r.EventHandlers;this._entitySetReferences[r.LogicalType.name]=i;this._initializeActions(i,e,e.getMemberDefinition(r.ItemName))}},_initStorageModelSync:function(){var e=this.getType().memberDefinitions.asArray();for(var t=0;t<e.length;t++){var n=e[t];if("dataType"in n){var r=Container.resolveType(n.dataType);if(r&&r.isAssignableTo&&r.isAssignableTo($data.EntitySet)){var i=Container.resolveType(n.elementType);var s=new $data.StorageModel;s.TableName=n.tableName||n.name;s.TableOptions=n.tableOptions;s.ItemName=n.name;s.LogicalType=i;s.LogicalTypeName=i.name;s.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(s.LogicalTypeName);s.ContextType=this.getType();s.Roles=n.roles;if(n.indices){s.indices=n.indices}if(n.beforeCreate){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.beforeCreate=n.beforeCreate}if(n.beforeRead){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.beforeRead=n.beforeRead}if(n.beforeUpdate){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.beforeUpdate=n.beforeUpdate}if(n.beforeDelete){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.beforeDelete=n.beforeDelete}if(n.afterCreate){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.afterCreate=n.afterCreate}if(n.afterRead){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.afterRead=n.afterRead}if(n.afterUpdate){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.afterUpdate=n.afterUpdate}if(n.afterDelete){if(!s.EventHandlers)s.EventHandlers={};s.EventHandlers.afterDelete=n.afterDelete}this._storageModel.push(s);var o=Container.resolveName(i);this._storageModel[o]=s}}}},_initializeStorageModel:function(){var e=this.getType().memberDefinitions.asArray();if(typeof intellisense!=="undefined")return;for(var t=0;t<this._storageModel.length;t++){var n=this._storageModel[t];var r={};n.Associations=n.Associations||[];n.ComplexTypes=n.ComplexTypes||[];for(var i=0;i<n.LogicalType.memberDefinitions.getPublicMappedProperties().length;i++){var s=n.LogicalType.memberDefinitions.getPublicMappedProperties()[i];var o=Container.resolveType(s.dataType);if(this.storageProvider.supportedDataTypes.indexOf(o)>-1&&Object.isNullOrUndefined(s.inverseProperty)){var u=JSON.parse(JSON.stringify(s));u.dataType=o;r[s.name]=u;continue}this._buildDbType_navigationPropertyComplite(s,o,n);if((o===$data.Array||o.isAssignableTo&&o.isAssignableTo($data.EntitySet))&&s.inverseProperty&&s.inverseProperty!=="$$unbound"){this._buildDbType_Collection_OneManyDefinition(r,n,o,s)}else{if(s.inverseProperty){if(s.inverseProperty==="$$unbound"){if(o===$data.Array){this._buildDbType_Collection_OneManyDefinition(r,n,o,s)}else{this._buildDbType_ElementType_OneManyDefinition(r,n,o,s)}}else{var a=o.memberDefinitions.getMember(s.inverseProperty);if(a){if(a.elementType){var f=Container.resolveType(a.elementType);if(f===n.LogicalType){this._buildDbType_ElementType_OneManyDefinition(r,n,o,s)}else{if(typeof intellisense==="undefined"){Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+n.LogicalTypeName,", property: "+s.name))}}}else{this._buildDbType_ElementType_OneOneDefinition(r,n,o,s)}}else{if(typeof intellisense==="undefined"){Guard.raise(new Exception("Inverse property not valid"))}}}}else{this._buildDbType_addComplexTypePropertyDefinition(r,n,o,s)}}}this._buildDbType_modifyInstanceDefinition(r,n,this);var l={};l.convertTo=this._buildDbType_generateConvertToFunction(n,this);this._buildDbType_modifyClassDefinition(l,n,this);n.PhysicalType=$data.Class.define(n.PhysicalTypeName,$data.Entity,n.LogicalType.container,r,l)}},_initializeActions:function(e,t,n){if(n&&n.actions){var r=Object.keys(n.actions);for(var i=0;i<r.length;i++){var s=r[i];var o=n.actions[s];if(typeof o==="function"){e[s]=o}else{var u=$data.MemberDefinition.translateDefinition(o,s,t);if(u instanceof $data.MemberDefinition&&u.kind===$data.MemberTypes.method){e[s]=u.method}}}}},_buildDbType_navigationPropertyComplite:function(e,t,n){if(!e.inverseProperty){var r=null;if(t===$data.Array||t.isAssignableTo&&t.isAssignableTo($data.EntitySet)){var i=this._storageModel.getStorageModel(Container.resolveType(e.elementType));if(i){r=[];var s=i.LogicalType.memberDefinitions.getPublicMappedProperties();for(var o=0;o<s.length;o++){var u=s[o];if(u.inverseProperty==e.name&&Container.resolveType(u.dataType)===Container.resolveType(n.LogicalType))r.push(u)}}}else{var i=this._storageModel.getStorageModel(t);if(i){r=[];var s=i.LogicalType.memberDefinitions.getPublicMappedProperties();for(var o=0;o<s.length;o++){var u=s[o];if(u.elementType&&u.inverseProperty==e.name&&Container.resolveType(u.elementType)===n.LogicalType)r.push(u);else if(u.inverseProperty==e.name&&Container.resolveType(u.dataType)===n.LogicalType)r.push(u)}}}if(r){if(r.length>1){if(typeof intellisense!=="undefined"){Guard.raise(new Exception("More than one inverse property refer to this member definition: "+e.name+", type: "+Container.resolveName(n.LogicalType)))}}var a=r.pop();if(a){e.inverseProperty=a.name}}}else{var i=null;if(t===$data.Array||t.isAssignableTo&&t.isAssignableTo($data.EntitySet)){i=this._storageModel.getStorageModel(Container.resolveType(e.elementType))}else{i=this._storageModel.getStorageModel(t)}var f=i.LogicalType.memberDefinitions.getMember(e.inverseProperty);if(f){if(f.inverseProperty){if(f.inverseProperty!=e.name){if(typeof intellisense==="undefined"){Guard.raise(new Exception("Inverse property mismatch"))}}}else{f.inverseProperty=e.name}}}},_buildDbType_generateConvertToFunction:function(e){return function(e){return e}},_buildDbType_modifyInstanceDefinition:function(e,t){return},_buildDbType_modifyClassDefinition:function(e,t){return},_buildDbType_addComplexTypePropertyDefinition:function(e,t,n,r){this._addNavigationPropertyDefinition(e,r,r.name,$data.MemberTypes.complexProperty);var i=this._createComplexElement(t.LogicalType,"",r.name,n,"","");t.ComplexTypes[r.name]=i;t.ComplexTypes.push(i)},_buildDbType_Collection_OneManyDefinition:function(e,t,n,r){var i=Container.resolveType(r.elementType);if(i===undefined||i===null){if(typeof intellisense==="undefined"){Guard.raise(new Exception("Element type definition error","Field definition",r))}}var s=this._storageModel.getStorageModel(i);if(!s){if(typeof intellisense==="undefined"){Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",r))}}this._addNavigationPropertyDefinition(e,r,r.name);var o=r.inverseProperty==="$$unbound"?"$$unbound":"0..1";var u=this._addAssociationElement(t.LogicalType,o,r.name,s.LogicalType,"*",r.inverseProperty);t.Associations[r.name]=u;t.Associations.push(u)},_buildDbType_ElementType_OneManyDefinition:function(e,t,n,r){var i=Container.resolveType(r.dataType);if(i===undefined||i===null){if(typeof intellisense==="undefined"){Guard.raise(new Exception("Element type definition error","Field definition",r))}}var s=this._storageModel.getStorageModel(i);if(!s){if(typeof intellisense==="undefined"){Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",r))}}this._addNavigationPropertyDefinition(e,r,r.name);var o=r.inverseProperty==="$$unbound"?"$$unbound":"*";var u=this._addAssociationElement(t.LogicalType,o,r.name,s.LogicalType,"0..1",r.inverseProperty);t.Associations[r.name]=u;t.Associations.push(u)},_buildDbType_ElementType_OneOneDefinition:function(e,t,n,r){var i=Container.resolveType(r.dataType);if(i===undefined||i===null){if(typeof intellisense==="undefined"){Guard.raise(new Exception("Element type definition error","Field definition",r))}}var s=this._storageModel.getStorageModel(i);if(!s){if(typeof intellisense==="undefined"){Guard.raise(new Exception("No EntitySet definition following element type","Field definition",r))}}var o=s.LogicalType.memberDefinitions.getMember(r.inverseProperty);if(!o.required&&!r.required){if(typeof intellisense==="undefined"){if(typeof intellisense==="undefined"){Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",r))}}}this._addNavigationPropertyDefinition(e,r,r.name);var u=this._addAssociationElement(t.LogicalType,r.required?"0..1":"1",r.name,s.LogicalType,r.required?"1":"0..1",r.inverseProperty);t.Associations[r.name]=u;t.Associations.push(u)},_addNavigationPropertyDefinition:function(e,t,n,r){var i=JSON.parse(JSON.stringify(t));i.dataType=$data.EntitySet;i.notMapped=true;i.kind=r?r:$data.MemberTypes.navProperty;i.association=n;e[t.name]=i},_addAssociationElement:function(e,t,n,r,i,s){return new $data.Association({From:e.name,FromType:e,FromMultiplicity:t,FromPropertyName:n,To:r.name,ToType:r,ToMultiplicity:i,ReferentialConstraint:[],ToPropertyName:s})},_createComplexElement:function(e,t,n,r,i,s){return new $data.ComplexType({From:e.name,FromType:e,FromMultiplicity:t,FromPropertyName:n,To:r.name,ToType:r,ToMultiplicity:i,ReferentialConstraint:[],ToPropertyName:s})},_successInitProvider:function(e,t){if(e instanceof $data.EntityContext&&e._isOK!==undefined){if(!t){e._isOK=true;if(e.onReadyFunction){for(var n=0;n<e.onReadyFunction.length;n++){e.onReadyFunction[n].success(e)}e.onReadyFunction=undefined}}else{e._isOK=t;if(e.onReadyFunction){for(var n=0;n<e.onReadyFunction.length;n++){e.onReadyFunction[n].error(t)}e.onReadyFunction=undefined}}}},onReady:function(e){var t=new $data.PromiseHandler;var n=t.createCallback(e);if(this._isOK===true){n.success(this)}else if(this._isOK!==false){n.error(this._isOK)}else{this.onReadyFunction=this.onReadyFunction||[];this.onReadyFunction.push(n)}return t.getPromise()},ready:{type:$data.Promise},getEntitySetFromElementType:function(elementType){var result=this._entitySetReferences[elementType];if(!result){try{result=this._entitySetReferences[eval(elementType).name]}catch(ex){}}return result},executeQuery:function(e,t,n){var r=new $data.Query(e.expression,e.defaultType,this);r.transaction=n instanceof $data.Transaction?n:undefined;var i=this._isReturnTransaction(n);t=$data.typeSystem.createCallbackSetting(t);var s=this;var o={};o.success=function(e){if($data.QueryCache&&$data.QueryCache.isCacheable(s,e)){$data.QueryCache.addToCache(s,e)}e.buildResultSet(s);if($data.ItemStore&&"QueryResultModifier"in $data.ItemStore)$data.ItemStore.QueryResultModifier.call(s,e);var n;if(e.expression.nodeType===$data.Expressions.ExpressionType.Single||e.expression.nodeType===$data.Expressions.ExpressionType.Find||e.expression.nodeType===$data.Expressions.ExpressionType.Count||e.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete||e.expression.nodeType===$data.Expressions.ExpressionType.Some||e.expression.nodeType===$data.Expressions.ExpressionType.Every){if(e.result.length!==1){t.error(new Exception("result count failed"));return}n=e.result[0]}else if(e.expression.nodeType===$data.Expressions.ExpressionType.First){if(e.result.length===0){t.error(new Exception("result count failed"));return}n=e.result[0]}else{if(typeof e.__count==="number"&&e.result)e.result.totalCount=e.__count;s.storageProvider._buildContinuationFunction(s,e);n=e.result}var r=function(){s._applyTransaction(t,t.success,[n],e.transaction,i)};var o=0;var u=e.getEntitySets();var a=function(){var t=u[o];if(t.afterRead){o++;var i=t.afterRead.call(this,n,u,e);if(typeof i==="function"){i.call(this,o<u.length?a:r,n,u,e)}else{if(o<u.length){a()}else r()}}else r()};if(u.length)a();else r()};o.error=function(){if(i)t.error.apply(this,arguments);else t.error.apply(this,Array.prototype.filter.call(arguments,function(e){return!(e instanceof $data.Transaction)}))};var u=r.getEntitySets();var a=function(){var e=true;var t=false;var n=s;var i=function(t){if(t===false)e=false;if(e){if(r.transaction){if($data.QueryCache&&$data.QueryCache.isInCache(s,r)){$data.QueryCache.executeQuery(s,r,o)}else{n.storageProvider.executeQuery(r,o)}}else{n.beginTransaction(function(e){r.transaction=e;if($data.QueryCache&&$data.QueryCache.isInCache(s,r)){$data.QueryCache.executeQuery(s,r,o)}else{n.storageProvider.executeQuery(r,o)}})}}else{r.rawDataList=[];r.result=[];o.success(r)}};var a=0;var f=function(t){if(t===false)e=false;var n=u[a];if(n.beforeRead){a++;var s=n.beforeRead.call(this,u,r);if(typeof s==="function"){s.call(this,a<u.length&&e?f:i,u,r)}else{if(s===false)e=false;if(a<u.length&&e){f()}else i()}}else i()};if(u.length)f();else i()};if(this.user&&this.checkPermission){this.checkPermission(r.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete?$data.Access.DeleteBatch:$data.Access.Read,this.user,u,{success:a,error:o.error})}else a()},saveChanges:function(e,t){if($data.QueryCache){$data.QueryCache.reset(this)}var n=[];var r=this.stateManager.trackedEntities;var i=new $data.PromiseHandler;var s=i.createCallback(e);var o=i.getPromise();var u=this._isReturnTransaction(t);var a=[];while(r.length>0){var f=[];for(var l=0;l<r.length;l++){var c=r[l];var h=this._storageModel.getStorageModel(c.data.getType());if(c.data.entityState==$data.EntityState.Unchanged){c.skipSave=true;a.push(c.data)}else{if(c.data.entityState==$data.EntityState.Modified){if(c.data.changedProperties){var p=c.data.changedProperties.some(function(e){var t=h.PhysicalType.memberDefinitions.getMember(e.name);if(t.kind==$data.MemberTypes.navProperty){var n=h.Associations[t.association];var r=n.FromMultiplicity+n.ToMultiplicity;return r=="*0..1"||r=="0..11"}return true});if(!p){c.skipSave=true;a.push(c.data)}}}}this.processEntityTypeBeforeEventHandler(a,c);var d=[];var v=h.PhysicalType.memberDefinitions.asArray();for(var m=0;m<v.length;m++){var g=v[m];if(g.kind==$data.MemberTypes.navProperty)d.push(g)}for(var y=0;y<d.length;y++){var b=d[y];var w=h.Associations[b.name];var E=b.name;var S=w.ToPropertyName;var x=[].concat(c.data[E]);for(var T=0;T<x.length;T++){var N=x[T];if(N){var C=N[S];var k=w.FromMultiplicity+w.ToMultiplicity;if(w.FromMultiplicity==="$$unbound"){if(N instanceof $data.Array){c.dependentOn=c.dependentOn||[];for(var L=0;L<N.length;L++){var A=N[L];if(c.dependentOn.indexOf(N)<0&&N.skipSave!==true){c.dependentOn.push(N)}}}else{c.dependentOn=c.dependentOn||[];if(c.dependentOn.indexOf(N)<0&&N.skipSave!==true){c.dependentOn.push(N)}}}else{switch(k){case"*0..1":if(C){if(C instanceof Array){if(C.indexOf(c.data)==-1){C.push(c.data);N.initData[S]=C;N._setPropertyChanged(w.ToType.getMemberDefinition(S))}}else{if(typeof intellisense==="undefined"){Guard.raise("Item must be array or subtype of array")}}}else{N.initData[S]=[c.data];N._setPropertyChanged(w.ToType.getMemberDefinition(S))}break;default:if(C){if(C!==c.data){if(typeof intellisense==="undefined"){Guard.raise("Integrity check error! Item assigned to another entity!")}}}else{N.initData[S]=c.data;N._setPropertyChanged(w.ToType.getMemberDefinition(S))}break}switch(k){case"*0..1":case"0..11":c.dependentOn=c.dependentOn||[];if(c.dependentOn.indexOf(N)<0&&N.skipSave!==true){c.dependentOn.push(N)}break}}if(!N.entityState){if(N.storeToken===this.storeToken){N.entityState=$data.EntityState.Modified}else{N.entityState=$data.EntityState.Added}}if(f.indexOf(N)==-1){f.push(N)}}}}}for(var l=0;l<r.length;l++){var O=r[l];if(O.skipSave!==true){n.push(O)}}r=[];for(var l=0;l<f.length;l++){var M=f[l];if(!a.some(function(e){return e==M})){if(!n.some(function(e){return e.data==M})){r.push({data:M,entitySet:this.getEntitySetFromElementType(M.getType().name)})}}}}for(var y=0;y<n.length;y++){var _=n[y];if(_.dependentOn){var D=[];for(var l=0;l<_.dependentOn.length;l++){if(a.indexOf(_.dependentOn[l])<0){D.push(_.dependentOn[l])}}_.dependentOn=D}}a=null;var P=this;if(n.length==0){this.stateManager.trackedEntities.length=0;P._applyTransaction(s,s.success,[0],t,u);return o}var H=[];for(var l=0;l<n.length;l++){var O=n[l];if(O.data.entityState===$data.EntityState.Added){for(var y=0;y<O.data.getType().memberDefinitions.getPublicMappedProperties().length;y++){var B=O.data.getType().memberDefinitions.getPublicMappedProperties()[y];var j=Container.resolveType(B.type);if(B.required&&!B.computed&&!O.data[B.name]){switch(j){case $data.String:case $data.Number:case $data.Float:case $data.Decimal:case $data.Integer:case $data.Int16:case $data.Int32:case $data.Int64:case $data.Byte:case $data.SByte:case $data.Date:case $data.Boolean:O.data[B.name]=Container.getDefault(B.dataType);break;default:break}}}}if((O.data.entityState===$data.EntityState.Added||O.data.entityState===$data.EntityState.Modified)&&!O.data.isValid()){H.push({item:O.data,errors:O.data.ValidationErrors})}}if(H.length>0){s.error(H);return o}var F=$data.Access.None;var I={};var q=[];for(var l=0;l<n.length;l++){var R=n[l];var U=R.entitySet.elementType.name;if(q.indexOf(R.entitySet)<0)q.push(R.entitySet);var z=this._entitySetReferences[U];if(z.beforeCreate||z.beforeUpdate||z.beforeDelete||this.user&&this.checkPermission){if(!I[U])I[U]={};switch(R.data.entityState){case $data.EntityState.Added:F|=$data.Access.Create;if(z.beforeCreate){if(!I[U].createAll)I[U].createAll=[];I[U].createAll.push(R)}break;case $data.EntityState.Modified:F|=$data.Access.Update;if(z.beforeUpdate){if(!I[U].modifyAll)I[U].modifyAll=[];I[U].modifyAll.push(R)}break;case $data.EntityState.Deleted:F|=$data.Access.Delete;if(z.beforeDelete){if(!I[U].deleteAll)I[U].deleteAll=[];I[U].deleteAll.push(R)}break}}}var W=function(e){if(e===false){X="async";n.length=0}if(n.length){var r={success:function(e){P._postProcessSavedItems(s,n,e,u)},error:function(){if(u)s.error.apply(this,arguments);else s.error.apply(this,Array.prototype.filter.call(arguments,function(e){return!(e instanceof $data.Transaction)}))}};if(t instanceof $data.Transaction){P.storageProvider.saveChanges(r,n,t)}else{P.beginTransaction(true,function(e){P.storageProvider.saveChanges(r,n,e)})}}else if(X){s.error(new Exception("Cancelled event in "+X,"CancelEvent"))}else{P._applyTransaction(s,s.success,[0],t,u)}};var X;var V=Object.getOwnPropertyNames(I);var l=0;var $=["beforeUpdate","beforeDelete","beforeCreate"];var J={beforeCreate:"createAll",beforeDelete:"deleteAll",beforeUpdate:"modifyAll"};var K=function(e){if(e===false){X="async";n.length=0;W(e);return}var t=P._entitySetReferences[V[l]];var r=$.pop();var i=I[V[l]];var s=i[J[r]];if(s){var o=[];for(var u=0;u<s.length;u++){o.push(s[u].data)}if(!$.length){$=["beforeUpdate","beforeDelete","beforeCreate"];l++}var a=t[r].call(P,o);if(typeof a==="function"){a.call(P,l<V.length&&!X?K:W,o)}else if(a===false){X=t.name+"."+r;for(var f=0;f<s.length;f++){var c=s[f];var h=n.indexOf(c);n.splice(h,1)}W()}else{if(l<V.length&&!X)K();else W()}}else{if(!$.length){$=["beforeUpdate","beforeDelete","beforeCreate"];l++}if(l<V.length&&!X)K();else W()}};if(this.user&&this.checkPermission){this.checkPermission(F,this.user,q,{success:function(){if(l<V.length)K();else W()},error:s.error})}else{if(l<V.length)K();else W()}return o},processEntityTypeBeforeEventHandler:function(e,t){if(!t.skipSave){var n=t.data;var r=n.getType();var i=n.entityState;switch(true){case i===$data.EntityState.Added&&r.onbeforeCreate instanceof $data.Event:if(r.onbeforeCreate.fireCancelAble(n)===false){t.skipSave=true;e.push(n)}break;case i===$data.EntityState.Modified&&r.onbeforeUpdate instanceof $data.Event:if(r.onbeforeUpdate.fireCancelAble(n)===false){t.skipSave=true;e.push(n)}break;case i===$data.EntityState.Deleted&&r.onbeforeDelete instanceof $data.Event:if(r.onbeforeDelete.fireCancelAble(n)===false){t.skipSave=true;e.push(n)}break;default:break}}},processEntityTypeAfterEventHandler:function(e){var t=e.data;var n=t.getType();var r=t.entityState;switch(true){case r===$data.EntityState.Added&&n.onafterCreate instanceof $data.Event:n.onafterCreate.fire(t);break;case r===$data.EntityState.Modified&&n.onafterUpdate instanceof $data.Event:n.onafterUpdate.fire(t);break;case r===$data.EntityState.Deleted&&n.onafterDelete instanceof $data.Event:n.onafterDelete.fire(t);break;default:break}},bulkInsert:function(e,t,n,r){var i=new $data.PromiseHandler;r=i.createCallback(r);if(typeof e==="string"){var s;for(var o in this._entitySetReferences){var u=this._entitySetReferences[o];if(u.tableName===e){s=u;break}}if(!s)s=this[e];e=s}if(e){this.storageProvider.bulkInsert(e,t,n,r)}else{r.error(new Exception("EntitySet not found"))}return i.getPromise()},prepareRequest:function(){},_postProcessSavedItems:function(e,t,n,r){if(this.ChangeCollector&&this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase)this.ChangeCollector.processChangedData(t);var i={};var s=this;for(var o=0;o<t.length;o++){var u=t[o];if(!u.data.storeToken)u.data.storeToken=s.storeToken;this.processEntityTypeAfterEventHandler(u);var a=u.data.entityState;u.data.entityState=$data.EntityState.Unchanged;u.data.changedProperties=[];u.physicalData=undefined;var f=u.entitySet.elementType.name;var l=s._entitySetReferences[f];var c=undefined;switch(a){case $data.EntityState.Added:c="added";break;case $data.EntityState.Deleted:c="deleted";break;case $data.EntityState.Modified:c="updated";break}if(c){this.raiseEvent(c,u)}if(l.afterCreate||l.afterUpdate||l.afterDelete){if(!i[f])i[f]={};switch(a){case $data.EntityState.Added:if(l.afterCreate){if(!i[f].createAll)i[f].createAll=[];i[f].createAll.push(u)}break;case $data.EntityState.Modified:if(l.afterUpdate){if(!i[f].modifyAll)i[f].modifyAll=[];i[f].modifyAll.push(u)}break;case $data.EntityState.Deleted:if(l.afterDelete){if(!i[f].deleteAll)i[f].deleteAll=[];i[f].deleteAll.push(u)}break}}}var h=Object.getOwnPropertyNames(i);var o=0;var s=this;var p=["afterUpdate","afterDelete","afterCreate"];var d={afterCreate:"createAll",afterDelete:"deleteAll",afterUpdate:"modifyAll"};var v=function(){if(!s.trackChanges){s.stateManager.reset()}s._applyTransaction(e,e.success,[t.length],n,r)};var m=function(){var e=s._entitySetReferences[h[o]];var t=p.pop();var n=i[h[o]];var r=n[d[t]];if(r){var u=[];for(var a=0;a<r.length;a++){u.push(r[a].data)}if(!p.length){p=["afterUpdate","afterDelete","afterCreate"];o++}var f=e[t].call(s,u);if(typeof f==="function"){f.call(s,o<h.length?m:v,u)}else{if(o<h.length)m();else v()}}else{if(!p.length){p=["afterUpdate","afterDelete","afterCreate"];o++}if(o<h.length)m();else v()}};if(o<h.length)m();else v()},forEachEntitySet:function(e,t){for(var n in this._entitySetReferences){var r=this._entitySetReferences[n];e.call(t,r)}},loadItemProperty:function(e,t,n,r){Guard.requireType("entity",e,$data.Entity);var i=typeof t==="string"?e.getType().memberDefinitions.getMember(t):t;var s=this._isReturnTransaction(r);if(e[i.name]!=undefined){var o=new $data.PromiseHandler;callBack=o.createCallback(n);this._applyTransaction(n,n.success,[e[i.name]],r,s);return o.getPromise()}var u=true;var a=this._storageModel.getStorageModel(e.getType().fullName);var f=Container.resolveType(i.dataType);if(f===$data.Array||f.isAssignableTo&&f.isAssignableTo($data.EntitySet)){f=Container.resolveType(i.elementType);u=false}else{var l;for(var c=0;c<a.Associations.length;c++){var h=a.Associations[c];if(h.FromPropertyName==i.name){l=h;break}}if(l&&l.FromMultiplicity==="0..1"&&l.ToMultiplicity==="1")u=false}var p=a.LogicalType.memberDefinitions.getKeyProperties();if(u===true){var d="function (e) { return";var v={};for(var m=0;m<p.length;m++){var g=p[m];if(m>0)d+=" &&";d+=" e."+g.name+" == this.key"+m;v["key"+m]=e[g.name]}d+="; }";var y=this.getEntitySetFromElementType(e.getType());return y.map("function (e) { return e."+i.name+" }").single(d,v,n,r)}else{var d="function (e) { return";var v={};for(var m=0;m<p.length;m++){var g=p[m];if(m>0)d+=" &&";d+=" e."+i.inverseProperty+"."+g.name+" == this.key"+m;v["key"+m]=e[g.name]}d+="; }";var y=this.getEntitySetFromElementType(f);return y.filter(d,v).toArray(n,r)}},getTraceString:function(e){var t=new $data.Query(e.expression,e.defaultType,this);return this.storageProvider.getTraceString(t)},log:function(e){},resolveBinaryOperator:function(e,t,n){return this.storageProvider.resolveBinaryOperator(e,t,n)},resolveUnaryOperator:function(e,t,n){return this.storageProvider.resolveUnaryOperator(e,t,n)},resolveFieldOperation:function(e,t,n){return this.storageProvider.resolveFieldOperation(e,t,n)},resolveSetOperations:function(e,t,n){return this.storageProvider.resolveSetOperations(e,t,n)},resolveTypeOperations:function(e,t,n){return this.storageProvider.resolveTypeOperations(e,t,n)},resolveContextOperations:function(e,t,n){return this.storageProvider.resolveContextOperations(e,t,n)},_generateServiceOperationQueryable:function(e,t,n,r){if(typeof console!=="undefined"&&console.log)console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext");var i=[];for(var s=0;s<r.length;s++){var o={};o[r[s]]=Container.resolveType(Container.getTypeName(n[s]));i.push(o)}var u=$data.EntityContext.generateServiceOperation({serviceName:e,returnType:$data.Queryable,elementType:this[t].elementType,params:i});return u.apply(this,n)},attach:function(e,t){if(e instanceof $data.EntityWrapper){e=e.getEntity()}var n=this.getEntitySetFromElementType(e.getType());return n.attach(e,t)},attachOrGet:function(e){if(e instanceof $data.EntityWrapper){e=e.getEntity()}var t=this.getEntitySetFromElementType(e.getType());return t.attachOrGet(e)},addMany:function(e){var t=this;e.forEach(function(e){t.add(e)});return e},add:function(e){if(e instanceof $data.EntityWrapper){e=e.getEntity()}var t=this.getEntitySetFromElementType(e.getType());return t.add(e)},remove:function(e){if(e instanceof $data.EntityWrapper){e=e.getEntity()}var t=this.getEntitySetFromElementType(e.getType());return t.remove(e)},storeToken:{type:Object},getFieldUrl:function(e,t,n){try{var r=typeof n==="string"?this[n]:n;var i=typeof t==="string"?t:t.name;if(e instanceof $data.Entity){r=this.getEntitySetFromElementType(e.getType())}else if(!Object.isNullOrUndefined(e)&&e.constructor!==$data.Object){var s=r.elementType.memberDefinitions.getKeyProperties()[0];var o={};o[s.name]=e;e=o}if(!(e instanceof $data.Entity)){e=new r.elementType(e)}return this.storageProvider.getFieldUrl(e,i,r)}catch(u){}return"#"}},{inheritedTypeProcessor:function(e){if(e.resolveForwardDeclarations){e.resolveForwardDeclarations()}},generateServiceOperation:function(e){var t;if(e.serviceMethod){var n=e.returnType?Container.resolveType(e.returnType):{};if(n.isAssignableTo&&n.isAssignableTo($data.Queryable)){t=e.serviceMethod}else{t=function(){var t=arguments[arguments.length-1];var n=new $data.PromiseHandler;var r;var i=arguments;if(typeof t==="function"){r=n.createCallback(t);arguments[arguments.length-1]=r}else{r=n.createCallback();arguments.push(r)}try{var s=e.serviceMethod.apply(this,arguments);if(s!==undefined)r.success(s)}catch(o){r.error(o)}return n.getPromise()}}}else{t=function(){var t=this;var n;if(this instanceof $data.Entity){if(!e.method){e.method="POST"}if(this.context){t=this.context}else{Guard.raise("entity not attached into context");return}n={data:this,entitySet:t.getEntitySetFromElementType(this.getType())}}var r=e.elementType?t.getEntitySetFromElementType(Container.resolveType(e.elementType)):null;var i=null;if(e.params){i=[];for(var s=0;s<e.params.length;s++){for(var o in e.params[s]){i.push(Container.createConstantExpression(arguments[s],Container.resolveType(e.params[s][o]),o))}}}var u=Container.createEntityContextExpression(t);var a=(n?n.data:t).getType().getMemberDefinition(e.serviceName);var f=Container.createServiceOperationExpression(u,Container.createMemberInfoExpression(a),i,e,n);var l=arguments[arguments.length-1];if(typeof l!=="function"){l=undefined}if(r){var c=Container.createQueryable(r,f);if(l){f.isTerminated=true;return c._runQuery(l)}return c}else{var h=e.returnType?Container.resolveType(e.returnType):null;var c=Container.createQueryable(t,f);c.defaultType=h||$data.Object;if(h===$data.Queryable){c.defaultType=Container.resolveType(e.elementType);if(l){f.isTerminated=true;return c._runQuery(l)}return c}f.isTerminated=true;return c._runQuery(l)}}}var r=[];if(e.params){for(var i=0;i<e.params.length;i++){var s=e.params[i];for(var o in s){r.push({name:o,type:s[o]})}}}$data.typeSystem.extend(t,e,{params:r});return t},_convertLogicalTypeNameToPhysical:function(e){return e+"_$db$"},_storageModelCache:{get:function(){if(!this.__storageModelCache)this.__storageModelCache={};return this.__storageModelCache},set:function(){}}});$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=false},executeQuery:function(e,t){},getTraceString:function(e){}},null);$data.Class.define("$data.ModelBinder",null,null,{constructor:function(e){this.context=e;this.providerName=null;if(this.context.storageProvider&&typeof this.context.storageProvider.getType==="function"){this.references=!(this.context.storageProvider.providerConfiguration.modelBinderOptimization||false);for(var t in $data.RegisteredStorageProviders){if($data.RegisteredStorageProviders[t]===this.context.storageProvider.getType()){this.providerName=t}}}},_deepExtend:function(e,t){if(e===null||e===undefined){return t}for(var n in t){if(e.hasOwnProperty(n)){if(typeof t[n]==="object"){if(Array.isArray(t[n])){for(var r=0;r<t[n].length;r++){if(e[n].indexOf(t[n][r])<0){e[n].push(t[n][r])}}}else this._deepExtend(e[n],t[n])}}else{e[n]=t[n]}}return this._finalize(e)},_finalize:function(e){if(e instanceof $data.Entity){e.changedProperties=undefined;e.storeToken=this.context.storeToken}return e},_buildSelector:function(e,t){if(e.$selector){if(!Array.isArray(e.$selector)){e.$selector=[e.$selector]}for(var n=0;n<e.$selector.length;n++){var r=e.$selector[n].replace("json:","");t.src+="if(";var i=r.split(".");for(var s=0;s<i.length;s++){t.src+="di."+i.slice(0,s+1).join(".")+(s<i.length-1?" && ":" !== undefined && typeof di."+r+' === "object"')}t.src+="){di = di."+r+";}"+(n<e.$selector.length-1?"else ":"else { return undefined; }")}t.src+="if (di === null){";if(t.iter)t.src+=t.iter+" = null;";t.src+="return null;";t.src+="}"}},_buildKey:function(e,t,n,r,i){if(n){var t=Container.resolveType(t);var s=Container.getIndex(t);t=t.fullName||t.name;r.src+="var "+e+"Fn = function(di){";if(!Array.isArray(n)||n.length==1){if(typeof n!=="string")n=n[0];r.src+="if (typeof di."+n+' === "undefined") return undefined;';r.src+="if (di."+n+" === null) return null;";r.src+='var key = ("'+t+"_"+s+"_"+n+'#" + di.'+n+");"}else{r.src+='var key = "";';for(var o=0;o<n.length;o++){var u=typeof n[o]!=="object"?n[o]:n[o].$source;r.src+="if (typeof di."+u+' === "undefined") return undefined;';r.src+="if (di."+u+" === null) return null;";r.src+='key += ("'+t+"_"+s+"_"+u+'#" + di.'+u+");"}}r.src+="return key;};"}r.src+="var "+e+" = "+(n?e+"Fn("+(i||"di")+")":"undefined")+";"},build:function(e,t){if(e.$selector){if(!Array.isArray(e.$selector))e.$selector=[e.$selector];for(var n=0;n<e.$selector.length;n++){e.$selector[n]=e.$selector[n].replace("json:","")}}if(e.$value){if(typeof e.$value==="function"){t.src+="var di = di || data;";t.src+="var fn = function(){ return meta"+(t.meta.length?"."+t.meta.join("."):"")+".$value.call(self, meta"+(t.meta.length?"."+t.meta.join("."):"")+", di); };";if(e.$type){var r=Container.resolveName(Container.resolveType(e.$type));var i=Container.getIndex(Container.resolveType(e.$type));var s=this.context.storageProvider.fieldConverter.fromDb[r];if(s){t.item='self.context.storageProvider.fieldConverter.fromDb["'+r+'"](fn())'}else{t.item="new (Container.resolveByIndex("+i+"))(fn())"}}else t.item="fn()"}else if(e.$type){var r=Container.resolveName(Container.resolveType(e.$type));var i=Container.getIndex(Container.resolveType(e.$type));var s=this.context.storageProvider.fieldConverter.fromDb[r];if(s){t.item='self.context.storageProvider.fieldConverter.fromDb["'+r+'"]('+e.$value+")"}else{t.item="new (Container.resolveByIndex("+i+"))("+e.$value+")"}}else t.item=e.$value}else if(e.$source){var r=Container.resolveName(Container.resolveType(e.$type));var i=Container.getIndex(Container.resolveType(e.$type));var s=this.context.storageProvider.fieldConverter.fromDb[r];var o="_"+r.replace(/\./gi,"_")+"_";if(!t.forEach)t.src+="var di = data;";t.item=o;this._buildSelector(e,t);if(s){t.src+="var "+o+' = self.context.storageProvider.fieldConverter.fromDb["'+r+'"](di.'+e.$source+");"}else{t.src+="var "+o+" = new (Container.resolveByIndex("+i+"))(di."+e.$source+");"}}else if(e.$item){t.meta.push("$item");var u=t.item&&t.current?t.item+"."+t.current:t.item?t.item:"result";t.iter=u;if(u.indexOf(".")<0)t.src+="var "+u+";";t.src+="var fn = function(di){";if(e.$selector){t.src+='if (typeof di !== "undefined" && !(Array.isArray(di))){';this._buildSelector(e,t);t.src+="}"}if(this.references&&e.$keys)this._buildKey("forKey",e.$type,e.$keys,t);t.src+=u+" = typeof "+u+' == "undefined" ? [] : '+u+";";if(this.references&&e.$item.$keys){var a="keycache_"+u.replace(/\./gi,"_");t.src+="var "+a+";";t.src+="var kci = keycacheIter.indexOf("+u+");";t.src+="if (kci < 0){";t.src+=a+" = [];";t.src+="keycache.push("+a+");";t.src+="keycacheIter.push("+u+");";t.src+="}else{";t.src+=a+" = keycache[kci];";t.src+="}"}t.iter=undefined;t.forEach=true;var f="itemForKey_"+u.replace(/\./gi,"_");t.src+="var forEachFn = function(di, i){";t.src+="var diBackup = di;";if(this.providerName=="sqLite"&&this.references&&e.$item.$keys)this._buildKey(f,e.$type,e.$item.$keys,t);var o=t.item||"iter";t.item=o;if(!e.$item.$source){this._buildSelector(e.$item,t)}this.build(e.$item,t);if(this.references&&e.$keys){t.src+="if (forKey){";t.src+="if (cache[forKey]){";t.src+=u+" = cache[forKey];";t.src+="if ("+u+".indexOf("+(t.item||o)+") < 0){";t.src+=u+".push("+(t.item||o)+");";t.src+="}}else{";t.src+="cache[forKey] = "+u+";";t.src+=u+".push("+(t.item||o)+");";t.src+="}}else{";if(this.references&&e.$item.$keys)this._buildKey("cacheKey",e.$type,e.$item.$keys,t,"diBackup");t.src+='if (typeof cacheKey != "undefined" && cacheKey !== null){';t.src+="if (keycache_"+u.replace(/\./gi,"_")+" && cacheKey){";t.src+="if (keycache_"+u.replace(/\./gi,"_")+".indexOf(cacheKey) < 0){";t.src+=u+".push("+(t.item||o)+");";t.src+="keycache_"+u.replace(/\./gi,"_")+".push(cacheKey);";t.src+="}";t.src+="}else{";t.src+=u+".push("+(t.item||o)+");";t.src+="}";t.src+="}";t.src+="}"}else{if(this.references&&e.$item.$keys){t.src+="if (typeof "+f+' !== "undefined" && '+f+" !== null){";t.src+="if (typeof keycache_"+u.replace(/\./gi,"_")+' !== "undefined" && '+f+"){";t.src+="if (keycache_"+u.replace(/\./gi,"_")+".indexOf("+f+") < 0){";t.src+=u+".push("+(t.item||o)+");";t.src+="keycache_"+u.replace(/\./gi,"_")+".push("+f+");";t.src+="}}else{";t.src+=u+".push("+(t.item||o)+");";t.src+="}}else{";t.src+=u+".push("+(t.item||o)+");";t.src+="}"}else{t.src+=u+".push("+(t.item||o)+");"}}t.src+="};";t.src+="if (Array.isArray(di)) di.forEach(forEachFn);";t.src+="else forEachFn(di, 0);";t.forEach=false;t.item=null;t.src+='};fn(typeof di === "undefined" ? data : di);';t.meta.pop()}else if(e.$type){if(!t.forEach){t.src+='if (typeof di === "undefined"){';t.src+="var di = data;";this._buildSelector(e,t);t.src+="}"}var l=Container.resolveType(e.$type);var r=Container.resolveName(l);var i=Container.getIndex(l);var c=l.isAssignableTo&&l.isAssignableTo($data.Entity);var o="_"+r.replace(/\./gi,"_")+"_";if(t.item==o)o+="new_";t.item=o;var h=false;if(!e.$source&&!e.$value&&l!==$data.Array&&l!==$data.Object&&!l.isAssignableTo)h=true;if(l===$data.Object||l===$data.Array){var p=Object.keys(e);if(p.length==1||p.length==2&&e.$selector)h=true}if(h){var s=this.context.storageProvider.fieldConverter.fromDb[r];if(s){t.src+="var "+o+' = di != undefined ? self.context.storageProvider.fieldConverter.fromDb["'+r+'"](di) : di;'}else{t.src+="var "+o+" = di;"}}else{if(this.references&&e.$keys){this._buildKey("itemKey",e.$type,e.$keys,t);t.src+="if (itemKey === null) return null;";t.src+="var "+o+";";t.src+="if (itemKey && cache[itemKey]){";t.src+=o+" = cache[itemKey];";t.src+="}else{";if(c){t.src+=o+" = new (Container.resolveByIndex("+i+"))(undefined, { setDefaultValues: false });"}else{t.src+=o+" = new (Container.resolveByIndex("+i+"))();"}t.src+="if (itemKey){";t.src+="cache[itemKey] = "+o+";";t.src+="}";t.src+="}"}else{if(c){t.src+="var "+o+" = new (Container.resolveByIndex("+i+"))(undefined, { setDefaultValues: false });"}else{t.src+="var "+o+" = new (Container.resolveByIndex("+i+"))();"}}}for(var n in e){if(n.indexOf("$")<0){t.current=n;if(!e[n].$item){if(e[n].$value){t.meta.push(n);var o=t.item;this.build(e[n],t);t.src+=o+"."+n+" = "+t.item+";";t.item=o;t.meta.pop()}else if(e[n].$source){t.src+="var fn = function(di){";this._buildSelector(e[n],t);if(e[n].$type){var r=Container.resolveName(Container.resolveType(e[n].$type));var i=Container.getIndex(Container.resolveType(e[n].$type));var s=this.context.storageProvider.fieldConverter.fromDb[r];if(s){t.src+='return self.context.storageProvider.fieldConverter.fromDb["'+r+'"](di.'+e[n].$source+");"}else{t.src+="return new (Container.resolveByIndex("+i+"))(di."+e[n].$source+");"}}else{t.src+=o+"."+n+" = di."+e[n].$source+";"}t.src+="};";if(e[n].$type)t.src+=o+"."+n+" = fn(di);";else t.src+="fn(di);"}else if(e[n].$type){t.meta.push(n);t.src+="var fn = function(di){";this._buildSelector(e[n],t);this.build(e[n],t);t.src+="return "+t.item+";};";if(e[n].$type===$data.Object)t.src+=o+"."+n+" = self._deepExtend("+o+"."+n+", fn(di));";else t.src+=o+"."+n+" = fn(di);";t.item=o;t.meta.pop()}else if(e.$type){var d=Container.resolveType(e.$type).memberDefinitions.getMember(n);var r=Container.resolveName(d.type);var v=Container.resolveType(e.$type);var m=Container.getIndex(e.$type);var s=this.context.storageProvider.fieldConverter.fromDb[r];if(this.providerName&&d&&d.converter&&d.converter[this.providerName]&&typeof d.converter[this.providerName].fromDb=="function"){t.src+=o+"."+n+' = Container.resolveByIndex("'+m+'").memberDefinitions.getMember("'+n+'").converter.'+this.providerName+".fromDb(di."+e[n]+', Container.resolveByIndex("'+m+'").memberDefinitions.getMember("'+n+'"), self.context, Container.resolveByIndex("'+m+'"));'}else if(s){t.src+=o+"."+n+' = self.context.storageProvider.fieldConverter.fromDb["'+r+'"](di.'+e[n]+");"}else{var i=Container.getIndex(Container.resolveType(r.memberDefinitions.getMember(n).type));t.src+=o+"."+n+" = new (Container.resolveByIndex("+i+"))(di."+e[n]+");"}}}else{t.meta.push(n);this.build(e[n],t);t.item=o;t.meta.pop()}}}t.src+=o+" = self._finalize("+o+");"}},call:function(e,t){if(!Object.getOwnPropertyNames(t).length){return e}var n={src:"",meta:[]};n.src+="var self = this;";n.src+="var result;";n.src+="var cache = {};";n.src+="var keycache = [];";n.src+="var keycacheIter = [];";this.build(t,n);if(n.item)n.src+='if (typeof result === "undefined") result = '+n.item+";";n.src+="return result;";var r=(new Function("meta","data",n.src)).bind(this);var i=r(t,e);return i}});$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this._binderConfig={};this.modelBinderConfig=this._binderConfig;this._binderConfigPropertyStack=[]},selectTextPart:function(e){if(!this._fragments[e]){this._fragments[e]={text:"",params:[]}}this.selectedFragment=this._fragments[e]},getTextPart:function(e){return this._fragments[e]},addText:function(e){this.selectedFragment.text+=e},addParameter:function(e){this.selectedFragment.params.push(e)},selectModelBinderProperty:function(e){this._binderConfigPropertyStack.push(this.modelBinderConfig);if(!(e in this.modelBinderConfig)){this.modelBinderConfig[e]={}}this.modelBinderConfig=this.modelBinderConfig[e]},popModelBinderProperty:function(){if(this._binderConfigPropertyStack.length===0){this.modelBinderConfig=this._binderConfig()}else{this.modelBinderConfig=this._binderConfigPropertyStack.pop()}},resetModelBinderProperty:function(e){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig},addKeyField:function(e){if(!this.modelBinderConfig["$keys"]){this.modelBinderConfig["$keys"]=new Array}this.modelBinderConfig["$keys"].push(e)}});$C("$data.Query",null,null,{constructor:function(e,t,n){this.expression=e;this.context=n;this.expressions=e;this.defaultType=t;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=n},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(e){var t=new $data.ModelBinder(this.context);this.result=t.call(this.rawDataList,this.modelBinderConfig);return},getEntitySets:function(){var e=[];var t=this.context;var n=function(r){if(r instanceof $data.Expressions.EntitySetExpression){if(e.indexOf(t._entitySetReferences[r.elementType.name])<0)e.push(t._entitySetReferences[r.elementType.name])}if(r.source)n(r.source)};n(this.expression);return e}},null);$data.Class.define("$data.Queryable",null,null,{constructor:function(e,t){var n=e instanceof $data.EntityContext?e:e.entityContext;this.defaultType=e instanceof $data.EntityContext?null:e.defaultType;this.entityContext=n;this.expression=t},filter:function(e,t){if(arguments.length===3){e="it."+arguments[0]+(arguments[1][0]==="."?arguments[1]+"(param)":" "+arguments[1]+" param");t={param:arguments[2]}}this._checkOperation("filter");var n=Container.createCodeExpression(e,t);var r=this.expression;if(this.expression instanceof $data.Expressions.FilterExpression){r=this.expression.source;var i=this.entityContext.storageProvider.resolveBinaryOperator("and");n=Container.createSimpleBinaryExpression(this.expression.selector,n,"and","filter","boolean",i)}var s=Container.createFilterExpression(r,n);var o=Container.createQueryable(this,s);return o},where:function(e,t){return this.filter(e,t)},map:function(e,t,n){this._checkOperation("map");var r=Container.createCodeExpression(e,t);var i=Container.createProjectionExpression(this.expression,r);if(n==="default")i.projectionAs=this.defaultType;else if(n)i.projectionAs=Container.resolveType(n);else i.projectionAs=$data.Object;var s=Container.createQueryable(this,i);return s},select:function(e,t,n){return this.map(e,t,n)},length:function(e,t){this._checkOperation("length");var n=new $data.PromiseHandler;var r=n.createCallback(e);var i=Container.createCountExpression(this.expression);var s=Container.createQueryExpressionCreator(this.entityContext);try{var o=s.Visit(i);this.entityContext.log({event:"EntityExpression",data:o});this.entityContext.executeQuery(Container.createQueryable(this,o),r,t)}catch(u){r.error(u)}return n.getPromise()},count:function(e,t){return this.length(e,t)},forEach:function(e,t){function r(t){t.forEach(e)}this._checkOperation("forEach");var n=new $data.PromiseHandler;var i=n.createCallback(r);var s=Container.createForEachExpression(this.expression);var o=Container.createQueryExpressionCreator(this.entityContext);try{var u=o.Visit(s);this.entityContext.log({event:"EntityExpression",data:u});this.entityContext.executeQuery(Container.createQueryable(this,u),i,t)}catch(a){i.error(a)}return n.getPromise()},toArray:function(e,t){if(e instanceof $data.Array){return this.toArray(function(t){e.length=0;t.forEach(function(t,n){e.push(t)})})}this._checkOperation("toArray");var n=new $data.PromiseHandler;var r=n.createCallback(e);var i=Container.createToArrayExpression(this.expression);var s=Container.createQueryExpressionCreator(this.entityContext);try{var o=s.Visit(i);this.entityContext.log({event:"EntityExpression",data:o});this.entityContext.executeQuery(Container.createQueryable(this,o),r,t)}catch(u){r.error(u)}return n.getPromise()},single:function(e,t,n,r){this._checkOperation("single");var i=this;if(e){i=this.filter(e,t)}i=i.take(2);var s=new $data.PromiseHandler;var o=s.createCallback(n);var u=Container.createSingleExpression(i.expression);var a=Container.createQueryExpressionCreator(i.entityContext);try{var f=a.Visit(u);this.entityContext.log({event:"EntityExpression",data:f});i.entityContext.executeQuery(Container.createQueryable(i,f),o,r)}catch(l){o.error(l)}return s.getPromise()},some:function(e,t,n,r){this._checkOperation("some");var i=this;if(e){i=this.filter(e,t)}i=i.take(1);var s=new $data.PromiseHandler;var o=s.createCallback(n);var u=Container.createSomeExpression(i.expression);var a=Container.createQueryExpressionCreator(i.entityContext);try{var f=a.Visit(u);this.entityContext.log({event:"EntityExpression",data:f});i.entityContext.executeQuery(Container.createQueryable(i,f),o,r)}catch(l){o.error(l)}return s.getPromise()},every:function(e,t,n,r){this._checkOperation("every");var i=this;if(e){i=this.filter(e,t)}i=i.take(1);var s=new $data.PromiseHandler;var o=s.createCallback(n);var u=Container.createEveryExpression(i.expression);var a=Container.createQueryExpressionCreator(i.entityContext);try{var f=a.Visit(u);this.entityContext.log({event:"EntityExpression",data:f});i.entityContext.executeQuery(Container.createQueryable(i,f),o,r)}catch(l){o.error(l)}return s.getPromise()},take:function(e){this._checkOperation("take");var t=Container.createConstantExpression(e,"number");var n=Container.createPagingExpression(this.expression,t,$data.Expressions.ExpressionType.Take);return Container.createQueryable(this,n)},skip:function(e){this._checkOperation("skip");var t=Container.createConstantExpression(e,"number");var n=Container.createPagingExpression(this.expression,t,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,n)},order:function(e){if(e===""||e===undefined||e===null){return this}if(e[0]==="-"){var t="it."+e.replace("-","");return this.orderByDescending(t)}else{return this.orderBy("it."+e)}},orderBy:function(e,t){this._checkOperation("orderBy");var n=Container.createCodeExpression(e,t);var r=Container.createOrderExpression(this.expression,n,$data.Expressions.ExpressionType.OrderBy);var i=Container.createQueryable(this,r);return i},orderByDescending:function(e,t){this._checkOperation("orderByDescending");var n=Container.createCodeExpression(e,t);var r=Container.createOrderExpression(this.expression,n,$data.Expressions.ExpressionType.OrderByDescending);var i=Container.createQueryable(this,r);return i},first:function(e,t,n,r){this._checkOperation("first");var i=this;if(e){i=this.filter(e,t)}i=i.take(1);var s=new $data.PromiseHandler;var o=s.createCallback(n);var u=Container.createFirstExpression(i.expression);var a=Container.createQueryExpressionCreator(i.entityContext);try{var f=a.Visit(u);i.entityContext.log({event:"EntityExpression",data:f});i.entityContext.executeQuery(Container.createQueryable(i,f),o,r)}catch(l){o.error(l)}return s.getPromise()},find:function(e,t,n){var r=new $data.PromiseHandler;var i=r.createCallback(t);var s=this.defaultType.memberDefinitions.getKeyProperties();try{if(s.length===1&&typeof e!=="object"){var o={};o[s[0].name]=e;e=o}if(typeof e!=="object"){throw new Exception("Key parameter is invalid")}else{var u=[];for(var a=0;a<s.length;a++){var f=s[a];if(!(f.name in e)){throw new Exception("Key value missing")}u.push(Container.createConstantExpression(e[f.name],f.type,f.name))}var l=this.entityContext.storageProvider.supportedSetOperations["find"];if(l){var c=Container.createFindExpression(this.expression,u);var h=Container.createQueryExpressionCreator(this.entityContext);try{var p=h.Visit(c);this.entityContext.log({event:"EntityExpression",data:p});this.entityContext.executeQuery(Container.createQueryable(this,p),i,n)}catch(d){i.error(d)}}else{var v="";var m={};for(var a=0;a<u.length;a++){var g=u[a];m[g.name]=g.value;if(a>0)v+=" && ";v+="it."+g.name+" == this."+g.name}this.single(v,m,i,n)}}}catch(d){i.error(d)}return r.getPromise()},include:function(e){this._checkOperation("include");var t=Container.createConstantExpression(e,"string");var n=Container.createIncludeExpression(this.expression,t);return Container.createQueryable(this,n)},withInlineCount:function(e){this._checkOperation("withInlineCount");var t=Container.createConstantExpression(e||"allpages","string");var n=Container.createInlineCountExpression(this.expression,t);return Container.createQueryable(this,n)},removeAll:function(e,t){this._checkOperation("batchDelete");var n=new $data.PromiseHandler;var r=n.createCallback(e);var i=Container.createBatchDeleteExpression(this.expression);var s=Container.createQueryExpressionCreator(this.entityContext);try{var o=s.Visit(i);this.entityContext.log({event:"EntityExpression",data:o});this.entityContext.executeQuery(Container.createQueryable(this,o),r,t)}catch(u){r.error(u)}return n.getPromise()},_runQuery:function(e,t){var n=new $data.PromiseHandler;var r=n.createCallback(e);var i=Container.createQueryExpressionCreator(this.entityContext);try{var s=i.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:s});this.entityContext.executeQuery(Container.createQueryable(this,s),r,t)}catch(o){r.error(o)}return n.getPromise()},toTraceString:function(e){var t=this.expression;if(e){t=Container["create"+e+"Expression"](t)}else{t=Container.createToArrayExpression(t)}var n=Container.createQueryExpressionCreator(this.entityContext);t=n.Visit(t);var r=Container.createQueryable(this,t);return r.entityContext.getTraceString(r)},_checkOperation:function(e){var t=this.entityContext.resolveSetOperations(e);if(t.invokable!=undefined&&!t.invokable)Guard.raise(new Exception("Operation '"+e+"' is not invokable with the provider"))},defaultType:{}},null);$data.EntitySchemaConfig=function(){this.Name=""};$data.entitySetState={created:0,defined:1,active:2};$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(e,t,n,r,i){this.createNew=this[e.name]=this.elementType=this.defaultType=e;var s=this;t["createAdd"+e.name]=function(t){var n=new e(t);return s.add(n)};this.stateManager=new $data.EntityStateManager(this);this.collectionName=n;this.roles=i;for(var o in r){this[o]=r[o]}},addNew:function(e,t){var n=$data.typeSystem.createCallbackSetting(t);var r=new this.createNew(e);this.entityContext.saveChanges(t);return r},executeQuery:function(e,t){var n=$data.typeSystem.createCallbackSetting(t);this.entityContext.executeQuery(e,n)},getTraceString:function(e){return this.entityContext.getTraceString(e)},setContext:function(e){this.entitySetState=$data.entitySetState.active;this.entityContext=e;this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(e){var t=this.entityContext.stateManager.trackedEntities;for(var n=0;n<t.length;n++){if(t[n].data===e)return}t.push({entitySet:this,data:e})},add:function(e){var t=e;if(e instanceof $data.EntityWrapper){t=e.getEntity()}else if(!(e instanceof this.createNew)){t=new this.createNew(e)}t.entityState=$data.EntityState.Added;t.changedProperties=undefined;t.context=this.entityContext;this._trackEntity(t);return t},addMany:function(e){var t=[];var n=this;e.forEach(function(e){t.push(n.add(e))});return t},remove:function(e){var t=e;if(e instanceof $data.EntityWrapper){t=e.getEntity()}else if(!(e instanceof this.createNew)){t=new this.createNew(e)}t.entityState=$data.EntityState.Deleted;t.changedProperties=undefined;this._trackEntity(t)},attach:function(e,t){var n=e;if(e instanceof $data.EntityWrapper){n=e.getEntity()}else if(!(e instanceof this.createNew)){n=new this.createNew(e)}for(var r=0;r<this.entityContext.stateManager.trackedEntities.length;r++){var i=this.entityContext.stateManager.trackedEntities[r];if(i.data===n)break;if(i.data.equals(n)){Guard.raise(new Exception("Context already contains this entity!!!"))}}if(!t){n.entityState=$data.EntityState.Unchanged;n.changedProperties=undefined}n.context=this.entityContext;this._trackEntity(n)},detach:function(e){var t=e;if(e instanceof $data.EntityWrapper){t=e.getEntity()}else if(!(e instanceof this.createNew)){t=new this.createNew(e)}var n;var r=this.entityContext.stateManager.trackedEntities;for(var i=0;i<r.length;i++){if(r[i].data.equals(t))n=r[i]}if(n){var s=this.entityContext.stateManager.trackedEntities.indexOf(n);e.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(s,1);return}},attachOrGet:function(e){var t=e;if(e instanceof $data.EntityWrapper){t=e.getEntity()}else if(!(e instanceof this.createNew)){t=new this.createNew(e)}var n;var r=this.entityContext.stateManager.trackedEntities;for(var i=0;i<r.length;i++){if(r[i].data.equals(t))n=r[i]}if(n){return n.data}t.entityState=$data.EntityState.Unchanged;t.changedProperties=undefined;t.context=this.entityContext;this._trackEntity(t);return t},loadItemProperty:function(e,t,n){return this.entityContext.loadItemProperty(e,t,n)},saveChanges:function(){return this.entityContext.saveChanges.apply(this.entityContext,arguments)},addProperty:function(e,t,n){return this.elementType.addProperty.apply(this.elementType,arguments)},expression:{get:function(){if(!this._expression){var e=Container.createEntityContextExpression(this.entityContext);var t=this.entityContext.getType().getMemberDefinition(this.collectionName);var n=Container.createEntitySetExpression(e,Container.createMemberInfoExpression(t),null,this);this._expression=n}return this._expression},set:function(e){this._expression=e}},getFieldUrl:function(e,t){return this.entityContext.getFieldUrl(e,t,this)},bulkInsert:function(e,t,n){return this.entityContext.bulkInsert(this,e,t,n)}},null);$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(e){this.entityContext=null;this.trackedEntities=[];this.init(e)},init:function(e){this.entityContext=e},reset:function(){this.trackedEntities=[]}},null);$data.Class.define("$data.ItemStoreClass",null,null,{constructor:function(){var e=this;e.itemStoreConfig={aliases:{},contextTypes:{}};e.resetStoreToDefault("local",true);$data.addStore=function(){return e.addItemStoreAlias.apply(e,arguments)};$data.implementation=e.implementation;$data.Entity.addMember("storeToken",{get:function(){if(this.storeConfigs&&this.storeConfigs["default"])return this.storeConfigs.stores[this.storeConfigs["default"]]},set:function(t){e._setTypeStoreConfig(this,"default",t)}},true)},itemStoreConfig:{},addItemStoreAlias:function(e,t,n){var r=this;var i=new $data.PromiseHandler;var s=i.createCallback();if("string"===typeof e){if("object"===typeof t&&"factory"in t){var o=Container.resolveType(t.typeName);r.itemStoreConfig.aliases[e]=t.factory;r.itemStoreConfig.contextTypes[e]=o;if(n){r.itemStoreConfig["default"]=e}s.success();return i.getPromise()}else if("function"===typeof t){var u=t();var a;if(u&&u instanceof $data.EntityContext){s.success(u);a=i.getPromise()}else{a=u}return a.then(function(o){if(typeof o==="function"){return r.addItemStoreAlias(e,o,n)}if(o instanceof $data.EntityContext){return o.onReady().then(function(i){r.itemStoreConfig.aliases[e]=t;r.itemStoreConfig.contextTypes[e]=i.getType();if(n){r.itemStoreConfig["default"]=e}return i})}else{i=new $data.PromiseHandler;s=i.createCallback();s.error(new Exception("factory dont have context instance","Invalid arguments"));return i.getPromise()}})}}s.error(new Exception("Name or factory missing","Invalid arguments"));return i.getPromise()},resetStoreToDefault:function(e,t){this.itemStoreConfig.aliases[e]=this._getDefaultItemStoreFactory;delete this.itemStoreConfig.contextTypes[e];if(t){this.itemStoreConfig["default"]=e}},_setStoreAlias:function(e,t){if("object"===typeof t&&!e.storeToken)e.storeToken=t;return e},_getStoreAlias:function(e,t){var n;if(e instanceof $data.Entity){var r=t||e.storeToken;if(r){return r}else{n=e.getType()}}else{n=e}return t||(n.storeConfigs?n.storeConfigs["default"]:undefined)||n.storeToken},_getStoreContext:function(e,t,n){var r=this._getContextPromise(e,t);if(!r||r instanceof $data.EntityContext){var i=new $data.PromiseHandler;var s=i.createCallback();s.success(r);r=i.getPromise()}return r.then(function(e){if(e instanceof $data.EntityContext){return e.onReady()}else if(n){return null}else{var t=new $data.PromiseHandler;var r=t.createCallback();r.error(new Exception("factory return type error","Error"));return t.getPromise()}})},_getContextPromise:function(e,t){if(e&&"object"===typeof e&&"function"===typeof e.factory){return e.factory(t)}else if(e&&"object"===typeof e&&"object"===typeof e.args&&"string"===typeof e.typeName){var t=Container.resolveType(e.typeName);return new t(JSON.parse(JSON.stringify(e.args)))}else if(e&&"string"===typeof e&&t.storeConfigs&&t.storeConfigs.stores[e]&&typeof t.storeConfigs.stores[e].factory==="function"){return t.storeConfigs.stores[e].factory()}else if(e&&"string"===typeof e&&t.storeConfigs&&t.storeConfigs.stores[e]){return this._getDefaultItemStoreFactory(t,t.storeConfigs.stores[e])}else if(e&&"string"===typeof e&&this.itemStoreConfig.aliases[e]){return this.itemStoreConfig.aliases[e](t)}else if(e&&"function"===typeof e){return e()}else{return this.itemStoreConfig.aliases[this.itemStoreConfig["default"]](t)}},_getStoreEntitySet:function(e,t){var n=this._getStoreAlias(t,e);var r="function"===typeof t?t:t.getType();return this._getStoreContext(n,r).then(function(e){var t=e.getEntitySetFromElementType(r);if(!t){var n=new $data.PromiseHandler;var i=n.createCallback();i.error("EntitySet not exist for "+r.fullName);return n.getPromise()}return t})},_getDefaultItemStoreFactory:function(e,t){if(e){var n="function"===typeof e?e:e.getType();var r=$data.Container.resolveName(n)+"_items";var r=r.replace(/\./g,"_");var i=$data.typeSystem.extend({collectionName:t&&t.collectionName?t.collectionName:"Items",tableName:r,initParam:{provider:"local",databaseName:r}},t);var s={};s[i.collectionName]={type:$data.EntitySet,elementType:n};if(i.tableName)s[i.collectionName]["tableName"]=i.tableName;var o=$data.EntityContext.extend(r,s);var u=new o(i.initParam);if(t&&typeof t==="object")t.factory=u._storeToken.factory;return u}return undefined},implementation:function(e,t){var n=$data.ItemStore;var r;if(typeof t==="string"){t=n.itemStoreConfig.contextTypes[t]}else if(t instanceof $data.EntityContext){t=t.getType()}else if(!(typeof t==="function"&&t.isAssignableTo)){t=n.itemStoreConfig.contextTypes[n.itemStoreConfig["default"]]}if(t){r=n._resolveFromContext(t,e)}if(!r){r=Container.resolveType(e)}return r},_resolveFromContext:function(e,t){var n=e.memberDefinitions.getPublicMappedProperties();for(var r=0;r<n.length;r++){var i=n[r];if(i.type){var s=Container.resolveType(i.type);if(s.isAssignableTo&&s.isAssignableTo($data.EntitySet)){var o=Container.resolveType(i.elementType);if(o.name===t){return o}}}}return null},EntityInstanceSave:function(e,t){var n=$data.ItemStore;var r=this;return n._getStoreEntitySet(e,r).then(function(i){return n._getSaveMode(r,i,t,e).then(function(e){e=e||"add";switch(e){case"add":i.add(r);break;case"attach":i.attach(r,true);r.entityState=$data.EntityState.Modified;break;default:var t=new $data.PromiseHandler;var s=t.createCallback();s.error("save mode not supported: "+e);return t.getPromise()}return i.entityContext.saveChanges().then(function(){n._setStoreAlias(r,i.entityContext.storeToken);return r})})})},EntityInstanceRemove:function(e){var t=$data.ItemStore;var n=this;return t._getStoreEntitySet(e,n).then(function(e){e.remove(n);return e.entityContext.saveChanges().then(function(){return n})})},EntityInstanceRefresh:function(e,t){var n=$data.ItemStore;var r=this;var i=r.getType();var s=n._getKeyObjectFromEntity(r,i);return i.read(s,e).then(function(e){i.memberDefinitions.getPublicMappedProperties().forEach(function(t){r[t.name]=e[t.name]});r.storeToken=(t?r.storeToken:undefined)||e.storeToken;r.changedProperties=undefined;return r})},EntityInheritedTypeProcessor:function(e){var t=$data.ItemStore;e.readAll=t.EntityTypeReadAll(e);e.read=t.EntityTypeRead(e);e.removeAll=t.EntityTypeRemoveAll(e);e.remove=t.EntityTypeRemove(e);e.get=t.EntityTypeGet(e);e.save=t.EntityTypeSave(e);e.addMany=t.EntityTypeAddMany(e);e.itemCount=t.EntityTypeItemCount(e);e.query=t.EntityTypeQuery(e);e.takeFirst=t.EntityTypeTakeFirst(e);e.setStore=t.EntityTypeSetStore(e)},EntityTypeReadAll:function(e){return function(t){var n=$data.ItemStore;return n._getStoreEntitySet(t,e).then(function(e){return e.forEach(function(t){n._setStoreAlias(t,e.entityContext.storeToken)})})}},EntityTypeRemoveAll:function(e){return function(t){var n=$data.ItemStore;return n._getStoreEntitySet(t,e).then(function(e){return e.toArray().then(function(t){t.forEach(function(t){e.remove(t)});return e.entityContext.saveChanges().then(function(){return t})})})}},EntityTypeRead:function(e){return function(t,n){var r=$data.ItemStore;return r._getStoreEntitySet(n,e).then(function(e){try{var n=r._findByIdQueryable(e,t);return e.single(n.predicate,n.thisArgs).then(function(t){return r._setStoreAlias(t,e.entityContext.storeToken)})}catch(i){var s=new $data.PromiseHandler;var o=s.createCallback();o.error(i);return s.getPromise()}})}},EntityTypeGet:function(e){return function(t,n){var r=$data.ItemStore;var i=new e(r._getKeyObjectFromEntity(t));i.refresh(n);return i}},EntityTypeSave:function(e){return function(t,n,r){var i=$data.ItemStore;var s=new e(t);return s.save(n,r)}},EntityTypeAddMany:function(e){return function(t,n){var r=$data.ItemStore;return r._getStoreEntitySet(n,e).then(function(e){var n=e.addMany(t);return e.entityContext.saveChanges().then(function(){return n})})}},EntityTypeRemove:function(e){return function(t,n){var r=$data.ItemStore;var i=e.memberDefinitions.getKeyProperties();var s;if(i.length===1){var o={};o[i[0].name]=t;s=new e(o)}else{s=new e(t)}return s.remove(n)}},EntityTypeItemCount:function(e){return function(t){var n=$data.ItemStore;return n._getStoreEntitySet(t,e).then(function(e){return e.length()})}},EntityTypeQuery:function(e){return function(t,n,r){var i=$data.ItemStore;return i._getStoreEntitySet(r,e).then(function(e){return e.filter(t,n).forEach(function(t){i._setStoreAlias(t,e.entityContext.storeToken)})})}},EntityTypeTakeFirst:function(e){return function(t,n,r){var i=$data.ItemStore;return i._getStoreEntitySet(r,e).then(function(e){return e.first(t,n).then(function(t){return i._setStoreAlias(t,e.entityContext.storeToken)})})}},EntityTypeSetStore:function(e){return function(t,n){if(typeof t==="object"&&typeof n==="undefined"){n=t;t="default"}var r=$data.ItemStore;var i={};if(n){if(n.tableName){i.tableName=n.tableName;delete n.tableName}if(n.collectionName){i.collectionName=n.collectionName;delete n.collectionName}if(typeof n.dataSource==="string"){var s=n.dataSource;if(s.lastIndexOf("/")===s.length-1){s=s.substring(0,s.lastIndexOf("/"))}var o=s.substring(0,s.lastIndexOf("/"));if(!i.tableName)i.tableName=s.substring(s.lastIndexOf("/")+1);var u=n.provider||n.name;switch(u){case"oData":n.oDataServiceHost=n.oDataServiceHost||o;break;case"webApi":n.apiUrl=n.apiUrl||o;break;default:break}}}else{n={name:"local"}}i.initParam=n;r._setTypeStoreConfig(e,t,i);return e}},_setTypeStoreConfig:function(e,t,n){if(!e.storeConfigs){e.storeConfigs={stores:{}}}e.storeConfigs.stores[t]=n;if(t==="default"){e.storeConfigs["default"]=t}},_findByIdQueryable:function(e,t){var n=e.defaultType.memberDefinitions.getKeyProperties();if(n.length>1&&t&&"object"===typeof t){var r="",i={};for(var s=0;s<n.length;s++){if(s>0)r+=" && ";var o=n[s];r+="it."+o.name+" == this."+o.name;i[o.name]=t[o.name]}return{predicate:r,thisArgs:i}}else if(n.length===1){return{predicate:"it."+n[0].name+" == this.value",thisArgs:{value:t}}}else{throw"invalid keys"}},_getKeyObjectFromEntity:function(e,t){var n;var r=t.memberDefinitions.getKeyProperties();if(r.length===1)n=e&&typeof e==="object"?e[r[0].name]:e;else{n={};for(var i=0;i<r.length;i++){n[r[0].name]=e?e[r[0].name]:e}}return n},_getSaveMode:function(e,t,n,r){var i=this;var s=new $data.PromiseHandler;var o=s.createCallback();var u=e.getType();switch(true){case n==="update":o.success("attach");break;case n==="new":o.success("add");break;case false===u.memberDefinitions.getKeyProperties().every(function(t){return e[t.name]}):o.success("add");break;case!!e.storeToken:o.success("attach");break;break;default:r=this._getStoreAlias(e,r);u.read(i._getKeyObjectFromEntity(e,u),r).then(function(){o.success("attach")}).fail(function(){o.success("add")});break}return s.getPromise()},ContextRegister:function(e){var t=this;var n=JSON.parse(JSON.stringify(e));this.storeToken={typeName:this.getType().fullName,args:n,factory:function(){return new(t.getType())(n)}};var r=this.getType().memberDefinitions.getPublicMappedProperties();for(var i=0;i<r.length;i++){var s=r[i];if(s.type){var o=Container.resolveType(s.type);if(o&&o.isAssignableTo&&o.isAssignableTo($data.EntitySet)){var u=Container.resolveType(s.elementType);if(!u.storeToken){u.storeToken=this.storeToken}}}}},QueryResultModifier:function(e){var t=$data.ItemStore;var n=e.context;var r=e.modelBinderConfig.$type;if("string"===typeof r){r=Container.resolveType(r)}if(r===$data.Array&&e.modelBinderConfig.$item&&e.modelBinderConfig.$item.$type){r=e.modelBinderConfig.$item.$type}if(typeof r==="undefined"&&e.result&&e.result[0]instanceof $data.Entity){var i=!r?[]:r.memberDefinitions.getPublicMappedProperties().filter(function(e){return!!e.inverseProperty});for(var s=0;s<e.result.length;s++){t._setStoreAlias(e.result[s],n.storeToken);for(var o=0;o<i.length;o++){var u=i[o];if(e.result[s][u.name]instanceof $data.Entity){t._setStoreAlias(e.result[s][u.name],n.storeToken)}else if(Array.isArray(e.result[s][u.name])){for(var a=0;a<e.result[s][u.name].length;a++){if(e.result[s][u.name][a]instanceof $data.Entity){t._setStoreAlias(e.result[s][u.name][a],n.storeToken)}}}}}}}});$data.ItemStore=new $data.ItemStoreClass;$data.Entity.addMember("field",function(e){var t=this.memberDefinitions.getMember(e);if(t){if(t.definedBy===this){return new $data.MemberWrapper(t)}else{Guard.raise(new Exception("Member '"+e+"' defined on '"+t.definedBy.fullName+"'!","Invalid Operation"))}}else{Guard.raise(new Exception("Member '"+e+"' not exists!","Invalid Operation"))}return this},true);$data.Class.define("$data.MemberWrapper",null,null,{constructor:function(e){this.memberDefinition=e},setKey:function(e){this.memberDefinition.key=e||e===undefined?true:false;return this},setComputed:function(e){this.memberDefinition.computed=e||e===undefined?true:false;return this},setRequired:function(e){this.memberDefinition.required=e||e===undefined?true:false;return this},setNullable:function(e){this.memberDefinition.nullable=e||e===undefined?true:false;return this},changeDefinition:function(e,t){this.memberDefinition[e]=t;return this}});$data.Class.define("$data.StorageProviderLoaderBase",null,null,{isSupported:function(e){$data.Trace.log("Detecting "+e+" provider support");var t=true;switch(e){case"indexedDb":t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB&&!/^file:/.test(window.location.href);break;case"storm":t="XMLHttpRequest"in window;break;case"webSql":case"sqLite":t="openDatabase"in window;break;case"LocalStore":t="localStorage"in window&&window.localStorage?true:false;break;case"sqLite":t="openDatabase"in window;break;case"mongoDB":t=$data.mongoDBDriver;break;default:break}$data.Trace.log(e+" provider is "+(t?"":"not")+" supported");return t},scriptLoadTimeout:{type:"int",value:1e3},scriptLoadInterval:{type:"int",value:50},npmModules:{value:{indexedDb:"jaydata-indexeddb",InMemory:"jaydata-inmemory",LocalStore:"jaydata-inmemory",mongoDB:"jaydata-mongodb",oData:"jaydata-odata",webApi:"jaydata-webapi",sqLite:"jaydata-sqlite",webSql:"jaydata-sqlite",storm:"jaydata-storm"}},ProviderNames:{value:{indexedDb:"IndexedDb",InMemory:"InMemory",LocalStore:"InMemory",oData:"oData",webApi:"WebApi",sqLite:"SqLite",webSql:"SqLite",storm:"Storm"}},load:function(e,t){$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||{};$data.Trace.log("Loading provider(s): "+e);t=$data.typeSystem.createCallbackSetting(t);var n=this;var r=e.join(",");n._fallbackCache=n._fallbackCache||{};if(n._fallbackCache[r]){t.success(n._fallbackCache[r])}else{this.find(e,{success:function(e,i){n._fallbackCache[r]=e;t.success.call(this,e)},error:t.error})}},find:function(e,t){var n=e.shift();var n=this.getVirtual(n);if(Array.isArray(n)){e=n;n=e.shift()}while(n&&!this.isSupported(n)){n=e.shift()}$data.Trace.log("First supported provider is "+n);if(!n){$data.Trace.log("Provider fallback failed");t.error()}if($data.RegisteredStorageProviders){$data.Trace.log("Is the "+n+" provider already registered?");var r=$data.RegisteredStorageProviders[n];if(r){$data.Trace.log(n+" provider registered");t.success(r);return}else{$data.Trace.log(n+" provider not registered")}}if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){$data.Trace.log("node.js detected trying to load NPM module");this.loadNpmModule(n,e,t)}else{$data.Trace.log("Browser detected trying to load provider");this.loadProvider(n,e,t)}},loadProvider:function(e,t,n){var r=this;var i=$data.StorageProviderLoader.ProviderNames[e]||e;$data.Trace.log(e+" provider is mapped to name "+i+"Provider");if(i){var s=this.getUrl(i);$data.Trace.log(e+" provider from URL: "+s);var o=this.loadScript;if(document&&document.createElement){$data.Trace.log("document and document.createElement detected, using script element loader method");o=this.loadScriptElement}o.call(this,s,e,function(i){var s=$data.RegisteredStorageProviders[e];if(i&&s){$data.Trace.log(e+" provider successfully registered");n.success(s)}else if(t.length>0){$data.Trace.log(e+" provider failed to load, trying to fallback to "+t+" provider(s)");r.find(t,n)}else{$data.Trace.log(e+" provider failed to load");n.error()}})}},getUrl:function(e){var t=document.querySelector('script[src$="jaydata.min.js"]');var n=document.querySelector('script[src$="jaydata.js"]');if(t)return t.src.substring(0,t.src.lastIndexOf("/")+1)+"jaydataproviders/"+e+"Provider.min.js";else if(n)return n.src.substring(0,n.src.lastIndexOf("/")+1)+"jaydataproviders/"+e+"Provider.js";else return"jaydataproviders/"+e+"Provider.js"},loadScript:function(url,currentProvider,callback){function getHttpRequest(){if(window.XMLHttpRequest)return new XMLHttpRequest;else if(window.ActiveXObject)return new ActiveXObject("MsXml2.XmlHttp");else{$data.Trace.log("XMLHttpRequest or MsXml2.XmlHttp ActiveXObject not found");callback(false);return}}if(!url){callback(false);return}var oXmlHttp=getHttpRequest();oXmlHttp.onreadystatechange=function(){$data.Trace.log("HTTP request is in state: "+oXmlHttp.readyState);if(oXmlHttp.readyState==4){if(oXmlHttp.status==200||oXmlHttp.status==304){$data.Trace.log("HTTP request succeeded");$data.Trace.log("HTTP request response text: "+oXmlHttp.responseText);eval.call(window,oXmlHttp.responseText);if(typeof callback==="function")callback(true);else $data.Trace.log("Callback function is undefined")}else{$data.Trace.log("HTTP request status: ",oXmlHttp.status);if(typeof callback==="function")callback(false);else $data.Trace.log("Callback function is undefined")}}};oXmlHttp.open("GET",url,true);oXmlHttp.send(null)},loadScriptElement:function(e,t,n){function u(){$data.Trace.log("Script element watcher iteration "+o);var e=$data.RegisteredStorageProviders[t];if(e){$data.Trace.log(t+" provider registered");n(true)}else{o--;if(o>0){$data.Trace.log("Script element watcher next iteration");setTimeout(u,s)}else{$data.Trace.log("Script element loader failed");n(false)}}}var r=document.getElementsByTagName("head")[0]||document.documentElement;var i=document.createElement("script");i.type="text/javascript";i.src=e;$data.Trace.log("Appending child "+i+" to "+r);r.appendChild(i);var s=this.scriptLoadInterval||50;var o=Math.ceil(this.scriptLoadTimeout/s);$data.Trace.log("Script element watcher iterating "+o+" times");setTimeout(u,s)},loadNpmModule:function(e,t,n){var r=null;try{require(this.npmModules[e]);r=$data.RegisteredStorageProviders[e];$data.Trace.log("NPM module loader successfully registered "+e+" provider")}catch(i){$data.Trace.log("NPM module loader failed for "+e+" provider")}if(r){n.success(r)}else if(t.length>0){this.find(t,n)}else{n.error()}},virtualProviders:{type:$data.Array,value:{local:{fallbacks:["webSql","indexedDb","LocalStore"]}}},getVirtual:function(e){if(this.virtualProviders[e])return[].concat(this.virtualProviders[e].fallbacks);return e}});$data.StorageProviderLoader=new $data.StorageProviderLoaderBase;$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropTableIfChange:20,DropAllExistingTables:30,ErrorIfChange:40,DropDbIfChange:50}};$data.ConcurrencyMode={Fixed:"fixed",None:"none"};$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(e,t){this.providerConfiguration=e||{};this.name=this.getType().name;if($data.RegisteredStorageProviders){var n=Object.keys($data.RegisteredStorageProviders);for(var r=0;r<n.length;r++){if(this instanceof $data.RegisteredStorageProviders[n[r]]){this.name=n[r];break}}}},providers:{},supportedDataTypes:{value:[],writable:false},initializeStore:function(e){Guard.raise("Pure class")},executeQuery:function(e,t){Guard.raise("Pure class")},buildIndependentBlocks:function(e){function r(e){for(var t in e){if(e.hasOwnProperty(t))return true}return false}var t=[];var n=[];for(var i=0;i<e.length;i++){var s=e[i];if(!s.dependentOn||s.dependentOn.length==0){continue}var o=null;for(var u=0;u<s.dependentOn.length;u++){var a=s.dependentOn[u];if(a.entityState==$data.EntityState.Unchanged){continue}o=o||{};var f=-1;for(var l=0;l<e.length;l++){if(e[l].data==a){f=l;break}}if(f==-1){Guard.raise(new Exception("Dependent object not found","ObjectNotFound",s.dependentOn[u]))}o[f]=true;from=n[f]||{};from[i]=true;n[f]=from}if(o!==null)t[i]=o}var c=[];var h=[];for(var p=0;p<e.length;p++){if(!t.hasOwnProperty(p)){h.push(p)}}while(h.length>0){var d=[].concat(h);h=[];for(var v=0;v<d.length;v++){var m=n[d[v]];if(typeof m!=="undefined"){for(var g in m){delete t[g][d[v]];if(!r(t[g])){delete t[g];h.push(g)}}}delete n[d[v]]}var y=[];for(var b=0;b<d.length;b++){var w=e[d[b]];if(w.data.entityState!=$data.EntityState.Unchanged)y.push(w)}if(y.length>0)c.push(y)}return c},getTraceString:function(e){Guard.raise("Pure class")},setContext:function(e){this.context=e},_buildContinuationFunction:function(e,t){if(Array.isArray(t.result)){t.result.next=this._buildPagingMethod(e,t,"next");t.result.prev=this._buildPagingMethod(e,t,"prev")}},_buildPagingMethod:function(e,t,n){return function(r){var i=new $data.PromiseHandler;var s=i.createCallback(r);var o=new $data.Expressions.ContinuationExpressionBuilder(n);var u=o.compile(t);if(u.expression){var a=Container.createQueryable(e,u.expression);a.defaultType=t.defaultType;e.executeQuery(a,s)}else{s.error(new Exception(u.message,"Invalid Operation",u))}return i.getPromise()}},buildDbType_modifyInstanceDefinition:function(e,t){var n=function(t,n){var r;if(n){r=JSON.parse(JSON.stringify(e[n]));r.kind=t.kind;r.name=t.name;r.notMapped=false}else{r=JSON.parse(JSON.stringify(t))}r.dataType=Container.resolveType(t.dataType);r.type=r.dataType;r.key=false;r.computed=false;return r};var r=function(e,t,n,r){var i=new Object;i[e.name]=n;i[t.name]=r+"__"+n;return i};if(t.Associations){t.Associations.forEach(function(t){var i=false;var s=t.FromType;var o=t.ToType;var u=t.ToPropertyName;t.ReferentialConstraint=t.ReferentialConstraint||[];if(t.FromMultiplicity=="*"&&t.ToMultiplicity=="0..1"||t.FromMultiplicity=="0..1"&&t.ToMultiplicity=="1"){s=t.ToType;o=t.FromType;u=t.FromPropertyName;i=true}s.memberDefinitions.getPublicMappedProperties().filter(function(e){return e.key}).forEach(function(a){if(i){e[u+"__"+a.name]=n(a,u)}t.ReferentialConstraint.push(r(s,o,a.name,u))},this)},this)}if(t.ComplexTypes){t.ComplexTypes.forEach(function(t){t.ReferentialConstraint=t.ReferentialConstraint||[];t.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(i){e[t.FromPropertyName+"__"+i.name]=n(i);t.ReferentialConstraint.push(r(t.ToType,t.FromType,i.name,t.FromPropertyName))},this)},this)}},buildDbType_generateConvertToFunction:function(e){return function(t){var n=new e.PhysicalType;n.entityState=t.entityState;e.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(e){if(t[e.name]!==undefined){n[e.name]=t[e.name]}},this);if(e.Associations){e.Associations.forEach(function(e){if(e.FromMultiplicity=="*"&&e.ToMultiplicity=="0..1"||e.FromMultiplicity=="0..1"&&e.ToMultiplicity=="1"){var r=t[e.FromPropertyName];if(r!==undefined){e.ReferentialConstraint.forEach(function(t){if(r!==null){n[t[e.From]]=r[t[e.To]]}else{n[t[e.From]]=null}},this)}}},this)}if(e.ComplexTypes){e.ComplexTypes.forEach(function(e){var r=t[e.FromPropertyName];if(r!==undefined){e.ReferentialConstraint.forEach(function(t){if(r!==null){n[t[e.From]]=r[t[e.To]]}else{n[t[e.From]]=null}},this)}},this)}return n}},bulkInsert:function(e,t,n,r){r.error(new Exception("Not Implemented"))},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:true,writable:true},resolveFieldOperation:function(e,t,n){var r=this.supportedFieldOperations[e];if(Array.isArray(r)){var i=0;for(;i<r.length;i++){if(r[i].allowedType==="default"||Container.resolveType(r[i].allowedType)===Container.resolveType(t.selector.memberDefinition.type)&&n&&r[i].allowedIn&&(Array.isArray(r[i].allowedIn)&&r[i].allowedIn.some(function(e){return n===Container.resolveType(e)})||!Array.isArray(r[i].allowedIn)&&n===Container.resolveType(r[i].allowedIn))){r=r[i];break}}if(i===r.length){r=undefined}}if(!r){Guard.raise(new Exception("Field operation '"+e+"' is not supported by the provider"))}if(n&&r.allowedIn){if(r.allowedIn instanceof Array&&!r.allowedIn.some(function(e){return n===Container.resolveType(e)})||!(r.allowedIn instanceof Array)&&n!==Container.resolveType(r.allowedIn)){Guard.raise(new Exception(e+" not supported in: "+n.name))}}r.name=e;return r},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},enumerable:true,writable:true},resolveBinaryOperator:function(e,t,n){var r=this.supportedBinaryOperators[e];if(!r){Guard.raise(new Exception("Binary operator '"+e+"' is not supported by the provider"))}if(n&&r.allowedIn){if(r.allowedIn instanceof Array&&!r.allowedIn.some(function(e){return n===Container.resolveType(e)})||!(r.allowedIn instanceof Array)&&n!==Container.resolveType(r.allowedIn)){Guard.raise(new Exception(e+" not supported in: "+n.name))}}r.name=e;return r},supportedUnaryOperators:{value:{not:{mapTo:"not"}},enumerable:true,writable:true},resolveUnaryOperator:function(e,t,n){var r=this.supportedUnaryOperators[e];if(!r){Guard.raise(new Exception("Unary operator '"+e+"' is not supported by the provider"))}if(n&&r.allowedIn){if(r.allowedIn instanceof Array&&!r.allowedIn.some(function(e){return n===Container.resolveType(e)})||!(r.allowedIn instanceof Array)&&n!==Container.resolveType(r.allowedIn)){Guard.raise(new Exception(e+" not supported in: "+n.name))}}r.name=e;return r},supportedSetOperations:{value:{toArray:{invokable:true,allowedIn:[]}},enumerable:true,writable:true},resolveSetOperations:function(e,t,n){var r=this.supportedSetOperations[e];if(!r){Guard.raise(new Exception("Operation '"+e+"' is not supported by the provider"))}var i=r.allowedIn||[];if(n&&i){if(i instanceof Array&&!i.some(function(e){return n===Container.resolveType(e)})||!(i instanceof Array)&&n!==Container.resolveType(i)){Guard.raise(new Exception(e+" not supported in: "+n.name))}}return r},resolveTypeOperations:function(e,t,n){Guard.raise(new Exception("Entity '"+t.entityType.name+"' Operation '"+e+"' is not supported by the provider"))},resolveContextOperations:function(e,t,n){Guard.raise(new Exception("Context '"+t.instance.getType().name+"' Operation '"+e+"' is not supported by the provider"))},makePhysicalTypeDefinition:function(e,t){},_beginTran:function(e,t,n){n.success(new $data.Transaction)},getFieldUrl:function(){return"#"},supportedAutoincrementKeys:{value:{}}},{onRegisterProvider:{value:new $data.Event},registerProvider:function(e,t){this.onRegisterProvider.fire({name:e,provider:t},this);$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];$data.RegisteredStorageProviders[e]=t},getProvider:function(e){var t=$data.RegisteredStorageProviders[e];if(!t)console.warn("Provider not found: '"+e+"'");return t},isSupported:{get:function(){return true},set:function(){}}});$data.Class.define("$data.ServiceOperation",null,null,{},{translateDefinition:function(e,t,n){e.serviceName=t;var r=new $data.MemberDefinition(this.generateServiceOperation(e),this);r.name=t;return r},generateServiceOperation:function(e){var t;if(e.serviceMethod){var n=e.returnType?Container.resolveType(e.returnType):{};if(n.isAssignableTo&&n.isAssignableTo($data.Queryable)){t=e.serviceMethod}else{t=function(){var t=arguments[arguments.length-1];var n=new $data.PromiseHandler;var r;var i=arguments;if(typeof t==="function"){r=n.createCallback(t);arguments[arguments.length-1]=r}else{r=n.createCallback();arguments.push(r)}try{var s=e.serviceMethod.apply(this,arguments);if(s!==undefined)r.success(s)}catch(o){r.error(o)}return n.getPromise()}}}else{t=function(){var t=this;var n;var r;if(this instanceof $data.Entity||this instanceof $data.EntitySet){var i;if(this instanceof $data.Entity){if(this.context){t=this.context;i=t.getEntitySetFromElementType(this.getType())}else if(this.storeToken&&typeof this.storeToken.factory==="function"){t=this.storeToken.factory();i=t.getEntitySetFromElementType(this.getType())}else{Guard.raise(new Exception("entity can't resolve context","Not Found!",this));return}}else if(this instanceof $data.EntitySet){t=this.entityContext;i=this;var s=t.getType().getMemberDefinition(i.name);n=$data.MemberDefinition.translateDefinition(s.actions[e.serviceName],e.serviceName,i.getType())}r={data:this,entitySet:i}}var o=e.elementType?t.getEntitySetFromElementType(Container.resolveType(e.elementType)):null;var u=null;if(e.params){u=[];if(arguments[0]&&typeof arguments[0]==="object"&&arguments[0].constructor===$data.Object&&e.params&&e.params[0]&&e.params[0].name in arguments[0]){var a=arguments[0];for(var f=0;f<e.params.length;f++){var l=e.params[f];if(l.name&&l.type&&l.name in a){u.push(Container.createConstantExpression(a[l.name],Container.resolveType(l.type),l.name))}}}else{for(var f=0;f<e.params.length;f++){if(typeof arguments[f]=="function")break;var l=e.params[f];if(l.name&&l.type&&arguments[f]!==undefined){u.push(Container.createConstantExpression(arguments[f],Container.resolveType(l.type),l.name))}}}}var c=Container.createEntityContextExpression(t);if(!n){if(r&&r.data){n=r.data.getType().getMemberDefinition(e.serviceName)}else{n=t.getType().getMemberDefinition(e.serviceName)}}var h=Container.createServiceOperationExpression(c,Container.createMemberInfoExpression(n),u,e,r);var p=arguments[arguments.length-1];if(!(typeof p==="function"||typeof p==="object"&&(typeof p.success==="function"||typeof p.error==="function"))){p=undefined}if(o){var d=Container.createQueryable(o,h);if(p){h.isTerminated=true;return d._runQuery(p)}return d}else{var v=e.returnType?Container.resolveType(e.returnType):null;var d=Container.createQueryable(t,h);d.defaultType=v||$data.Object;if(v===$data.Queryable){d.defaultType=Container.resolveType(e.elementType);if(p){h.isTerminated=true;return d._runQuery(p)}return d}h.isTerminated=true;return d._runQuery(p)}}}var r=e.params||[];$data.typeSystem.extend(t,e,{params:r});return t}});$data.Class.define("$data.ServiceAction",$data.ServiceOperation,null,{},{generateServiceOperation:function(e){if(!e.method){e.method="POST"}return $data.ServiceOperation.generateServiceOperation.apply(this,arguments)}});$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}});if(typeof jQuery!=="undefined"&&jQuery.ajax){$data.ajax=$data.ajax||jQuery.ajax}if(typeof WinJS!=="undefined"&&WinJS.xhr){$data.ajax=$data.ajax||function(e){$data.typeSystem.extend(e,{dataType:"json",headers:{}});var t={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(e){return e}},html:{accept:"text/html",convert:function(e){return e}},xml:{accept:"application/xml, text/xml",convert:function(e){return e}}};var n=t[e.dataType.toLowerCase()];e.headers.Accept=n.accept;var r=e.success||$data.defaultSuccessCallback;var i=e.error||$data.defaultErrorCallback;var s=e.progress;var o=function(e){var t=n.convert(e.responseText);r(t)};var u=function(e){var t=n.convert(e.responseText);i(t)};var a=s;WinJS.xhr(e).done(o,u,a)}}if(typeof Ext!=="undefined"&&typeof Ext.Ajax){$data.ajax=$data.ajax||function(e){Ext.Ajax.request(e)}}$data.ajax=$data.ajax||function(){var e=arguments[arguments.length-1];var t=$data.typeSystem.createCallbackSetting(e);t.error("Not implemented")};$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(e){this.projectionExpression=e}});$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(e,t,n){this._query=e;this._includes=t;this._isoDataProvider=n||false},VisitSingleExpression:function(e){this._defaultModelBinder(e)},VisitSomeExpression:function(e){this._defaultModelBinder(e)},VisitFindExpression:function(e){this._defaultModelBinder(e)},VisitEveryExpression:function(e){this._defaultModelBinder(e)},VisitToArrayExpression:function(e){this._defaultModelBinder(e)},VisitFirstExpression:function(e){this._defaultModelBinder(e)},VisitForEachExpression:function(e){this._defaultModelBinder(e)},VisitServiceOperationExpression:function(e){if(e.cfg.returnType){var t=Container.resolveType(e.cfg.returnType);if(typeof t.isAssignableTo==="function"&&t.isAssignableTo($data.Queryable)||t===$data.Array){this._defaultModelBinder(e)}else{var n=Container.createqueryBuilder();n.modelBinderConfig["$type"]=t;if(typeof t.isAssignableTo==="function"&&t.isAssignableTo($data.Entity)){n.modelBinderConfig["$selector"]=["json:"+e.cfg.serviceName]}else{n.modelBinderConfig["$type"]=t;n.modelBinderConfig["$value"]=function(t,n){return e.cfg.serviceName in n?n[e.cfg.serviceName]:n.value}}this.VisitExpression(e,n);n.resetModelBinderProperty();this._query.modelBinderConfig=n.modelBinderConfig}}},VisitCountExpression:function(e){var t=Container.createqueryBuilder();t.modelBinderConfig["$type"]=$data.Array;t.selectModelBinderProperty("$item");t.modelBinderConfig["$type"]=$data.Integer;t.modelBinderConfig["$source"]="cnt";t.resetModelBinderProperty();this._query.modelBinderConfig=t.modelBinderConfig},VisitBatchDeleteExpression:function(e){var t=Container.createqueryBuilder();t.modelBinderConfig["$type"]=$data.Array;t.selectModelBinderProperty("$item");t.modelBinderConfig["$type"]=$data.Integer;t.modelBinderConfig["$source"]="cnt";t.resetModelBinderProperty();this._query.modelBinderConfig=t.modelBinderConfig},VisitConstantExpression:function(e,t){t.modelBinderConfig["$type"]=e.type;t.modelBinderConfig["$value"]=e.value},VisitExpression:function(e,t){var n=Container.createFindProjectionVisitor();n.Visit(e);if(n.projectionExpression){this.Visit(n.projectionExpression,t)}else{this.DefaultSelection(t,this._query.defaultType,this._includes)}},_defaultModelBinder:function(e){var t=Container.createqueryBuilder();t.modelBinderConfig["$type"]=$data.Array;if(this._isoDataProvider){t.modelBinderConfig["$selector"]=["json:d.results","json:d","json:results"]}t.modelBinderConfig["$item"]={};t.selectModelBinderProperty("$item");this.VisitExpression(e,t);t.resetModelBinderProperty();this._query.modelBinderConfig=t.modelBinderConfig},_addPropertyToModelBinderConfig:function(e,t){var n=this._query.context._storageModel.getStorageModel(e);if(e.memberDefinitions){e.memberDefinitions.getPublicMappedProperties().forEach(function(e){if(!n||n&&!n.Associations[e.name]&&!n.ComplexTypes[e.name]){var r=Container.resolveType(e.dataType);if(!n&&this._query.context.storageProvider.supportedDataTypes.indexOf(r)<0){t.selectModelBinderProperty(e.name);t.modelBinderConfig["$type"]=r;if(this._isoDataProvider){t.modelBinderConfig["$selector"]=["json:"+e.name+".results","json:"+e.name]}else{t.modelBinderConfig["$selector"]="json:"+e.name}this._addPropertyToModelBinderConfig(r,t);t.popModelBinderProperty()}else{if(e.key){t.addKeyField(e.name)}if(e.concurrencyMode===$data.ConcurrencyMode.Fixed){t.modelBinderConfig[e.name]={$selector:"json:__metadata",$source:"etag"}}else if(r===$data.Array&&e.elementType){t.selectModelBinderProperty(e.name);t.modelBinderConfig["$type"]=r;if(this._isoDataProvider){t.modelBinderConfig["$selector"]=["json:"+e.name+".results","json:"+e.name]}else{t.modelBinderConfig["$selector"]="json:"+e.name}t.selectModelBinderProperty("$item");var i=Container.resolveType(e.elementType);t.modelBinderConfig["$type"]=i;this._addPropertyToModelBinderConfig(i,t);t.popModelBinderProperty();t.popModelBinderProperty()}else{t.modelBinderConfig[e.name]=e.name}}}},this)}else{t._binderConfig.$item=t._binderConfig.$item||{};t.modelBinderConfig=t._binderConfig.$item}if(n){this._addComplexTypeProperties(n.ComplexTypes,t)}},_addComplexTypeProperties:function(e,t){e.forEach(function(e){if(e.ToType!==$data.Array){t.selectModelBinderProperty(e.FromPropertyName);t.modelBinderConfig["$type"]=e.ToType;if(this._isoDataProvider){t.modelBinderConfig["$selector"]=["json:"+e.FromPropertyName+".results","json:"+e.FromPropertyName]}else{t.modelBinderConfig["$selector"]="json:"+e.FromPropertyName}this._addPropertyToModelBinderConfig(e.ToType,t);t.popModelBinderProperty()}else{var n=e.ToType;var r=Container.resolveType(e.FromType.memberDefinitions.getMember(e.FromPropertyName).elementType);if(n===$data.Array&&r&&r.isAssignableTo&&r.isAssignableTo($data.Entity)){config={$type:$data.Array,$selector:"json:"+e.FromPropertyName,$item:{$type:r}};var i=r.memberDefinitions.getPublicMappedProperties();for(var s=0;s<i.length;s++){config.$item[i[s].name]={$type:i[s].type,$source:i[s].name}}t.modelBinderConfig[e.FromPropertyName]=config}else{t.modelBinderConfig[e.FromPropertyName]={$type:e.ToType,$source:e.FromPropertyName}}}},this)},DefaultSelection:function(e,t,n){e.modelBinderConfig["$type"]=t;var r=this._query.context._storageModel.getStorageModel(t);this._addPropertyToModelBinderConfig(t,e);if(n){n.forEach(function(t){var n=t.name.split(".");var i=null;var s=r;var o=0;for(var u=0;u<n.length;u++){if(e.modelBinderConfig.$item){e.selectModelBinderProperty("$item");o++}e.selectModelBinderProperty(n[u]);i=s.Associations[n[u]];s=this._query.context._storageModel.getStorageModel(i.ToType)}if(this._isoDataProvider){e.modelBinderConfig["$selector"]=["json:"+n[n.length-1]+".results","json:"+n[n.length-1]]}else{e.modelBinderConfig["$selector"]="json:"+n[n.length-1]}if(i.ToMultiplicity==="*"){e.modelBinderConfig["$type"]=$data.Array;e.selectModelBinderProperty("$item");e.modelBinderConfig["$type"]=t.type;this._addPropertyToModelBinderConfig(t.type,e);e.popModelBinderProperty()}else{e.modelBinderConfig["$type"]=t.type;this._addPropertyToModelBinderConfig(t.type,e)}for(var u=0;u<n.length+o;u++){e.popModelBinderProperty()}},this)}},VisitProjectionExpression:function(e,t){this.hasProjection=true;this.Visit(e.selector,t);if(e.selector&&e.selector.expression instanceof $data.Expressions.ObjectLiteralExpression){t.modelBinderConfig["$type"]=e.projectionAs||t.modelBinderConfig["$type"]||$data.Object}},VisitParametricQueryExpression:function(e,t){if(e.expression instanceof $data.Expressions.EntityExpression||e.expression instanceof $data.Expressions.EntitySetExpression){this.VisitEntityAsProjection(e,t)}else{this.Visit(e.expression,t)}},VisitEntityAsProjection:function(e,t){this.mapping="";this.Visit(e.expression,t);var n;if(this.mapping&&this._includes instanceof Array){n=this._includes.filter(function(e){return e.name.indexOf(this.mapping+".")===0},this);n=n.map(function(e){return{name:e.name.replace(this.mapping+".",""),type:e.type}},this);if(n.length>0){this.DefaultSelection(t,e.expression.entityType,n)}}if(e.expression instanceof $data.Expressions.EntityExpression){this.DefaultSelection(t,e.expression.entityType)}else if(e.expression instanceof $data.Expressions.EntitySetExpression){t.modelBinderConfig.$type=$data.Array;t.modelBinderConfig.$item={};t.selectModelBinderProperty("$item");this.DefaultSelection(t,e.expression.elementType);t.popModelBinderProperty()}},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t);this.Visit(e.selector,t)},VisitMemberInfoExpression:function(e,t){t.modelBinderConfig["$type"]=e.memberDefinition.type;if(e.memberDefinition.storageModel&&e.memberName in e.memberDefinition.storageModel.ComplexTypes){this._addPropertyToModelBinderConfig(Container.resolveType(e.memberDefinition.type),t)}else{if(!(t.modelBinderConfig.$type&&Container.resolveType(t.modelBinderConfig.$type).isAssignableTo&&Container.resolveType(t.modelBinderConfig.$type).isAssignableTo($data.Entity)))t.modelBinderConfig["$source"]=e.memberName}},VisitEntitySetExpression:function(e,t){if(e.source instanceof $data.Expressions.EntityExpression){this.Visit(e.source,t);this.Visit(e.selector,t)}},VisitComplexTypeExpression:function(e,t){this.Visit(e.source,t);this.Visit(e.selector,t);if("$selector"in t.modelBinderConfig&&t.modelBinderConfig.$selector.length>0){if(t.modelBinderConfig.$selector instanceof $data.Array){var n=t.modelBinderConfig.$selector[1];t.modelBinderConfig.$selector[0]=n+"."+e.selector.memberName+".results";t.modelBinderConfig.$selector[1]=n+"."+e.selector.memberName}else{t.modelBinderConfig.$selector+="."+e.selector.memberName}}else{if(this._isoDataProvider){t.modelBinderConfig["$selector"]=["json:"+e.selector.memberName+".results","json:"+e.selector.memberName]}else{t.modelBinderConfig["$selector"]="json:"+e.selector.memberName}}},VisitEntityExpression:function(e,t){this.Visit(e.source,t)},VisitAssociationInfoExpression:function(e,t){if("$selector"in t.modelBinderConfig&&t.modelBinderConfig.$selector.length>0){if(t.modelBinderConfig.$selector instanceof $data.Array){var n=t.modelBinderConfig.$selector[1];t.modelBinderConfig.$selector[0]=n+"."+e.associationInfo.FromPropertyName+".results";t.modelBinderConfig.$selector[1]=n+"."+e.associationInfo.FromPropertyName}else{t.modelBinderConfig.$selector+="."+e.associationInfo.FromPropertyName}}else{if(this._isoDataProvider){t.modelBinderConfig["$selector"]=["json:"+e.associationInfo.FromPropertyName+".results","json:"+e.associationInfo.FromPropertyName]}else{t.modelBinderConfig["$selector"]="json:"+e.associationInfo.FromPropertyName}}if(this.mapping&&this.mapping.length>0){this.mapping+="."}this.mapping+=e.associationInfo.FromPropertyName},VisitObjectLiteralExpression:function(e,t){t.modelBinderConfig["$type"]=$data.Object;e.members.forEach(function(e){this.Visit(e,t)},this)},VisitObjectFieldExpression:function(e,t){t.selectModelBinderProperty(e.fieldName);if(e.expression instanceof $data.Expressions.EntityExpression||e.expression instanceof $data.Expressions.EntitySetExpression){this.VisitEntityAsProjection(e,t)}else{this.Visit(e.expression,t)}t.popModelBinderProperty()}});$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(e){this.configuration=e||{};this.Authenticated=false},Login:function(e){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(e){Guard.raise("Pure class")}},null);$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(e){this.configuration=e||{};this.Authenticated=false},Login:function(e){},Logout:function(){},CreateRequest:function(e){$data.ajax(e)}},null);$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(e){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},e)},Login:function(e){if(this.Authenticated){return}var t=this;t.configuration.stateCallbacks=e||{};$data.ajax({url:this.configuration.Url_code,data:"type="+t.configuration.type_code+"&client_id="+t.configuration.app_id+"&scope="+t.configuration.scope,type:"POST",dataType:"json",success:function(e){if(typeof t.configuration.stateCallbacks.pending=="function")t.configuration.stateCallbacks.pending(e);t._processRequestToken(e);t.Authenticated=true},error:function(){if(typeof t.configuration.stateCallbacks.error=="function")t.configuration.stateCallbacks.error(arguments)}})},Logout:function(){this.Authenticated=false},CreateRequest:function(e){if(!e)return;var t=this;if(e.url.indexOf("access_token=")===-1){if(e.url&&this.Authenticated){var n="?";if(e.url.indexOf(n)>0)n="&";if(this.configuration.access_token)e.url=e.url+n+"access_token="+this.configuration.access_token}}$data.ajax(e)},_processRequestToken:function(verification_data){var provider=this;$data.ajax({url:provider.configuration.Url_token,data:"type="+provider.configuration.type_token+"&client_id="+provider.configuration.app_id+"&code="+verification_data.code,type:"POST",dataType:"json",success:function(e){provider.configuration.access_token=e.access_token;if(typeof provider.configuration.stateCallbacks.success=="function")provider.configuration.stateCallbacks.success(e)},error:function(obj){var data=eval("("+obj.responseText+")");if(data.error){if(data.error.message=="authorization_pending"){setTimeout(function(){provider._processRequestToken(verification_data)},2e3)}else if("authorization_declined"){if(typeof provider.configuration.stateCallbacks.abort=="function")provider.configuration.stateCallbacks.abort(arguments)}}}})}},null);$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(e){this.configuration=$data.typeSystem.extend({Username:"",Password:""},e)},Login:function(e){if(e&&typeof e.pending=="function")e.pending()},Logout:function(){},CreateRequest:function(e){if(!e)return;var t=this;var n=e.beforeSend;e.beforeSend=function(e){e.setRequestHeader("Authorization","Basic  "+t.__encodeBase64(t.configuration.Username+":"+t.configuration.Password));if(typeof n=="function")n(e)};$data.ajax(e)},__encodeBase64:function(e){var t="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";input=e;var n="";var r="";var i,s,o="";var u,a,f,l="";var c=0;do{i=input.charCodeAt(c++);s=input.charCodeAt(c++);o=input.charCodeAt(c++);u=i>>2;a=(i&3)<<4|s>>4;f=(s&15)<<2|o>>6;l=o&63;if(isNaN(s)){f=l=64}else if(isNaN(o)){l=64}n=n+t.charAt(u)+t.charAt(a)+t.charAt(f)+t.charAt(l);i=s=o="";u=a=f=l=""}while(c<input.length);return n}},null);$data.Class.define("$data.MetadataLoaderClass",null,null,{load:function(e,t,n){var r={EntityBaseClass:"$data.Entity",ContextBaseClass:"$data.EntityContext",AutoCreateContext:false,DefaultNamespace:("ns"+Math.random()).replace(".","")+e.replace(/[^\w]/g,"_"),ContextInstanceName:"context",EntitySetBaseClass:"$data.EntitySet",CollectionBaseClass:"Array",url:e,user:undefined,password:undefined,withCredentials:undefined,httpHeaders:undefined,typeFilter:"",navigation:true,generateKeys:true,dependentRelationsOnly:false};$data.typeSystem.extend(r,n||{});if(r.DefaultNamespace&&r.DefaultNamespace.lastIndexOf(".")!==r.DefaultNamespace.length-1)r.DefaultNamespace+=".";this.factoryCache=this.factoryCache||{};t=$data.typeSystem.createCallbackSetting(t);if(e in this.factoryCache){t.success.apply({},this.factoryCache[e]);return}var e;if(r.url){r.SerivceUri=r.url.replace("/$metadata","");if(r.url.indexOf("/$metadata")===-1){r.metadataUri=r.url.replace(/\/+$/,"")+"/$metadata"}else{r.metadataUri=r.url}}else{t.error("metadata url is missing")}var i=this;i._loadXMLDoc(r,function(e,n){if(n.statusCode<200||n.statusCode>299){t.error(n);return}var s=i._findVersion(e);if(i.xsltRepoUrl){console.log("XSLT: "+i.xsltRepoUrl+i._supportedODataVersionXSLT);i._loadXMLDoc({metadataUri:i.xsltRepoUrl+i._supportedODataVersionXSLT,user:r.user,password:r.password,httpHeaders:r.httpHeaders},function(n,o){if(o.statusCode<200||o.statusCode>299){t.error(o);return}var u=o.responseText;u=u.replace('xmlns:edm="@@VERSIONNS@@"','xmlns:edm="'+s.ns+'"');u=u.replace("@@VERSION@@",s.version);if(typeof ActiveXObject==="undefined"){var a=new DOMParser;n=a.parseFromString(u,"text/xml")}else{n=new ActiveXObject("Microsoft.XMLDOM");n.async=false;n.loadXML(u)}i._transform(t,s,e,n,r)})}else{i._transform(t,s,e,undefined,r)}})},debugMode:{type:"bool",value:false},xsltRepoUrl:{type:"string",value:""},createFactoryFunc:function(e,t,n){var r=this;return function(r){if(e){var i=$data.typeSystem.extend({name:"oData",oDataServiceHost:t.SerivceUri,user:t.user,password:t.password,withCredentials:t.withCredentials,maxDataServiceVersion:n.maxVersion||"3.0"},r);return new e(i)}else{return null}}},_transform:function(callBack,versionInfo,xml,xsl,cnf){var self=this;var codeText=self._processResults(cnf.url,versionInfo,xml,xsl,cnf);try{eval(codeText)}catch(e){callBack.error(new Exception("SyntaxError","Unexpected model",[e,codeText]));return}var ctxType;if(!$data.generatedContexts||!(ctxType=$data.generatedContexts.pop())){callBack.error(new Exception("No context found in service","Not found",[cnf,codeText]));return}var factoryFn=self.createFactoryFunc(ctxType,cnf,versionInfo);this.factoryCache[cnf.url]=[factoryFn,ctxType];factoryFn.type=ctxType;if(self.debugMode){factoryFn.codeText=codeText;callBack.success(factoryFn,ctxType,codeText)}else{callBack.success(factoryFn,ctxType)}},_loadXMLDoc:function(e,t){var n=this;if($data.postMessageODataHandler){if(e.user&&e.password&&(!e.httpHeaders||e.httpHeaders&&!e.httpHeaders["Authorization"])){httpHeader=httpHeader||{};httpHeader["Authorization"]="Basic "+this.__encodeBase64(e.user+":"+e.password)}$data.postMessageODataHandler.requestProxy({url:e.metadataUri,httpHeaders:e.httpHeaders,success:function(e){var n;if(typeof module!=="undefined"&&typeof require!=="undefined"){n=e.responseText}else if(window.ActiveXObject){n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(e.responseText)}else{var r=new DOMParser;n=r.parseFromString(e.responseText,"text/xml")}t(n,e)},error:function(r){n._loadXHTTP_XMLDoc(e,t)}})}else{this._loadXHTTP_XMLDoc(e,t)}},_loadXHTTP_XMLDoc:function(e,t){var n=new XMLHttpRequest;n.open("GET",e.metadataUri,true);if(e.httpHeaders){Object.keys(e.httpHeaders).forEach(function(t){n.setRequestHeader(t,e.httpHeaders[t])})}n.onreadystatechange=function(){if(n.readyState===4){var r={requestUri:e.metadataUri,statusCode:n.status,statusText:n.statusText,responseText:n.responseText};t(n.responseXML||n.responseText,r)}};if(e.user&&e.password&&(!e.httpHeaders||e.httpHeaders&&!e.httpHeaders["Authorization"]))n.setRequestHeader("Authorization","Basic "+this.__encodeBase64(e.user+":"+e.password));n.send("")},_processResults:function(e,t,n,r,i){var s=this.getCurrentXSLTVersion(t,n);i.typeFilter=this._prepareTypeFilter(n,t,i);if(window.ActiveXObject){var o=new ActiveXObject("Msxml2.XSLTemplate.6.0");var u=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0");var a;u.async=false;if(r)u.load(r);else u.loadXML(s);if(u.parseError.errorCode!=0){var f=u.parseError}else{o.stylesheet=u;var l=new ActiveXObject("Msxml2.DOMDocument.6.0");l.async=false;l.load(n);if(l.parseError.errorCode!=0){var f=l.parseError}else{a=o.createProcessor();a.input=l;a.addParameter("SerivceUri",i.SerivceUri);a.addParameter("EntityBaseClass",i.EntityBaseClass);a.addParameter("ContextBaseClass",i.ContextBaseClass);a.addParameter("AutoCreateContext",i.AutoCreateContext);a.addParameter("ContextInstanceName",i.ContextInstanceName);a.addParameter("EntitySetBaseClass",i.EntitySetBaseClass);a.addParameter("CollectionBaseClass",i.CollectionBaseClass);a.addParameter("DefaultNamespace",i.DefaultNamespace);a.addParameter("MaxDataserviceVersion",t.maxVersion||"3.0");a.addParameter("AllowedTypesList",i.typeFilter);a.addParameter("GenerateNavigationProperties",i.navigation);a.transform();return a.output}}return""}else if(typeof document!=="undefined"&&document.implementation&&document.implementation.createDocument){var c;if(r){c=r}else{var h=new DOMParser;c=h.parseFromString(s,"text/xml")}var p=new XSLTProcessor;p.importStylesheet(c);p.setParameter(null,"SerivceUri",i.SerivceUri);p.setParameter(null,"EntityBaseClass",i.EntityBaseClass);p.setParameter(null,"ContextBaseClass",i.ContextBaseClass);p.setParameter(null,"AutoCreateContext",i.AutoCreateContext);p.setParameter(null,"ContextInstanceName",i.ContextInstanceName);p.setParameter(null,"EntitySetBaseClass",i.EntitySetBaseClass);p.setParameter(null,"CollectionBaseClass",i.CollectionBaseClass);p.setParameter(null,"DefaultNamespace",i.DefaultNamespace);p.setParameter(null,"MaxDataserviceVersion",t.maxVersion||"3.0");p.setParameter(null,"AllowedTypesList",i.typeFilter);p.setParameter(null,"GenerateNavigationProperties",i.navigation);resultDocument=p.transformToFragment(n,document);return resultDocument.textContent}else if(typeof module!=="undefined"&&typeof require!=="undefined"){var o=require("node_xslt");return o.transform(o.readXsltString(s),o.readXmlString(n),["SerivceUri","'"+i.SerivceUri+"'","EntityBaseClass","'"+i.EntityBaseClass+"'","ContextBaseClass","'"+i.ContextBaseClass+"'","AutoCreateContext","'"+i.AutoCreateContext+"'","ContextInstanceName","'"+i.ContextInstanceName+"'","EntitySetBaseClass","'"+i.EntitySetBaseClass+"'","CollectionBaseClass","'"+i.CollectionBaseClass+"'","DefaultNamespace","'"+i.DefaultNamespace+"'","MaxDataserviceVersion","'"+(t.maxVersion||"3.0")+"'","AllowedTypesList","'"+i.typeFilter+"'","GenerateNavigationProperties","'"+i.navigation+"'"])}},_prepareTypeFilter:function(e,t,n){var r="";if(!(typeof e==="object"&&"querySelector"in e&&"querySelectorAll"in e))return r;var i=[];if(typeof n.typeFilter==="object"&&n.typeFilter){var s=Object.keys(n.typeFilter);for(var o=0;o<s.length;o++){var u=n.typeFilter[s[o]];var a={};if(typeof u==="object"&&u){if(Array.isArray(u)){a.Name=s[o];a.Fields=u}else{a.Name=u.name||s[o];a.Fields=u.members||[]}}else if(u){a.Name=s[o];a.Fields=[]}else{continue}var f=a.Name;var l="";if(a.Name.lastIndexOf(".")>0){l=a.Name.substring(0,a.Name.lastIndexOf("."));f=a.Name.substring(a.Name.lastIndexOf(".")+1)}var c=e.querySelectorAll("EntityContainer[Name = '"+l+"']");for(var h=0;h<c.length;h++){var p=c[h].querySelector("EntitySet[Name = '"+f+"']");if(p!=null){a.Name=p.attributes["EntityType"].value;break}}i.push(a)}var d;if(n.dependentRelationsOnly){d=this._discoverProperyDependencies(i,e,n.navigation,n.generateKeys)}else{d=this._discoverTypeDependencies(i,e,n.navigation,n.generateKeys)}var v=e.querySelectorAll("ComplexType");for(var o=0;o<v.length;o++){var m=v[o].parentNode.attributes["Namespace"].value;var g=!m?v[o].attributes["Name"].value:m+"."+v[o].attributes["Name"].value;d.push({Name:g,Fields:[]})}for(var o=0;o<d.length;o++){var y=d[o];if(y.Fields.length>0){r+=y.Name+":"+y.Fields.join(",")+";"}else{r+=y.Name+";"}}}return r},_discoverTypeDependencies:function(e,t,n,r){var i=[];var s=[];var o=[];for(var u=0;u<e.length;u++){var a=o.indexOf(e[u].Name);if(a>=0){o.splice(a,1)}this._discoverType(e[u],t,i,s,n,r,true,o)}for(var u=0;u<o.length;u++){this._discoverType({Name:o[u],Fields:[]},t,i,s,n,r,false,[])}return i},_discoverType:function(e,t,n,r,i,s,o,u){var a=e.Name;if(r.indexOf(a)>=0){return}console.log("Discover: "+a);var f=a;var l="";if(a.lastIndexOf(".")>0){l=a.substring(0,a.lastIndexOf("."));f=a.substring(a.lastIndexOf(".")+1)}var c=t.querySelector("Schema[Namespace = '"+l+"']");if(c!=null){var h=c.querySelector("EntityType[Name = '"+f+"'], ComplexType[Name = '"+f+"']");if(h!=null){n.push(e);r.push(a);if(s&&e.Fields.length>0){var p=h.querySelectorAll("Key PropertyRef");if(p!=null){for(var d=0;d<p.length;d++){var v=p[d].attributes["Name"].value;if(e.Fields.indexOf(v)<0)e.Fields.splice(d,0,v)}}}if(i){var m=h.querySelectorAll("NavigationProperty");for(var d=0;d<m.length;d++){var g=m[d];if(e.Fields.length==0||e.Fields.indexOf(g.attributes["Name"].value)>=0){var y=g.attributes["FromRole"].value;var b=g.attributes["ToRole"].value;var w=c.querySelector("Association End[Role = '"+y+"']:not([Type = '"+a+"'])");if(w==null){w=c.querySelector("Association End[Role = '"+b+"']:not([Type = '"+a+"'])")}if(w!=null){var E=w.attributes["Type"].value;if(o){if(u.indexOf(E)<0&&r.indexOf(E)<0)u.push(E)}else{this._discoverType({Name:E,Fields:[]},t,n,r,i,s,false,u)}}}}}}}},_discoverProperyDependencies:function(e,t,n,r){var i=[];var s=e.map(function(e){return e.Name});for(var o=0;o<e.length;o++){this._discoverProperties(e[o],t,i,s,n,r)}return i},_discoverProperties:function(e,t,n,r,i,s){var o=e.Name;console.log("Discover: "+o);var u=e.Fields.length!=0;var a=o;var f="";if(o.lastIndexOf(".")>0){f=o.substring(0,o.lastIndexOf("."));a=o.substring(o.lastIndexOf(".")+1)}var l=t.querySelector("Schema[Namespace = '"+f+"']");if(l!=null){var c=l.querySelector("EntityType[Name = '"+a+"'], ComplexType[Name = '"+a+"']");if(c!=null){n.push(e);if(!u){var h=c.querySelectorAll("Property");if(h!=null){for(var p=0;p<h.length;p++){var d=h[p].attributes["Name"].value;e.Fields.push(d)}}if(i){var v=c.querySelectorAll("NavigationProperty");for(var p=0;p<v.length;p++){var m=v[p];var g=m.attributes["Name"].value;var y=[m.attributes["FromRole"].value,m.attributes["ToRole"].value];var b="";for(var w=0;w<y.length;w++){var E=l.querySelector("Association End[Role = '"+y[w]+"']");if(E!=null){b=E.attributes["Type"].value;if(b!=o||w==1)break}}if(r.indexOf(b)>=0){e.Fields.push(g)}}}}else if(s){var S=c.querySelectorAll("Key PropertyRef");if(S!=null){for(var p=0;p<S.length;p++){var x=S[p].attributes["Name"].value;if(e.Fields.indexOf(x)<0)e.Fields.splice(p,0,x)}}}}}},_findVersion:function(e){var t="";if(typeof e==="object"&&"getElementsByTagName"in e){var n="http://schemas.microsoft.com/ado/2008/09/edm";var r=e.getElementsByTagName("Schema");if(r)r=r[0];if(r)r=r.attributes;if(r)r=r.getNamedItem("xmlns");if(r)n=r.value;var t=e.getElementsByTagName("edmx:DataServices")[0]||e.getElementsByTagName("DataServices")[0];if(t)t=t.attributes.getNamedItem("m:MaxDataServiceVersion");if(t&&n)t=t.value;var i=this._supportedODataVersions[n];return{ns:n,version:i||"unknown",maxVersion:t||this._maxDataServiceVersions[n||"unknown"]}}else if(typeof module!=="undefined"&&typeof require!=="undefined"){var s=e;var o="http://schemas.microsoft.com/ado/2008/09/edm";var n="nodejs";for(var u in this._supportedODataVersions){if(s.search(new RegExp('<Schema.+xmlns="'+u+'"',"gi"))>=0){o=u;n=this._supportedODataVersions[u];break}}return{ns:o,version:n,maxVersion:this._maxDataServiceVersions[n||"unknown"]}}},_supportedODataVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"V1","http://schemas.microsoft.com/ado/2008/09/edm":"V2","http://schemas.microsoft.com/ado/2009/11/edm":"V3","http://schemas.microsoft.com/ado/2007/05/edm":"V11","http://schemas.microsoft.com/ado/2009/08/edm":"V22"}},_maxDataServiceVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"2.0","http://schemas.microsoft.com/ado/2008/09/edm":"2.0","http://schemas.microsoft.com/ado/2009/11/edm":"3.0","http://schemas.microsoft.com/ado/2007/05/edm":"2.0","http://schemas.microsoft.com/ado/2009/08/edm":"2.0"}},_supportedODataVersionXSLT:{value:"JayDataContextGenerator.xslt"},getCurrentXSLTVersion:function(e,t){return this._metadataConverterXSLT.replace("@@VERSIONNS@@",e.ns).replace("@@VERSION@@",e.version)},__encodeBase64:function(e){var t="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";var n=e;var r="";var i="";var s,o,u="";var a,f,l,c="";var h=0;do{s=n.charCodeAt(h++);o=n.charCodeAt(h++);u=n.charCodeAt(h++);a=s>>2;f=(s&3)<<4|o>>4;l=(o&15)<<2|u>>6;c=u&63;if(isNaN(o)){l=c=64}else if(isNaN(u)){c=64}r=r+t.charAt(a)+t.charAt(f)+t.charAt(l)+t.charAt(c);s=o=u="";a=f=l=c=""}while(h<n.length);return r},_metadataConverterXSLT:{type:"string",value:'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" \r\n'+'                xmlns:edm="@@VERSIONNS@@" \r\n'+'                xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n'+'                xmlns:metadata="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n'+'                xmlns:annot="http://schemas.microsoft.com/ado/2009/02/edm/annotation" \r\n'+'                xmlns:exsl="http://exslt.org/common" \r\n'+'                xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\r\n'+"\r\n"+'  <xsl:key name="entityType" match="edm:EntityType" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n'+'  <xsl:key name="associations" match="edm:Association" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n'+"\r\n"+'  <xsl:strip-space elements="property item unprocessed"/>\r\n'+'  <xsl:output method="text" indent="no"  />\r\n'+'  <xsl:param name="contextNamespace" />\r\n'+"\r\n"+'  <xsl:param name="SerivceUri" />\r\n'+'  <xsl:param name="EntityBaseClass"/>\r\n'+'  <xsl:param name="ContextBaseClass"/>\r\n'+'  <xsl:param name="AutoCreateContext"/>\r\n'+'  <xsl:param name="ContextInstanceName"/>\r\n'+'  <xsl:param name="EntitySetBaseClass"/>\r\n'+'  <xsl:param name="CollectionBaseClass"/>\r\n'+'  <xsl:param name="DefaultNamespace"/>\r\n'+'  <xsl:param name="MaxDataserviceVersion"/>\r\n'+'  <xsl:param name="AllowedTypesList" />\r\n'+'  <xsl:param name="GenerateNavigationProperties" />\r\n'+"\r\n"+'  <xsl:param name="AllowedTypesListX">Microsoft.Crm.Sdk.Data.Services.Product;Microsoft.Crm.Sdk.Data.Services.LeadAddress:Telephone1,City,UTCOffset;</xsl:param>\r\n'+"\r\n"+'  <xsl:variable name="fullmetadata" select="/" />\r\n'+"  \r\n"+'  <xsl:template name="createFieldsList">\r\n'+'    <xsl:param name="fields" />\r\n'+'    <!--<xsl:message terminate="no">\r\n'+'      create field: @<xsl:value-of select="$fields"/>@\r\n'+"    </xsl:message>-->\r\n"+'      <xsl:variable name="thisField">\r\n'+"        <xsl:choose>\r\n"+"          <xsl:when test=\"contains($fields,',')\">\r\n"+"            <xsl:value-of select=\"substring-before($fields, ',')\"/>\r\n"+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+'            <xsl:value-of select="$fields"/>\r\n'+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:variable>\r\n"+'      <xsl:element name="field">\r\n'+'        <xsl:attribute name="name">\r\n'+'          <xsl:value-of select="$thisField"/>\r\n'+"        </xsl:attribute> \r\n"+"      </xsl:element>\r\n"+'      <xsl:variable name="remaining" select="substring($fields, string-length($thisField) + 2)" />\r\n'+'      <xsl:if test="string-length($remaining) > 0">\r\n'+'        <xsl:call-template name="createFieldsList">\r\n'+'          <xsl:with-param name="fields" select="$remaining" />\r\n'+"        </xsl:call-template>\r\n"+"      </xsl:if>\r\n"+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template name="createType">\r\n'+'    <xsl:param name="typeFull" />\r\n'+'    <!--<xsl:message terminate="no">\r\n'+'      create type: <xsl:value-of select="$typeFull"/>\r\n'+"    </xsl:message>-->\r\n"+'    <xsl:variable name="typeName">\r\n'+"      <xsl:choose>\r\n"+"        <xsl:when test=\"contains($typeFull,':')\">\r\n"+"          <xsl:value-of select=\"substring-before($typeFull, ':') \"/>\r\n"+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+'          <xsl:value-of select="$typeFull"/>\r\n'+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </xsl:variable>\r\n"+'    <xsl:variable name="fields" select="substring($typeFull, string-length($typeName) + 2)" />\r\n'+'    <xsl:element name="type">\r\n'+'      <xsl:attribute name="name">\r\n'+'        <xsl:value-of select="$typeName"/>\r\n'+"      </xsl:attribute>\r\n"+'      <xsl:if test="string-length($fields) > 0">\r\n'+'        <xsl:call-template name="createFieldsList">\r\n'+'          <xsl:with-param name="fields" select="$fields" />\r\n'+"        </xsl:call-template>\r\n"+"      </xsl:if>\r\n"+"    </xsl:element>\r\n"+"  </xsl:template>\r\n"+"  \r\n"+'  <xsl:template name="createTypeList">\r\n'+'    <xsl:param name="types" />\r\n'+'    <!--<xsl:message terminate="no">\r\n'+'      createTypeList: <xsl:value-of select="$types"/>\r\n'+"    </xsl:message>-->\r\n"+"        \r\n"+'    <xsl:variable name="thisTypeFull">\r\n'+"      <xsl:choose>\r\n"+"        <xsl:when test=\"contains($types, ';')\">\r\n"+"          <xsl:value-of select=\"substring-before($types, ';')\"/>\r\n"+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+'          <xsl:value-of select="$types"/>\r\n'+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </xsl:variable>\r\n"+"\r\n"+'    <xsl:if test="string-length($thisTypeFull) > 0">\r\n'+'      <xsl:call-template name="createType">\r\n'+'        <xsl:with-param name="typeFull" select="$thisTypeFull" />\r\n'+"      </xsl:call-template>\r\n"+"    </xsl:if>\r\n"+"    \r\n"+'    <xsl:variable name="remaining" select="substring($types, string-length($thisTypeFull) + 2)" />\r\n'+'    <!--<xsl:message terminate="no">\r\n'+'      rem: @<xsl:value-of select="$remaining"/>@  \r\n'+"    </xsl:message>-->\r\n"+"    \r\n"+'    <xsl:if test="string-length($remaining) > 0">\r\n'+'      <xsl:call-template name="createTypeList">\r\n'+'        <xsl:with-param name="types" select="$remaining" />\r\n'+"      </xsl:call-template>\r\n"+"    </xsl:if>\r\n"+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:variable name="allowedTypes">\r\n'+'    <xsl:call-template name="createTypeList">\r\n'+'      <xsl:with-param name="types" select="$AllowedTypesList" />\r\n'+"    </xsl:call-template>\r\n"+"  </xsl:variable>\r\n"+"  \r\n"+"\r\n"+"<!-- TODO EXSLT node-set -->\r\n"+'  <!--<xsl:variable name="hasTypeFilter" select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/>-->\r\n'+'  <xsl:variable name="hasTypeFilter">\r\n'+"    <xsl:choose>\r\n"+'      <xsl:when test="function-available(\'msxsl:node-set\')"><xsl:value-of select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/></xsl:when>\r\n'+'      <xsl:otherwise><xsl:value-of select="boolean(count(exsl:node-set($allowedTypes)/type) > 0)"/></xsl:otherwise>\r\n'+"    </xsl:choose>\r\n"+"  </xsl:variable>\r\n"+'  <xsl:template match="/">\r\n'+"\r\n"+"/*//////////////////////////////////////////////////////////////////////////////////////\r\n"+"////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////\r\n"+"//////                             oData @@VERSION@@                                    /////////\r\n"+"//////////////////////////////////////////////////////////////////////////////////////*/\r\n"+"(function(global, $data, undefined) {\r\n"+"\r\n"+"    \r\n"+'<xsl:for-each select="//edm:EntityType | //edm:ComplexType" xml:space="default">\r\n'+'  <xsl:variable name="thisName" select="concat(../@Namespace, \'.\', @Name)" />\r\n'+"  <!-- TODO EXSLT node-set-->\r\n"+'  <!--<xsl:variable name="thisTypeNode" select="msxsl:node-set($allowedTypes)/type[@name = $thisName]" />-->\r\n'+'  <xsl:variable name="thisTypeNode">\r\n'+"    <xsl:choose>\r\n"+"      <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+'        <xsl:copy-of select="msxsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n'+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+'        <xsl:copy-of select="exsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n'+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:variable>\r\n"+'  <xsl:variable name="thisTypeNodeExists">\r\n'+"    <xsl:choose>\r\n"+"      <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+'        <xsl:copy-of select="(count(msxsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n'+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+'        <xsl:copy-of select="(count(exsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n'+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:variable>\r\n"+'  <!--<xsl:variable name="filterFields" select="(count($thisTypeNode/field) > 0)" />-->\r\n'+'  <xsl:variable name="filterFields">\r\n'+"    <xsl:choose>\r\n"+"      <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+'        <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n'+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+'        <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n'+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:variable>\r\n"+"  <xsl:if test=\"($hasTypeFilter = 'false') or ($thisTypeNodeExists = 'true')\">\r\n"+"\r\n"+'      <xsl:message terminate="no">Info: generating type <xsl:value-of select="concat(../@Namespace, \'.\', @Name)"/></xsl:message>\r\n'+"    \r\n"+'      <xsl:variable name="BaseType">\r\n'+"        <xsl:choose>\r\n"+'          <xsl:when test="@BaseType">\r\n'+'            <xsl:value-of select="concat($DefaultNamespace,@BaseType)"/>\r\n'+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+'            <xsl:value-of select="$EntityBaseClass"  />\r\n'+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:variable>\r\n"+"\r\n"+"\r\n"+'     <xsl:variable name="props">\r\n'+"       <xsl:for-each select=\"*[local-name() != 'NavigationProperty' or ($GenerateNavigationProperties = 'true' and local-name() = 'NavigationProperty')]\">\r\n"+'         <xsl:variable name="fname" select="@Name" />\r\n'+'         <xsl:variable name="isAllowedField">\r\n'+"           <xsl:choose>\r\n"+"             <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+'               <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n'+"             </xsl:when>\r\n"+"             <xsl:otherwise>\r\n"+'               <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n'+"             </xsl:otherwise>\r\n"+"           </xsl:choose>\r\n"+"         </xsl:variable>\r\n"+"         <xsl:if test=\"($filterFields = 'false') or ($isAllowedField = 'true')\">\r\n"+'           <xsl:apply-templates select="." />\r\n'+"         </xsl:if> \r\n"+"       </xsl:for-each>\r\n"+"      </xsl:variable>\r\n"+"    \r\n"+'      <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$BaseType"  />.extend(\'<xsl:value-of select="concat($DefaultNamespace,../@Namespace)"/>.<xsl:value-of select="@Name"/>\', {\r\n'+"     <xsl:choose>\r\n"+"        <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+'          <xsl:for-each select="msxsl:node-set($props)/*">\r\n'+'            <xsl:value-of select="."/>\r\n'+'            <xsl:if test="position() != last()">\r\n'+"            <xsl:text>,&#10;     </xsl:text>  \r\n"+"            </xsl:if>\r\n"+"          </xsl:for-each>\r\n"+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+'          <xsl:for-each select="exsl:node-set($props)/*">\r\n'+'            <xsl:value-of select="."/>\r\n'+'            <xsl:if test="position() != last()">,&#10;     </xsl:if>\r\n'+"          </xsl:for-each>\r\n"+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+'      <xsl:variable name="currentName"><xsl:value-of select="concat(../@Namespace,\'.\',@Name)"/></xsl:variable>\r\n'+'      <xsl:for-each select="//edm:FunctionImport[@IsBindable and edm:Parameter[1]/@Type = $currentName]"><xsl:if test="position() = 1">,\r\n'+"      </xsl:if>\r\n"+'        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n'+"      </xsl:if>\r\n"+"      </xsl:for-each>\r\n"+"  });\r\n"+"\r\n"+"</xsl:if>\r\n"+"</xsl:for-each>\r\n"+"\r\n"+'<xsl:for-each select="//edm:EntityContainer">\r\n'+'  <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$ContextBaseClass"  />.extend(\'<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)"/>\', {\r\n'+"     <!--or (@IsBindable = 'true' and (@IsAlwaysBindable = 'false' or @m:IsAlwaysBindable = 'false' or @metadata:IsAlwaysBindable = 'false'))-->\r\n"+"\r\n"+'   <xsl:variable name="subset">\r\n'+'    <xsl:for-each select="edm:EntitySet | edm:FunctionImport">\r\n'+"      <xsl:choose>\r\n"+"        <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+"          <xsl:if test=\"($hasTypeFilter = 'false') or msxsl:node-set($allowedTypes)/type[@name = current()/@EntityType]\">\r\n"+'            <xsl:copy-of select="."/>\r\n'+"          </xsl:if>\r\n"+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+"          <xsl:if test=\"($hasTypeFilter = 'false') or exsl:node-set($allowedTypes)/type[@name = current()/@EntityType]\">\r\n"+'            <xsl:copy-of select="."/>\r\n'+"          </xsl:if>\r\n"+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </xsl:for-each>\r\n"+"  </xsl:variable>\r\n"+"\r\n"+"  \r\n"+"  <xsl:choose>\r\n"+"    <xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+"      <xsl:for-each select=\"msxsl:node-set($subset)/*[local-name() != 'FunctionImport' or not(@IsBindable) or @IsBindable = 'false']\">\r\n"+'        <xsl:apply-templates select="."></xsl:apply-templates>\r\n'+'        <xsl:if test="position() != last()">,\r\n'+"     </xsl:if>\r\n"+"      </xsl:for-each>\r\n"+"    </xsl:when>\r\n"+"    <xsl:otherwise>\r\n"+"      <xsl:for-each select=\"exsl:node-set($subset)/*[local-name() != 'FunctionImport' or not(@IsBindable) or @IsBindable = 'false']\">\r\n"+'        <xsl:apply-templates select="."></xsl:apply-templates>\r\n'+'        <xsl:if test="position() != last()">,\r\n'+"     </xsl:if>\r\n"+"      </xsl:for-each>\r\n"+"    </xsl:otherwise>\r\n"+"  </xsl:choose>\r\n"+"  });\r\n"+"\r\n"+"  $data.generatedContexts = $data.generatedContexts || [];\r\n"+"  $data.generatedContexts.push(<xsl:value-of select=\"concat(concat($DefaultNamespace,../@Namespace), '.', @Name)\" />);\r\n"+"  <xsl:if test=\"$AutoCreateContext = 'true'\">\r\n"+"  /*Context Instance*/\r\n"+'  <xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$ContextInstanceName" /> = new <xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />({ name:\'oData\', oDataServiceHost: \'<xsl:value-of select="$SerivceUri" />\', maxDataServiceVersion: \'<xsl:value-of select="$MaxDataserviceVersion" />\' });\r\n'+"</xsl:if>\r\n"+"\r\n"+"</xsl:for-each>\r\n"+"      \r\n"+"})(window, $data);\r\n"+"      \r\n"+"    </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="edm:Key"></xsl:template>\r\n'+"\r\n"+'  <xsl:template match="edm:FunctionImport">\r\n'+"    <xsl:text>'</xsl:text>\r\n"+'    <xsl:value-of select="@Name"/>\r\n'+"    <xsl:text>': { type: </xsl:text>\r\n"+"    <xsl:choose>\r\n"+"      <xsl:when test=\"@IsBindable = 'true'\">\r\n"+"        <xsl:text>$data.ServiceAction</xsl:text>\r\n"+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+"        <xsl:text>$data.ServiceOperation</xsl:text>\r\n"+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"\r\n"+'    <xsl:apply-templates select="@*" mode="FunctionImport-mode"/>\r\n'+"\r\n"+'    <xsl:variable name="IsBindable">\r\n'+'      <xsl:value-of select="@IsBindable"/>\r\n'+"    </xsl:variable>\r\n"+"    <xsl:text>, params: [</xsl:text>\r\n"+"    <xsl:for-each select=\"edm:Parameter[($IsBindable = 'true' and position() > 1) or (($IsBindable = 'false' or $IsBindable = '') and position() > 0)]\">\r\n"+"      <xsl:text>{ name: '</xsl:text>\r\n"+'      <xsl:value-of select="@Name"/>\r\n'+"      <xsl:text>', type: '</xsl:text>\r\n"+'      <xsl:variable name="curr" select="@Type"/>\r\n'+"      <xsl:choose>\r\n"+'        <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n'+'          <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n'+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+'          <xsl:value-of select="$curr" />\r\n'+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"      <xsl:text>' }</xsl:text>\r\n"+'      <xsl:if test="position() != last()">, </xsl:if>\r\n'+"    </xsl:for-each>    \r\n"+"    <xsl:text>]</xsl:text>\r\n"+"\r\n"+"    <xsl:text> }</xsl:text>\r\n"+"  </xsl:template>\r\n"+"  \r\n"+'  <xsl:template match="@ReturnType" mode="FunctionImport-mode">\r\n'+"    <xsl:text>, returnType: </xsl:text>\r\n"+"    <xsl:choose>\r\n"+'      <xsl:when test="not(.)">null</xsl:when>\r\n'+"      <xsl:when test=\"starts-with(., 'Collection')\">$data.Queryable</xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+"        <xsl:text>'</xsl:text>\r\n"+'        <xsl:variable name="curr" select="."/>\r\n'+"        <xsl:choose>\r\n"+'          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n'+'            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n'+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+'            <xsl:value-of select="$curr" />\r\n'+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"        <xsl:text>'</xsl:text>\r\n"+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"\r\n"+"    <xsl:if test=\"starts-with(., 'Collection')\">\r\n"+'      <xsl:variable name="len" select="string-length(.)-12"/>\r\n'+'      <xsl:variable name="curr" select="substring(.,12,$len)"/>\r\n'+'      <xsl:variable name="ElementType" >\r\n'+"        <xsl:choose>\r\n"+'          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n'+'            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n'+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+'            <xsl:value-of select="$curr" />\r\n'+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:variable>\r\n"+"      <xsl:text>, elementType: '</xsl:text>\r\n"+'      <xsl:value-of select="$ElementType"/>\r\n'+"      <xsl:text>'</xsl:text>\r\n"+"    </xsl:if>\r\n"+"  </xsl:template>\r\n"+'  <xsl:template match="@Name" mode="FunctionImport-mode"></xsl:template>\r\n'+'  <xsl:template match="@m:HttpMethod" mode="FunctionImport-mode">\r\n'+"    <xsl:text>, method: '</xsl:text>\r\n"+'    <xsl:value-of select="."/>\r\n'+"    <xsl:text>'</xsl:text>\r\n"+"  </xsl:template>\r\n"+'  <xsl:template match="@IsBindable | @IsSideEffecting | @IsAlwaysBindable | @m:IsAlwaysBindable | @metadata:IsAlwaysBindable | @IsComposable" mode="FunctionImport-mode">\r\n'+"    <xsl:text>, </xsl:text>\r\n"+'    <xsl:call-template name="GetAttributeName">\r\n'+'      <xsl:with-param name="Name" select="name()" />\r\n'+"    </xsl:call-template>\r\n"+"    <xsl:text>: </xsl:text>\r\n"+'    <xsl:value-of select="."/>\r\n'+"  </xsl:template>\r\n"+'  <xsl:template match="@*" mode="FunctionImport-mode">\r\n'+"    <xsl:text>, '</xsl:text>\r\n"+'    <xsl:call-template name="GetAttributeName">\r\n'+'      <xsl:with-param name="Name" select="name()" />\r\n'+"    </xsl:call-template>\r\n"+"    <xsl:text>': '</xsl:text>\r\n"+'    <xsl:value-of select="."/>        \r\n'+"    <xsl:text>'</xsl:text>\r\n"+"  </xsl:template>\r\n"+'  <xsl:template name="GetAttributeName">\r\n'+'    <xsl:param name="Name" />\r\n'+"    <xsl:choose>\r\n"+"      <xsl:when test=\"contains($Name, ':')\">\r\n"+"        <xsl:value-of select=\"substring-after($Name, ':')\"/>\r\n"+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+'        <xsl:value-of select="$Name"/>\r\n'+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="edm:EntitySet">\'<xsl:value-of select="@Name"/>\': { type: <xsl:value-of select="$EntitySetBaseClass"  />, elementType: <xsl:value-of select="concat($DefaultNamespace,@EntityType)"/><xsl:text> </xsl:text><xsl:apply-templates select="." mode="Collection-Actions" />}</xsl:template>\r\n'+"\r\n"+'  <xsl:template match="edm:EntitySet" mode="Collection-Actions">\r\n'+"    <xsl:variable name=\"CollectionType\" select=\"concat('Collection(', @EntityType, ')')\" />\r\n"+'    <xsl:for-each select="//edm:FunctionImport[edm:Parameter[1]/@Type = $CollectionType]">\r\n'+'      <xsl:if test="position() = 1">\r\n'+"        <xsl:text>, actions: { \r\n"+"        </xsl:text>\r\n"+"      </xsl:if>\r\n"+'        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n'+"        </xsl:if>\r\n"+'      <xsl:if test="position() = last()">\r\n'+"        <xsl:text>\r\n"+"      }</xsl:text>\r\n"+"      </xsl:if>\r\n"+"    </xsl:for-each>\r\n"+"  </xsl:template>\r\n"+"  \r\n"+'  <xsl:template match="edm:Property | edm:NavigationProperty">\r\n'+"    <property>\r\n"+'    <xsl:variable name="memberDefinition">\r\n'+'      <xsl:if test="parent::edm:EntityType/edm:Key/edm:PropertyRef[@Name = current()/@Name]"><attribute name="key">true</attribute></xsl:if>\r\n'+'      <xsl:apply-templates select="@*[local-name() != \'Name\']" mode="render-field" />\r\n'+'    </xsl:variable>\'<xsl:value-of select="@Name"/>\': { <xsl:choose><xsl:when test="function-available(\'msxsl:node-set\')"><xsl:for-each select="msxsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n'+'      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n'+"    </xsl:if> </xsl:for-each></xsl:when>\r\n"+'  <xsl:otherwise><xsl:for-each select="exsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n'+'      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n'+"    </xsl:if> </xsl:for-each></xsl:otherwise>\r\n"+"    </xsl:choose> }</property>\r\n"+"</xsl:template>\r\n"+"  \r\n"+'  <xsl:template match="@Name" mode="render-field">\r\n'+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@Type" mode="render-field">\r\n'+"    <xsl:choose>\r\n"+"      <xsl:when test=\"starts-with(., 'Collection')\">\r\n"+"        <attribute name=\"type\">'Array'</attribute>\r\n"+'        <xsl:variable name="len" select="string-length(.)-12"/>\r\n'+'        <xsl:variable name="currType" select="substring(.,12,$len)"/>\r\n'+"        <xsl:choose>\r\n"+'          <xsl:when test="starts-with($currType, ../../../@Namespace)">\r\n'+'            <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$currType" />\'</attribute>\r\n'+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+'            <attribute name="elementType">\'<xsl:value-of select="$currType" />\'</attribute>\r\n'+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:when>\r\n"+'      <xsl:when test="starts-with(., ../../../@Namespace)">\r\n'+'        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="."/>\'</attribute>\r\n'+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+'        <attribute name="type">\'<xsl:value-of select="."/>\'</attribute>\r\n'+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@ConcurrencyMode" mode="render-field">\r\n'+'    <attribute name="concurrencyMode">$data.ConcurrencyMode.<xsl:value-of select="."/></attribute>\r\n'+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@Nullable" mode="render-field">\r\n'+'    <attribute name="nullable"><xsl:value-of select="."/></attribute>\r\n'+"    \r\n"+"    <xsl:if test=\". = 'false'\">\r\n"+"      <xsl:choose>\r\n"+"        <xsl:when test=\"parent::edm:Property/@annot:StoreGeneratedPattern = 'Identity' or parent::edm:Property/@annot:StoreGeneratedPattern = 'Computed'\"></xsl:when>\r\n"+'        <xsl:otherwise><attribute name="required">true</attribute></xsl:otherwise>\r\n'+"      </xsl:choose>\r\n"+"    </xsl:if>\r\n"+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@annot:StoreGeneratedPattern" mode="render-field">\r\n'+'    <xsl:if test=". != \'None\'"><attribute name="computed">true</attribute></xsl:if>    \r\n'+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@MaxLength" mode="render-field">\r\n'+'    <attribute name="maxLength">\r\n'+"      <xsl:choose>\r\n"+"        <xsl:when test=\"string(.) = 'Max'\">Number.POSITIVE_INFINITY</xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+'          <xsl:value-of select="."/>\r\n'+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </attribute>\r\n"+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@FixedLength | @Unicode | @Precision | @Scale" mode="render-field">\r\n'+"  </xsl:template>\r\n"+'  <xsl:template match="@*" mode="render-field">\r\n'+'    <xsl:variable name="nameProp">\r\n'+"      <xsl:choose>\r\n"+"        <xsl:when test=\"substring-after(name(), ':') != ''\">\r\n"+"          <xsl:value-of select=\"substring-after(name(), ':')\"/>\r\n"+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+'          <xsl:value-of select="name()"/>\r\n'+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </xsl:variable>\r\n"+'    <xsl:element name="attribute"><xsl:attribute name="extended">true</xsl:attribute><xsl:attribute name="name"><xsl:value-of select="$nameProp"/></xsl:attribute>\'<xsl:value-of select="."/>\'</xsl:element>\r\n'+"  </xsl:template>\r\n"+"\r\n"+'  <xsl:template match="@Relationship" mode="render-field">\r\n'+'    <xsl:variable name="relationName" select="string(../@ToRole)"/>\r\n'+'    <xsl:variable name="relationshipName" select="string(.)" />\r\n'+'    <xsl:variable name="relation" select="key(\'associations\',string(.))/edm:End[@Role = $relationName]" />\r\n'+'    <xsl:variable name="otherName" select="../@FromRole" />\r\n'+'    <xsl:variable name="otherProp" select="//edm:NavigationProperty[@ToRole = $otherName and @Relationship = $relationshipName]" />\r\n'+'    <xsl:variable name="m" select="$relation/@Multiplicity" />\r\n'+"    <xsl:choose>\r\n"+"      <xsl:when test=\"$m = '*'\">\r\n"+'        <attribute name="type">\'<xsl:value-of select="$CollectionBaseClass"/>\'</attribute>\r\n'+'        <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n'+'        <xsl:if test="not($otherProp/@Name)">\r\n'+"          <attribute name=\"inverseProperty\">'$$unbound'</attribute></xsl:if>\r\n"+'        <xsl:if test="$otherProp/@Name">\r\n'+'          <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute></xsl:if>\r\n'+"      </xsl:when>\r\n"+"      <xsl:when test=\"$m = '0..1'\">\r\n"+'        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n'+"        <xsl:choose>\r\n"+'          <xsl:when test="$otherProp">\r\n'+'            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n'+"          </xsl:when >\r\n"+"          <xsl:otherwise>\r\n"+"            <attribute name=\"inverseProperty\">'$$unbound'</attribute>\r\n"+'            <xsl:message terminate="no">  Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n'+"          </xsl:message>\r\n"+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:when>\r\n"+"      <xsl:when test=\"$m = '1'\">\r\n"+'        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n'+'        <attribute name="required">true</attribute>\r\n'+"        <xsl:choose>\r\n"+'          <xsl:when test="$otherProp">\r\n'+'            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n'+"          </xsl:when >\r\n"+"          <xsl:otherwise>\r\n"+"            <attribute name=\"inverseProperty\">'$$unbound'</attribute>\r\n"+'            <xsl:message terminate="no">\r\n'+'              Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n'+"            </xsl:message>\r\n"+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:when>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"\r\n"+'  <xsl:template match="@FromRole | @ToRole" mode="render-field"></xsl:template>\r\n'+"\r\n"+'  <xsl:template match="*" mode="render-field">\r\n'+'    <!--<unprocessed>!!<xsl:value-of select="name()"/>!!</unprocessed>-->\r\n'+'    <xsl:message terminate="no">  Warning: <xsl:value-of select="../../@Name"/>.<xsl:value-of select="../@Name"/>:<xsl:value-of select="name()"/> is an unknown/unprocessed attribued</xsl:message>\r\n'+"  </xsl:template>\r\n"+'  <!--<xsl:template match="*">\r\n'+'    !<xsl:value-of select="name()"/>!\r\n'+"  </xsl:template>-->\r\n"+"</xsl:stylesheet>\r\n"}});$data.MetadataLoader=new $data.MetadataLoaderClass;$data.service=function(e,t,n){function o(e){switch(typeof e){case"object":if(typeof e.success==="function"||typeof e.error==="function"){s=e}else{i=e}break;case"function":s=e;break;default:break}}var r,i,s;o(t);o(n);if(typeof e==="object"){i=$data.typeSystem.extend(e,i);e=e.url;delete i.url}var u=new $data.PromiseHandler;s=u.createCallback(s);$data.MetadataLoader.load(e,{success:function(e){var t=e.type;if(i){var n=i.serviceName||i.storeAlias;if(n&&"addStore"in $data){$data.addStore(n,e,i.isDefault===undefined||i.isDefault)}}s.success(e,t)},error:s.error},i);return u.getPromise()};(function(e){if(typeof jQuery!=="undefined"){e.Class.define("$data.Deferred",e.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred},deferred:{},createCallback:function(t){t=e.typeSystem.createCallbackSetting(t);var n=this;return cbWrapper={success:function(){t.success.apply(n.deferred,arguments);n.deferred.resolve.apply(n.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,n.deferred);t.error.apply(n.deferred,arguments)},notify:function(){t.notify.apply(n.deferred,arguments);n.deferred.notify.apply(n.deferred,arguments)}}},getPromise:function(){return this.deferred.promise()}},null);e.PromiseHandler=e.Deferred}})($data);(function(e){e.initService=function(t,n){var r=new e.PromiseHandler;var i;if(typeof t==="object"){i=t;var s=i.isSSL||i.isSSL===undefined?"https":"http";var o=i.port?":"+i.port:"";if(typeof i.license==="string"&&i.license.toLowerCase()==="business"){if(i.appId&&i.serviceName){t=s+"://"+i.appId+".jaystack.net"+o+"/"+i.serviceName}else{t=i.url}}else{if(i.ownerId&&i.appId&&i.serviceName){t=s+"://open.jaystack.net/"+i.ownerId+"/"+i.appId+"/api/"+i.serviceName}else{t=i.url}}delete i.url;i=e.typeSystem.extend(i,n)}else{i=n}e.service(t,i).then(function(e){var t=e();return t.onReady().then(function(t){t.serviceFactory=e;r.deferred.resolve(t,e,e.type)}).fail(function(){r.deferred.reject.apply(r.deferred,arguments)})}).fail(function(){r.deferred.reject.apply(r.deferred,arguments)});return r.getPromise()}})($data)